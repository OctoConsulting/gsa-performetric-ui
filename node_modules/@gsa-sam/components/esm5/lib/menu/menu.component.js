/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { ChangeDetectionStrategy, Component, ElementRef, EventEmitter, InjectionToken, Input, Output, TemplateRef, ViewChild, ViewEncapsulation } from '@angular/core';
import { ESCAPE, DOWN_ARROW, UP_ARROW, HOME, END, hasModifierKey } from '@angular/cdk/keycodes';
import { FocusKeyManager } from '@angular/cdk/a11y';
import { coerceBooleanProperty } from '@angular/cdk/coercion';
import { Subscription } from 'rxjs';
import { sdsMenuAnimations } from './menu-animations';
/**
 * Injection token used to provide the parent menu to menu items.
 * @type {?}
 */
export var SDS_MENU_TOKEN = new InjectionToken('SDS_MENU_TOKEN');
/**
 * Menu Interface
 * @record
 * @template T
 */
export function SdsMenuInterface() { }
if (false) {
    /** @type {?} */
    SdsMenuInterface.prototype.xPosition;
    /** @type {?} */
    SdsMenuInterface.prototype.yPosition;
    /** @type {?} */
    SdsMenuInterface.prototype.overlapTrigger;
    /** @type {?} */
    SdsMenuInterface.prototype.templateRef;
    /** @type {?} */
    SdsMenuInterface.prototype.closed;
    /** @type {?|undefined} */
    SdsMenuInterface.prototype.parentMenu;
    /** @type {?|undefined} */
    SdsMenuInterface.prototype.size;
    /** @type {?} */
    SdsMenuInterface.prototype.focusFirstItem;
    /** @type {?|undefined} */
    SdsMenuInterface.prototype.setPositionClasses;
    /** @type {?|undefined} */
    SdsMenuInterface.prototype.addItem;
    /** @type {?|undefined} */
    SdsMenuInterface.prototype.insertItem;
    /** @type {?|undefined} */
    SdsMenuInterface.prototype.removeItem;
}
var SdsMenuComponent = /** @class */ (function () {
    function SdsMenuComponent(_elementRef) {
        this._elementRef = _elementRef;
        /**
         * After | Before the menu triger element
         */
        this._xPosition = 'after';
        /**
         * Above | Below the menu triger element
         */
        this._yPosition = 'below';
        /**
         * Menu items inside the current menu.
         */
        this._items = [];
        /**
         * Subscription to tab events on the menu panel
         */
        this._tabSubscription = Subscription.EMPTY;
        /**
         * Config object to be passed into the menu's ngClass
         */
        this._classList = {};
        /**
         * Current state of the panel animation.
         */
        this._panelAnimationState = 'void';
        this._overlapTrigger = false;
        /**
         * Event emitted when the menu is closed.
         */
        this.closed = new EventEmitter();
    }
    Object.defineProperty(SdsMenuComponent.prototype, "xPosition", {
        /** Position of the menu in the X axis. */
        get: /**
         * Position of the menu in the X axis.
         * @return {?}
         */
        function () {
            return this._xPosition;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._xPosition = value;
            this.setPositionClasses();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SdsMenuComponent.prototype, "yPosition", {
        /** Position of the menu in the Y axis. */
        get: /**
         * Position of the menu in the Y axis.
         * @return {?}
         */
        function () {
            return this._yPosition;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._yPosition = value;
            this.setPositionClasses();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SdsMenuComponent.prototype, "overlapTrigger", {
        /** Whether menu panel overlaps trigger element */
        get: /**
         * Whether menu panel overlaps trigger element
         * @return {?}
         */
        function () {
            return this._overlapTrigger;
        },
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            this._overlapTrigger = coerceBooleanProperty(value);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SdsMenuComponent.prototype, "panelClass", {
        /** Transfer classes from the sds-menu to the overlay container */
        set: /**
         * Transfer classes from the sds-menu to the overlay container
         * @param {?} classes
         * @return {?}
         */
        function (classes) {
            var _this = this;
            /** @type {?} */
            var previousPanelClass = this._previousPanelClass;
            // Remove previous classes from current set of classes
            if (previousPanelClass && previousPanelClass.length) {
                previousPanelClass.split(' ').forEach((/**
                 * @param {?} className
                 * @return {?}
                 */
                function (className) {
                    _this._classList[className] = false;
                }));
            }
            this._previousPanelClass = classes;
            // Adds new classes to current set of classes
            if (classes && classes.length) {
                classes.split(' ').forEach((/**
                 * @param {?} className
                 * @return {?}
                 */
                function (className) {
                    _this._classList[className] = true;
                }));
                // Remove all classes from <sds-menu>
                this._elementRef.nativeElement.className = '';
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    SdsMenuComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.setPositionClasses();
    };
    /**
     * @return {?}
     */
    SdsMenuComponent.prototype.ngAfterContentInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this._keyManager = new FocusKeyManager(this._items).withWrap();
        this._tabSubscription = this._keyManager.tabOut.subscribe((/**
         * @return {?}
         */
        function () {
            return _this.closed.emit('tab');
        }));
    };
    /**
     * @return {?}
     */
    SdsMenuComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this._tabSubscription.unsubscribe();
        this.closed.complete();
    };
    /** Focus the first item in the menu */
    /**
     * Focus the first item in the menu
     * @param {?=} origin
     * @return {?}
     */
    SdsMenuComponent.prototype.focusFirstItem = /**
     * Focus the first item in the menu
     * @param {?=} origin
     * @return {?}
     */
    function (origin) {
        if (origin === void 0) { origin = 'program'; }
        this._keyManager.setFocusOrigin(origin).setFirstItemActive();
    };
    /** Adds classes to the menu panel based on its position */
    /**
     * Adds classes to the menu panel based on its position
     * @param {?=} posX
     * @param {?=} posY
     * @return {?}
     */
    SdsMenuComponent.prototype.setPositionClasses = /**
     * Adds classes to the menu panel based on its position
     * @param {?=} posX
     * @param {?=} posY
     * @return {?}
     */
    function (posX, posY) {
        if (posX === void 0) { posX = this.xPosition; }
        if (posY === void 0) { posY = this.yPosition; }
        /** @type {?} */
        var classes = this._classList;
        classes['sds-menu-before'] = posX === 'before';
        classes['sds-menu-after'] = posX === 'after';
        classes['sds-menu-above'] = posY === 'above';
        classes['sds-menu-below'] = posY === 'below';
    };
    /** Adds a menu item with the menu. */
    /**
     * Adds a menu item with the menu.
     * @param {?} item
     * @return {?}
     */
    SdsMenuComponent.prototype.addItem = /**
     * Adds a menu item with the menu.
     * @param {?} item
     * @return {?}
     */
    function (item) {
        if (this._items.indexOf(item) === -1) {
            this._items.push(item);
        }
    };
    /** Inserts a menu item at an index */
    /**
     * Inserts a menu item at an index
     * @param {?} item
     * @param {?} index
     * @return {?}
     */
    SdsMenuComponent.prototype.insertItem = /**
     * Inserts a menu item at an index
     * @param {?} item
     * @param {?} index
     * @return {?}
     */
    function (item, index) {
        if (this._items.indexOf(item) === -1 && index < this._items.length) {
            this._items.splice(index, 0, item);
        }
    };
    /** Removes an item from the menu. */
    /**
     * Removes an item from the menu.
     * @param {?} item
     * @return {?}
     */
    SdsMenuComponent.prototype.removeItem = /**
     * Removes an item from the menu.
     * @param {?} item
     * @return {?}
     */
    function (item) {
        /** @type {?} */
        var index = this._items.indexOf(item);
        if (this._items.indexOf(item) > -1) {
            this._items.splice(index, 1);
        }
    };
    /** Handle a keyboard event from the menu */
    /**
     * Handle a keyboard event from the menu
     * @param {?} event
     * @return {?}
     */
    SdsMenuComponent.prototype._handleKeydown = /**
     * Handle a keyboard event from the menu
     * @param {?} event
     * @return {?}
     */
    function (event) {
        // tslint:disable-next-line: deprecation
        /** @type {?} */
        var keyCode = event.keyCode;
        /** @type {?} */
        var manager = this._keyManager;
        switch (keyCode) {
            case ESCAPE:
                this.closed.emit('keydown');
                break;
            case HOME:
            case END:
                if (!hasModifierKey(event)) {
                    keyCode === HOME
                        ? manager.setFirstItemActive()
                        : manager.setLastItemActive();
                    event.preventDefault();
                }
                break;
            default:
                if (keyCode === UP_ARROW || keyCode === DOWN_ARROW) {
                    manager.setFocusOrigin('keyboard');
                }
                manager.onKeydown(event);
        }
    };
    /** Starts the enter animation. */
    /**
     * Starts the enter animation.
     * @return {?}
     */
    SdsMenuComponent.prototype._startAnimation = /**
     * Starts the enter animation.
     * @return {?}
     */
    function () {
        this._panelAnimationState = 'enter';
    };
    /** Callback that is invoked when the panel animation completes. */
    /**
     * Callback that is invoked when the panel animation completes.
     * @param {?} event
     * @return {?}
     */
    SdsMenuComponent.prototype._onAnimationDone = /**
     * Callback that is invoked when the panel animation completes.
     * @param {?} event
     * @return {?}
     */
    function (event) { };
    /** Resets the panel animation to its initial state. */
    /**
     * Resets the panel animation to its initial state.
     * @return {?}
     */
    SdsMenuComponent.prototype._resetAnimation = /**
     * Resets the panel animation to its initial state.
     * @return {?}
     */
    function () {
        this._panelAnimationState = 'void';
    };
    /**
     * @param {?} event
     * @return {?}
     */
    SdsMenuComponent.prototype._onAnimationStart = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        // Scroll the content element to the top as soon as the animation starts.
        if (event.toState === 'enter' && this._keyManager.activeItemIndex === 0) {
            event.element.scrollTop = 0;
        }
    };
    SdsMenuComponent.decorators = [
        { type: Component, args: [{
                    selector: 'sds-menu',
                    exportAs: 'sdsMenu',
                    template: "<ng-template>\n  <div\n    class=\"sds-overlay minw-menu maxw-mobile radius-overlay\"\n    [ngClass]=\"_classList\"\n    (keydown)=\"_handleKeydown($event)\"\n    (click)=\"closed.emit('click')\"\n    [@transformMenu]=\"_panelAnimationState\"\n    (@transformMenu.start)=\"_onAnimationStart($event)\"\n    (@transformMenu.done)=\"_onAnimationDone($event)\"\n    tabindex=\"-1\"\n    role=\"menu\"\n  >\n    <div class=\"sds-menu\" [class.sds-menu--small]=\"size === 'sm'\">\n      <ng-content></ng-content>\n    </div>\n  </div>\n</ng-template>\n",
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    encapsulation: ViewEncapsulation.None,
                    animations: [sdsMenuAnimations.transformMenu],
                    providers: [
                        { provide: SDS_MENU_TOKEN, useExisting: SdsMenuComponent }
                    ]
                }] }
    ];
    /** @nocollapse */
    SdsMenuComponent.ctorParameters = function () { return [
        { type: ElementRef }
    ]; };
    SdsMenuComponent.propDecorators = {
        templateRef: [{ type: ViewChild, args: [TemplateRef,] }],
        size: [{ type: Input }],
        xPosition: [{ type: Input }],
        yPosition: [{ type: Input }],
        overlapTrigger: [{ type: Input }],
        panelClass: [{ type: Input, args: ['class',] }],
        closed: [{ type: Output }]
    };
    return SdsMenuComponent;
}());
export { SdsMenuComponent };
if (false) {
    /**
     * After | Before the menu triger element
     * @type {?}
     * @private
     */
    SdsMenuComponent.prototype._xPosition;
    /**
     * Above | Below the menu triger element
     * @type {?}
     * @private
     */
    SdsMenuComponent.prototype._yPosition;
    /**
     * Manage browser focus
     * @type {?}
     * @private
     */
    SdsMenuComponent.prototype._keyManager;
    /**
     * Menu items inside the current menu.
     * @type {?}
     * @private
     */
    SdsMenuComponent.prototype._items;
    /**
     * Subscription to tab events on the menu panel
     * @type {?}
     * @private
     */
    SdsMenuComponent.prototype._tabSubscription;
    /**
     * Stores <sds-menu> classes
     * @type {?}
     * @private
     */
    SdsMenuComponent.prototype._previousPanelClass;
    /**
     * Config object to be passed into the menu's ngClass
     * @type {?}
     */
    SdsMenuComponent.prototype._classList;
    /**
     * Current state of the panel animation.
     * @type {?}
     */
    SdsMenuComponent.prototype._panelAnimationState;
    /**
     * Grab the component template
     * @type {?}
     */
    SdsMenuComponent.prototype.templateRef;
    /**
     * Size of menu component.
     * Affects the font-size of the menu items and
     * the size of the close button in the menu header
     * @type {?}
     */
    SdsMenuComponent.prototype.size;
    /**
     * @type {?}
     * @private
     */
    SdsMenuComponent.prototype._overlapTrigger;
    /**
     * Event emitted when the menu is closed.
     * @type {?}
     */
    SdsMenuComponent.prototype.closed;
    /**
     * @type {?}
     * @private
     */
    SdsMenuComponent.prototype._elementRef;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVudS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NhLXNhbS9jb21wb25lbnRzLyIsInNvdXJjZXMiOlsibGliL21lbnUvbWVudS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFFTCx1QkFBdUIsRUFDdkIsU0FBUyxFQUNULFVBQVUsRUFDVixZQUFZLEVBQ1osY0FBYyxFQUNkLEtBQUssRUFFTCxNQUFNLEVBQ04sV0FBVyxFQUNYLFNBQVMsRUFDVCxpQkFBaUIsRUFFbEIsTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUNMLE1BQU0sRUFDTixVQUFVLEVBQ1YsUUFBUSxFQUNSLElBQUksRUFDSixHQUFHLEVBQ0gsY0FBYyxFQUNmLE1BQU0sdUJBQXVCLENBQUM7QUFDL0IsT0FBTyxFQUFFLGVBQWUsRUFBZSxNQUFNLG1CQUFtQixDQUFDO0FBQ2pFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQzlELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDcEMsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sbUJBQW1CLENBQUM7Ozs7O0FBWXRELE1BQU0sS0FBTyxjQUFjLEdBQUcsSUFBSSxjQUFjLENBQzlDLGdCQUFnQixDQUNqQjs7Ozs7O0FBR0Qsc0NBYUM7OztJQVpDLHFDQUF5Qjs7SUFDekIscUNBQXlCOztJQUN6QiwwQ0FBd0I7O0lBQ3hCLHVDQUE4Qjs7SUFDOUIsa0NBQXlEOztJQUN6RCxzQ0FBOEI7O0lBQzlCLGdDQUFpQjs7SUFDakIsMENBQStDOztJQUMvQyw4Q0FBa0U7O0lBQ2xFLG1DQUE0Qjs7SUFDNUIsc0NBQThDOztJQUM5QyxzQ0FBK0I7O0FBR2pDO0lBNEdFLDBCQUFvQixXQUFvQztRQUFwQyxnQkFBVyxHQUFYLFdBQVcsQ0FBeUI7Ozs7UUExRmhELGVBQVUsR0FBa0IsT0FBTyxDQUFDOzs7O1FBR3BDLGVBQVUsR0FBa0Is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O3lCQXdCYixNQUFNOztJQTRHVCx1QkFBQztDQUFBLEFBdE5ELElBc05DO1NBM01ZLGdCQUFnQjs7Ozs7OztJQU8zQixzQ0FBNEM7Ozs7OztJQUc1QyxzQ0FBNEM7Ozs7OztJQUc1Qyx1Q0FBMkQ7Ozs7OztJQUczRCxrQ0FBNEM7Ozs7OztJQUc1Qyw0Q0FBOEM7Ozs7OztJQUc5QywrQ0FBb0M7Ozs7O0lBR3BDLHNDQUE0Qzs7Ozs7SUFHNUMsZ0RBQWdEOzs7OztJQUdoRCx1Q0FBc0Q7Ozs7Ozs7SUFPdEQsZ0NBQXlCOzs7OztJQThCekIsMkNBQWdDOzs7OztJQTJCaEMsa0NBQTBFOzs7OztJQUU5RCx1Q0FBNEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBBZnRlckNvbnRlbnRJbml0LFxuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ29tcG9uZW50LFxuICBFbGVtZW50UmVmLFxuICBFdmVudEVtaXR0ZXIsXG4gIEluamVjdGlvblRva2VuLFxuICBJbnB1dCxcbiAgT25EZXN0cm95LFxuICBPdXRwdXQsXG4gIFRlbXBsYXRlUmVmLFxuICBWaWV3Q2hpbGQsXG4gIFZpZXdFbmNhcHN1bGF0aW9uLFxuICBPbkluaXRcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBBbmltYXRpb25FdmVudCB9IGZyb20gJ0Bhbmd1bGFyL2FuaW1hdGlvbnMnO1xuaW1wb3J0IHtcbiAgRVNDQVBFLFxuICBET1dOX0FSUk9XLFxuICBVUF9BUlJPVyxcbiAgSE9NRSxcbiAgRU5ELFxuICBoYXNNb2RpZmllcktleVxufSBmcm9tICdAYW5ndWxhci9jZGsva2V5Y29kZXMnO1xuaW1wb3J0IHsgRm9jdXNLZXlNYW5hZ2VyLCBGb2N1c09yaWdpbiB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9hMTF5JztcbmltcG9ydCB7IGNvZXJjZUJvb2xlYW5Qcm9wZXJ0eSB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9jb2VyY2lvbic7XG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IHNkc01lbnVBbmltYXRpb25zIH0gZnJvbSAnLi9tZW51LWFuaW1hdGlvbnMnO1xuaW1wb3J0IHsgU2RzTWVudUl0ZW1Db21wb25lbnQgfSBmcm9tICcuL21lbnUtaXRlbS5jb21wb25lbnQnO1xuXG4vKiogTWVudSBQb3NpdGlvbnMgKi9cbmV4cG9ydCB0eXBlIE1lbnVQb3NpdGlvblggPSAnYmVmb3JlJyB8ICdhZnRlcic7XG5leHBvcnQgdHlwZSBNZW51UG9zaXRpb25ZID0gJ2Fib3ZlJyB8ICdiZWxvdyc7XG5cbi8qKiBNZW51IGF2YWlsYWJsZSBzaXplcyAqL1xuLy8gc20gPSAnc21hbGwnXG5leHBvcnQgdHlwZSBNZW51U2l6ZXMgPSAnc20nO1xuXG4vKiogSW5qZWN0aW9uIHRva2VuIHVzZWQgdG8gcHJvdmlkZSB0aGUgcGFyZW50IG1lbnUgdG8gbWVudSBpdGVtcy4gKi9cbmV4cG9ydCBjb25zdCBTRFNfTUVOVV9UT0tFTiA9IG5ldyBJbmplY3Rpb25Ub2tlbjxTZHNNZW51SW50ZXJmYWNlPihcbiAgJ1NEU19NRU5VX1RPS0VOJ1xuKTtcblxuLyoqIE1lbnUgSW50ZXJmYWNlICovXG5leHBvcnQgaW50ZXJmYWNlIFNkc01lbnVJbnRlcmZhY2U8VCA9IGFueT4ge1xuICB4UG9zaXRpb246IE1lbnVQb3NpdGlvblg7XG4gIHlQb3NpdGlvbjogTWVudVBvc2l0aW9uWTtcbiAgb3ZlcmxhcFRyaWdnZXI6IGJvb2xlYW47XG4gIHRlbXBsYXRlUmVmOiBUZW1wbGF0ZVJlZjxhbnk+O1xuICBjbG9zZWQ6IEV2ZW50RW1pdHRlcjx2b2lkIHwgJ2NsaWNrJyB8ICdrZXlkb3duJyB8ICd0YWInPjtcbiAgcGFyZW50TWVudT86IFNkc01lbnVJbnRlcmZhY2U7XG4gIHNpemU/OiBNZW51U2l6ZXM7XG4gIGZvY3VzRmlyc3RJdGVtOiAob3JpZ2luPzogRm9jdXNPcmlnaW4pID0+IHZvaWQ7XG4gIHNldFBvc2l0aW9uQ2xhc3Nlcz86ICh4OiBNZW51UG9zaXRpb25YLCB5OiBNZW51UG9zaXRpb25ZKSA9PiB2b2lkO1xuICBhZGRJdGVtPzogKGl0ZW06IFQpID0+IHZvaWQ7XG4gIGluc2VydEl0ZW0/OiAoaXRlbTogVCwgaW5kZXg6IG51bWJlcikgPT4gdm9pZDtcbiAgcmVtb3ZlSXRlbT86IChpdGVtOiBUKSA9PiB2b2lkO1xufVxuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdzZHMtbWVudScsXG4gIGV4cG9ydEFzOiAnc2RzTWVudScsXG4gIHRlbXBsYXRlVXJsOiAnbWVudS5jb21wb25lbnQuaHRtbCcsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxuICBhbmltYXRpb25zOiBbc2RzTWVudUFuaW1hdGlvbnMudHJhbnNmb3JtTWVudV0sXG4gIHByb3ZpZGVyczogW1xuICAgIHsgcHJvdmlkZTogU0RTX01FTlVfVE9LRU4sIHVzZUV4aXN0aW5nOiBTZHNNZW51Q29tcG9uZW50IH1cbiAgXVxufSlcbmV4cG9ydCBjbGFzcyBTZHNNZW51Q29tcG9uZW50XG4gIGltcGxlbWVudHNcbiAgICBPbkluaXQsXG4gICAgQWZ0ZXJDb250ZW50SW5pdCxcbiAgICBPbkRlc3Ryb3ksXG4gICAgU2RzTWVudUludGVyZmFjZTxTZHNNZW51SXRlbUNvbXBvbmVudD4ge1xuICAvKiogQWZ0ZXIgfCBCZWZvcmUgdGhlIG1lbnUgdHJpZ2VyIGVsZW1lbnQgKi9cbiAgcHJpdmF0ZSBfeFBvc2l0aW9uOiBNZW51UG9zaXRpb25YID0gJ2FmdGVyJztcblxuICAvKiogQWJvdmUgfCBCZWxvdyB0aGUgbWVudSB0cmlnZXIgZWxlbWVudCAqL1xuICBwcml2YXRlIF95UG9zaXRpb246IE1lbnVQb3NpdGlvblkgPSAnYmVsb3cnO1xuXG4gIC8qKiBNYW5hZ2UgYnJvd3NlciBmb2N1cyAqL1xuICBwcml2YXRlIF9rZXlNYW5hZ2VyOiBGb2N1c0tleU1hbmFnZXI8U2RzTWVudUl0ZW1Db21wb25lbnQ+O1xuXG4gIC8qKiBNZW51IGl0ZW1zIGluc2lkZSB0aGUgY3VycmVudCBtZW51LiAqL1xuICBwcml2YXRlIF9pdGVtczogU2RzTWVudUl0ZW1Db21wb25lbnRbXSA9IFtdO1xuXG4gIC8qKiBTdWJzY3JpcHRpb24gdG8gdGFiIGV2ZW50cyBvbiB0aGUgbWVudSBwYW5lbCAqL1xuICBwcml2YXRlIF90YWJTdWJzY3JpcHRpb24gPSBTdWJzY3JpcHRpb24uRU1QVFk7XG5cbiAgLyoqIFN0b3JlcyA8c2RzLW1lbnU+IGNsYXNzZXMgKi9cbiAgcHJpdmF0ZSBfcHJldmlvdXNQYW5lbENsYXNzOiBzdHJpbmc7XG5cbiAgLyoqIENvbmZpZyBvYmplY3QgdG8gYmUgcGFzc2VkIGludG8gdGhlIG1lbnUncyBuZ0NsYXNzICovXG4gIF9jbGFzc0xpc3Q6IHsgW2tleTogc3RyaW5nXTogYm9vbGVhbiB9ID0ge307XG5cbiAgLyoqIEN1cnJlbnQgc3RhdGUgb2YgdGhlIHBhbmVsIGFuaW1hdGlvbi4gKi9cbiAgX3BhbmVsQW5pbWF0aW9uU3RhdGU6ICd2b2lkJyB8ICdlbnRlcicgPSAndm9pZCc7XG5cbiAgLyoqIEdyYWIgdGhlIGNvbXBvbmVudCB0ZW1wbGF0ZSAqL1xuICBAVmlld0NoaWxkKFRlbXBsYXRlUmVmKSB0ZW1wbGF0ZVJlZjogVGVtcGxhdGVSZWY8YW55PjtcblxuICAvKipcbiAgICogU2l6ZSBvZiBtZW51IGNvbXBvbmVudC5cbiAgICogQWZmZWN0cyB0aGUgZm9udC1zaXplIG9mIHRoZSBtZW51IGl0ZW1zIGFuZFxuICAgKiB0aGUgc2l6ZSBvZiB0aGUgY2xvc2UgYnV0dG9uIGluIHRoZSBtZW51IGhlYWRlclxuICAgKi9cbiAgQElucHV0KCkgc2l6ZTogTWVudVNpemVzO1xuXG4gIC8qKiBQb3NpdGlvbiBvZiB0aGUgbWVudSBpbiB0aGUgWCBheGlzLiAqL1xuICBASW5wdXQoKVxuICBnZXQgeFBvc2l0aW9uKCk6IE1lbnVQb3NpdGlvblgge1xuICAgIHJldHVybiB0aGlzLl94UG9zaXRpb247XG4gIH1cbiAgc2V0IHhQb3NpdGlvbih2YWx1ZTogTWVudVBvc2l0aW9uWCkge1xuICAgIHRoaXMuX3hQb3NpdGlvbiA9IHZhbHVlO1xuICAgIHRoaXMuc2V0UG9zaXRpb25DbGFzc2VzKCk7XG4gIH1cblxuICAvKiogUG9zaXRpb24gb2YgdGhlIG1lbnUgaW4gdGhlIFkgYXhpcy4gKi9cbiAgQElucHV0KClcbiAgZ2V0IHlQb3NpdGlvbigpOiBNZW51UG9zaXRpb25ZIHtcbiAgICByZXR1cm4gdGhpcy5feVBvc2l0aW9uO1xuICB9XG4gIHNldCB5UG9zaXRpb24odmFsdWU6IE1lbnVQb3NpdGlvblkpIHtcbiAgICB0aGlzLl95UG9zaXRpb24gPSB2YWx1ZTtcbiAgICB0aGlzLnNldFBvc2l0aW9uQ2xhc3NlcygpO1xuICB9XG5cbiAgLyoqIFdoZXRoZXIgbWVudSBwYW5lbCBvdmVybGFwcyB0cmlnZ2VyIGVsZW1lbnQgKi9cbiAgQElucHV0KClcbiAgZ2V0IG92ZXJsYXBUcmlnZ2VyKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLl9vdmVybGFwVHJpZ2dlcjtcbiAgfVxuICBzZXQgb3ZlcmxhcFRyaWdnZXIodmFsdWU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLl9vdmVybGFwVHJpZ2dlciA9IGNvZXJjZUJvb2xlYW5Qcm9wZXJ0eSh2YWx1ZSk7XG4gIH1cbiAgcHJpdmF0ZSBfb3ZlcmxhcFRyaWdnZXIgPSBmYWxzZTtcblxuICAvKiogVHJhbnNmZXIgY2xhc3NlcyBmcm9tIHRoZSBzZHMtbWVudSB0byB0aGUgb3ZlcmxheSBjb250YWluZXIgKi9cbiAgQElucHV0KCdjbGFzcycpXG4gIHNldCBwYW5lbENsYXNzKGNsYXNzZXM6IHN0cmluZykge1xuICAgIGNvbnN0IHByZXZpb3VzUGFuZWxDbGFzcyA9IHRoaXMuX3ByZXZpb3VzUGFuZWxDbGFzcztcbiAgICAvLyBSZW1vdmUgcHJldmlvdXMgY2xhc3NlcyBmcm9tIGN1cnJlbnQgc2V0IG9mIGNsYXNzZXNcbiAgICBpZiAocHJldmlvdXNQYW5lbENsYXNzICYmIHByZXZpb3VzUGFuZWxDbGFzcy5sZW5ndGgpIHtcbiAgICAgIHByZXZpb3VzUGFuZWxDbGFzcy5zcGxpdCgnICcpLmZvckVhY2goKGNsYXNzTmFtZTogc3RyaW5nKSA9PiB7XG4gICAgICAgIHRoaXMuX2NsYXNzTGlzdFtjbGFzc05hbWVdID0gZmFsc2U7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICB0aGlzLl9wcmV2aW91c1BhbmVsQ2xhc3MgPSBjbGFzc2VzO1xuXG4gICAgLy8gQWRkcyBuZXcgY2xhc3NlcyB0byBjdXJyZW50IHNldCBvZiBjbGFzc2VzXG4gICAgaWYgKGNsYXNzZXMgJiYgY2xhc3Nlcy5sZW5ndGgpIHtcbiAgICAgIGNsYXNzZXMuc3BsaXQoJyAnKS5mb3JFYWNoKChjbGFzc05hbWU6IHN0cmluZykgPT4ge1xuICAgICAgICB0aGlzLl9jbGFzc0xpc3RbY2xhc3NOYW1lXSA9IHRydWU7XG4gICAgICB9KTtcblxuICAgICAgLy8gUmVtb3ZlIGFsbCBjbGFzc2VzIGZyb20gPHNkcy1tZW51PlxuICAgICAgdGhpcy5fZWxlbWVudFJlZi5uYXRpdmVFbGVtZW50LmNsYXNzTmFtZSA9ICcnO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBFdmVudCBlbWl0dGVkIHdoZW4gdGhlIG1lbnUgaXMgY2xvc2VkLiAqL1xuICBAT3V0cHV0KCkgY2xvc2VkID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkIHwgJ2NsaWNrJyB8ICdrZXlkb3duJyB8ICd0YWInPigpO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgX2VsZW1lbnRSZWY6IEVsZW1lbnRSZWY8SFRNTEVsZW1lbnQ+KSB7fVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuc2V0UG9zaXRpb25DbGFzc2VzKCk7XG4gIH1cblxuICBuZ0FmdGVyQ29udGVudEluaXQoKSB7XG4gICAgdGhpcy5fa2V5TWFuYWdlciA9IG5ldyBGb2N1c0tleU1hbmFnZXI8U2RzTWVudUl0ZW1Db21wb25lbnQ+KFxuICAgICAgdGhpcy5faXRlbXNcbiAgICApLndpdGhXcmFwKCk7XG4gICAgdGhpcy5fdGFiU3Vic2NyaXB0aW9uID0gdGhpcy5fa2V5TWFuYWdlci50YWJPdXQuc3Vic2NyaWJlKCgpID0+XG4gICAgICB0aGlzLmNsb3NlZC5lbWl0KCd0YWInKVxuICAgICk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLl90YWJTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB0aGlzLmNsb3NlZC5jb21wbGV0ZSgpO1xuICB9XG5cbiAgLyoqIEZvY3VzIHRoZSBmaXJzdCBpdGVtIGluIHRoZSBtZW51ICovXG4gIGZvY3VzRmlyc3RJdGVtKG9yaWdpbjogRm9jdXNPcmlnaW4gPSAncHJvZ3JhbScpOiB2b2lkIHtcbiAgICB0aGlzLl9rZXlNYW5hZ2VyLnNldEZvY3VzT3JpZ2luKG9yaWdpbikuc2V0Rmlyc3RJdGVtQWN0aXZlKCk7XG4gIH1cblxuICAvKiogQWRkcyBjbGFzc2VzIHRvIHRoZSBtZW51IHBhbmVsIGJhc2VkIG9uIGl0cyBwb3NpdGlvbiAqL1xuICBzZXRQb3NpdGlvbkNsYXNzZXMoXG4gICAgcG9zWDogTWVudVBvc2l0aW9uWCA9IHRoaXMueFBvc2l0aW9uLFxuICAgIHBvc1k6IE1lbnVQb3NpdGlvblkgPSB0aGlzLnlQb3NpdGlvblxuICApIHtcbiAgICBjb25zdCBjbGFzc2VzID0gdGhpcy5fY2xhc3NMaXN0O1xuICAgIGNsYXNzZXNbJ3Nkcy1tZW51LWJlZm9yZSddID0gcG9zWCA9PT0gJ2JlZm9yZSc7XG4gICAgY2xhc3Nlc1snc2RzLW1lbnUtYWZ0ZXInXSA9IHBvc1ggPT09ICdhZnRlcic7XG4gICAgY2xhc3Nlc1snc2RzLW1lbnUtYWJvdmUnXSA9IHBvc1kgPT09ICdhYm92ZSc7XG4gICAgY2xhc3Nlc1snc2RzLW1lbnUtYmVsb3cnXSA9IHBvc1kgPT09ICdiZWxvdyc7XG4gIH1cblxuICAvKiogQWRkcyBhIG1lbnUgaXRlbSB3aXRoIHRoZSBtZW51LiAqL1xuICBhZGRJdGVtKGl0ZW06IFNkc01lbnVJdGVtQ29tcG9uZW50KSB7XG4gICAgaWYgKHRoaXMuX2l0ZW1zLmluZGV4T2YoaXRlbSkgPT09IC0xKSB7XG4gICAgICB0aGlzLl9pdGVtcy5wdXNoKGl0ZW0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBJbnNlcnRzIGEgbWVudSBpdGVtIGF0IGFuIGluZGV4ICovXG4gIGluc2VydEl0ZW0oaXRlbTogU2RzTWVudUl0ZW1Db21wb25lbnQsIGluZGV4OiBudW1iZXIpIHtcbiAgICBpZiAodGhpcy5faXRlbXMuaW5kZXhPZihpdGVtKSA9PT0gLTEgJiYgaW5kZXggPCB0aGlzLl9pdGVtcy5sZW5ndGgpIHtcbiAgICAgIHRoaXMuX2l0ZW1zLnNwbGljZShpbmRleCwgMCwgaXRlbSk7XG4gICAgfVxuICB9XG5cbiAgLyoqIFJlbW92ZXMgYW4gaXRlbSBmcm9tIHRoZSBtZW51LiAqL1xuICByZW1vdmVJdGVtKGl0ZW06IFNkc01lbnVJdGVtQ29tcG9uZW50KSB7XG4gICAgY29uc3QgaW5kZXggPSB0aGlzLl9pdGVtcy5pbmRleE9mKGl0ZW0pO1xuICAgIGlmICh0aGlzLl9pdGVtcy5pbmRleE9mKGl0ZW0pID4gLTEpIHtcbiAgICAgIHRoaXMuX2l0ZW1zLnNwbGljZShpbmRleCwgMSk7XG4gICAgfVxuICB9XG5cbiAgLyoqIEhhbmRsZSBhIGtleWJvYXJkIGV2ZW50IGZyb20gdGhlIG1lbnUgKi9cbiAgX2hhbmRsZUtleWRvd24oZXZlbnQ6IEtleWJvYXJkRXZlbnQpIHtcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IGRlcHJlY2F0aW9uXG4gICAgY29uc3Qga2V5Q29kZSA9IGV2ZW50LmtleUNvZGU7XG4gICAgY29uc3QgbWFuYWdlciA9IHRoaXMuX2tleU1hbmFnZXI7XG5cbiAgICBzd2l0Y2ggKGtleUNvZGUpIHtcbiAgICAgIGNhc2UgRVNDQVBFOlxuICAgICAgICB0aGlzLmNsb3NlZC5lbWl0KCdrZXlkb3duJyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBIT01FOlxuICAgICAgY2FzZSBFTkQ6XG4gICAgICAgIGlmICghaGFzTW9kaWZpZXJLZXkoZXZlbnQpKSB7XG4gICAgICAgICAga2V5Q29kZSA9PT0gSE9NRVxuICAgICAgICAgICAgPyBtYW5hZ2VyLnNldEZpcnN0SXRlbUFjdGl2ZSgpXG4gICAgICAgICAgICA6IG1hbmFnZXIuc2V0TGFzdEl0ZW1BY3RpdmUoKTtcbiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgaWYgKGtleUNvZGUgPT09IFVQX0FSUk9XIHx8IGtleUNvZGUgPT09IERPV05fQVJST1cpIHtcbiAgICAgICAgICBtYW5hZ2VyLnNldEZvY3VzT3JpZ2luKCdrZXlib2FyZCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgbWFuYWdlci5vbktleWRvd24oZXZlbnQpO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBTdGFydHMgdGhlIGVudGVyIGFuaW1hdGlvbi4gKi9cbiAgX3N0YXJ0QW5pbWF0aW9uKCkge1xuICAgIHRoaXMuX3BhbmVsQW5pbWF0aW9uU3RhdGUgPSAnZW50ZXInO1xuICB9XG5cbiAgLyoqIENhbGxiYWNrIHRoYXQgaXMgaW52b2tlZCB3aGVuIHRoZSBwYW5lbCBhbmltYXRpb24gY29tcGxldGVzLiAqL1xuICBfb25BbmltYXRpb25Eb25lKGV2ZW50OiBBbmltYXRpb25FdmVudCkge31cblxuICAvKiogUmVzZXRzIHRoZSBwYW5lbCBhbmltYXRpb24gdG8gaXRzIGluaXRpYWwgc3RhdGUuICovXG4gIF9yZXNldEFuaW1hdGlvbigpIHtcbiAgICB0aGlzLl9wYW5lbEFuaW1hdGlvblN0YXRlID0gJ3ZvaWQnO1xuICB9XG5cbiAgX29uQW5pbWF0aW9uU3RhcnQoZXZlbnQ6IEFuaW1hdGlvbkV2ZW50KSB7XG4gICAgLy8gU2Nyb2xsIHRoZSBjb250ZW50IGVsZW1lbnQgdG8gdGhlIHRvcCBhcyBzb29uIGFzIHRoZSBhbmltYXRpb24gc3RhcnRzLlxuICAgIGlmIChldmVudC50b1N0YXRlID09PSAnZW50ZXInICYmIHRoaXMuX2tleU1hbmFnZXIuYWN0aXZlSXRlbUluZGV4ID09PSAwKSB7XG4gICAgICBldmVudC5lbGVtZW50LnNjcm9sbFRvcCA9IDA7XG4gICAgfVxuICB9XG59XG4iXX0=