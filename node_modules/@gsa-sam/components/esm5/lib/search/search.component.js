/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ViewChild, ElementRef, Input, forwardRef, ChangeDetectionStrategy, ChangeDetectorRef } from '@angular/core';
import { FocusMonitor } from '@angular/cdk/a11y';
import { ViewportRuler } from '@angular/cdk/overlay';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
var SearchSettings = /** @class */ (function () {
    function SearchSettings() {
        this.placeholder = 'Search';
        this.dropdown = {
            placeholder: '-Select-',
            options: [],
            inverse: false
        };
    }
    return SearchSettings;
}());
export { SearchSettings };
if (false) {
    /** @type {?} */
    SearchSettings.prototype.placeholder;
    /** @type {?} */
    SearchSettings.prototype.size;
    /** @type {?} */
    SearchSettings.prototype.dropdown;
}
var SdsSearchComponent = /** @class */ (function () {
    function SdsSearchComponent(cd, focusMonitor, viewportRuler) {
        this.cd = cd;
        this.focusMonitor = focusMonitor;
        this.viewportRuler = viewportRuler;
        this.searchSettings = new SearchSettings();
        this.model = {};
        this.inputState = {
            initial: { visible: undefined },
            visible: undefined
        };
        this._onChange = (/**
         * @param {?} _
         * @return {?}
         */
        function (_) { });
        this._onTouched = (/**
         * @return {?}
         */
        function () { });
    }
    /**
     * @return {?}
     */
    SdsSearchComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.inputState.initial.visible = this.isInputVisible();
        this.inputState.visible = this.inputState.initial.visible;
        this.viewportRuler.change(0).subscribe((/**
         * @return {?}
         */
        function () {
            _this.inputState.initial.visible = _this.isInputVisible();
            _this.inputState.visible = _this.inputState.initial.visible;
        }));
    };
    /**
     * @return {?}
     */
    SdsSearchComponent.prototype.hasDropdown = /**
     * @return {?}
     */
    function () {
        if (this.searchSettings &&
            this.searchSettings.dropdown &&
            this.searchSettings.dropdown.options &&
            this.searchSettings.dropdown.options.length) {
            return true;
        }
        else {
            return false;
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    SdsSearchComponent.prototype.handleClick = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        event.preventDefault();
        if (!this.inputState.visible) {
            this.setInputVisibleStyles();
            this.focusMonitor.focusVia(this.inputEl, 'program');
        }
        else if (this.inputEl.nativeElement.value || this.selectEl.nativeElement.value) {
            this.model.searchText = this.inputEl.nativeElement.value;
            if (this.selectEl && this.selectEl.nativeElement.value) {
                this.model.searchCatergory = this.selectEl.nativeElement.value;
            }
            this._onChange(this.model);
        }
    };
    /**
     * @param {?} value
     * @return {?}
     */
    SdsSearchComponent.prototype.writeValue = /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        if (value && this.model !== value) {
            this.model = value;
            this.cd.markForCheck();
        }
        else {
            this.model = {};
            this.cd.markForCheck();
        }
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    SdsSearchComponent.prototype.registerOnTouched = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this._onTouched = fn;
    };
    /**
     * @param {?} fn
     * @return {?}
     */
    SdsSearchComponent.prototype.registerOnChange = /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this._onChange = fn;
    };
    /**
     * @return {?}
     */
    SdsSearchComponent.prototype.isInputVisible = /**
     * @return {?}
     */
    function () {
        return this.inputEl.nativeElement.getBoundingClientRect().width
            ? true
            : false;
    };
    /**
     * @return {?}
     */
    SdsSearchComponent.prototype.setInputVisibleStyles = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var inputWidth = this.calculateInputWidth();
        this.inputEl.nativeElement.style.display = 'block';
        this.inputEl.nativeElement.style.position = 'absolute';
        this.inputEl.nativeElement.style.left = "-" + inputWidth + "px";
        this.inputEl.nativeElement.style.width = inputWidth + "px";
        this.inputState.visible = true;
    };
    /**
     * @return {?}
     */
    SdsSearchComponent.prototype.removeInputVisibleStyles = /**
     * @return {?}
     */
    function () {
        this.inputEl.nativeElement.style.display = '';
        this.inputEl.nativeElement.style.position = '';
        this.inputEl.nativeElement.style.left = '';
        this.inputEl.nativeElement.style.width = '';
        this.inputState.visible = false;
    };
    /**
     * @param {?} event
     * @return {?}
     */
    SdsSearchComponent.prototype.focusChange = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (event === null && !this.inputState.initial.visible) {
            this.removeInputVisibleStyles();
        }
    };
    /**
     * @return {?}
     */
    SdsSearchComponent.prototype.calculateInputWidth = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var buttonElement = this.buttonEl.nativeElement;
        /** @type {?} */
        var inputElement = this.inputEl.nativeElement;
        /** @type {?} */
        var rightPosition = buttonElement.getBoundingClientRect().left;
        /** @type {?} */
        var leftPosition = this.parentSelector
            ? inputElement.closest(this.parentSelector).getBoundingClientRect().left
            : 0;
        return Math.floor(rightPosition - leftPosition);
    };
    /**
     * @return {?}
     */
    SdsSearchComponent.prototype.getClass = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var cls = this.searchSettings && this.searchSettings.size === 'large'
            ? 'usa-search--big'
            : 'usa-search--small';
        return this.searchSettings.dropdown && this.searchSettings.dropdown.inverse
            ? cls + " sds-inverse"
            : cls;
    };
    SdsSearchComponent.decorators = [
        { type: Component, args: [{
                    selector: 'sds-search',
                    template: "<form class=\"usa-form usa-search\" [ngClass]=\"getClass()\" role=\"search\">\n  <label class=\"usa-sr-only\" for=\"options\">Dropdown label</label>\n  <select *ngIf=\"hasDropdown()\" [value]=\"model.searchCategory? model.searchCategory :''\" #selectEl name=\"search options\"\n    class=\"usa-select\" id=\"search-options\">\n    <option [value]=\"\"> {{searchSettings.dropdown.placeholder ? searchSettings.dropdown.placeholder : '-Select-'}}</option>\n    <ng-container *ngFor=\"let item of searchSettings.dropdown.options\">\n      <optgroup *ngIf=\"item.group\" label=\"{{item.label}}\">\n        <option *ngFor=\"let child of item.group\" [value]=\"child.value\" [selected]=\"model.searchCategory == child.value\"\n          [disabled]=\"child.disabled\">\n          {{ child.label }}\n        </option>\n      </optgroup>\n      <option *ngIf=\"!item.group\" [value]=\"item.value\" [selected]=\"model.searchCategory == item.value\" [disabled]=\"item.disabled\">{{\n        item.label }}</option>\n    </ng-container>\n  </select>\n  <ng-container *ngIf=\"(searchSettings.dropdown && searchSettings.dropdown.inverse); then inverseTemplate else inputTemplate\">\n  </ng-container>\n</form>\n\n<ng-template #inputTemplate> <label class=\"usa-sr-only\" for=\"search-field\">Search</label>\n  <input #inputEl [value]=\"model.searchText? model.searchText :''\" [ngClass]=\"inputClass\" id=\"search-field\" type=\"search\" class=\"usa-input\"\n    name=\"search\" [placeholder]=\"searchSettings.placeholder? searchSettings.placeholder : 'type here'\" />\n  <button class=\"usa-button\" type=\"submit\"  (click)=\"handleClick($event)\">\n    <span class=\"usa-sr-only\">Search</span>\n  </button>\n</ng-template>\n<ng-template #inverseTemplate>\n  <div class=\"sds-inverse__search\">\n    <ng-container [ngTemplateOutlet]=\"inputTemplate\"></ng-container>\n  </div>\n</ng-template>",
                    providers: [
                        {
                            provide: NG_VALUE_ACCESSOR,
                            useExisting: forwardRef((/**
                             * @return {?}
                             */
                            function () { return SdsSearchComponent; })),
                            multi: true
                        }
                    ],
                    changeDetection: ChangeDetectionStrategy.OnPush
                }] }
    ];
    /** @nocollapse */
    SdsSearchComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef },
        { type: FocusMonitor },
        { type: ViewportRuler }
    ]; };
    SdsSearchComponent.propDecorators = {
        inputEl: [{ type: ViewChild, args: ['inputEl', { read: ElementRef },] }],
        selectEl: [{ type: ViewChild, args: ['selectEl', { read: ElementRef },] }],
        buttonEl: [{ type: ViewChild, args: ['buttonEl', { read: ElementRef },] }],
        inputClass: [{ type: Input }],
        parentSelector: [{ type: Input }],
        searchSettings: [{ type: Input }]
    };
    return SdsSearchComponent;
}());
export { SdsSearchComponent };
if (false) {
    /** @type {?} */
    SdsSearchComponent.prototype.inputEl;
    /** @type {?} */
    SdsSearchComponent.prototype.selectEl;
    /** @type {?} */
    SdsSearchComponent.prototype.buttonEl;
    /** @type {?} */
    SdsSearchComponent.prototype.inputClass;
    /** @type {?} */
    SdsSearchComponent.prototype.parentSelector;
    /** @type {?} */
    SdsSearchComponent.prototype.searchSettings;
    /** @type {?} */
    SdsSearchComponent.prototype.model;
    /** @type {?} */
    SdsSearchComponent.prototype.inputState;
    /**
     * @type {?}
     * @private
     */
    SdsSearchComponent.prototype._onChange;
    /**
     * @type {?}
     * @private
     */
    SdsSearchComponent.prototype._onTouched;
    /**
     * @type {?}
     * @private
     */
    SdsSearchComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    SdsSearchComponent.prototype.focusMonitor;
    /**
     * @type {?}
     * @private
     */
    SdsSearchComponent.prototype.viewportRuler;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VhcmNoLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc2Etc2FtL2NvbXBvbmVudHMvIiwic291cmNlcyI6WyJsaWIvc2VhcmNoL3NlYXJjaC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsU0FBUyxFQUNULFVBQVUsRUFDVixLQUFLLEVBRUwsVUFBVSxFQUNWLHVCQUF1QixFQUN2QixpQkFBaUIsRUFDbEIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2pELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNyRCxPQUFPLEVBQUUsaUJBQWlCLEVBQXdCLE1BQU0sZ0JBQWdCLENBQUM7QUFDekU7SUFBQTtRQUNTLGdCQUFXLEdBQUcsUUFBUSxDQUFDO1FBRXZCLGFBQVEsR0FBUTtZQUNyQixXQUFXLEVBQUUsVUFBVTtZQUN2QixPQUFPLEVBQUUsRUFBRTtZQUNYLE9BQU8sRUFBRSxLQUFLO1NBQ2YsQ0FBQztJQUNKLENBQUM7SUFBRCxxQkFBQztBQUFELENBQUMsQUFSRCxJQVFDOzs7O0lBUEMscUNBQThCOztJQUM5Qiw4QkFBb0I7O0lBQ3BCLGtDQUlFOztBQUVKO0lBNkJFLDRCQUNVLEVBQXFCLEVBQ3JCLFlBQTBCLEVBQzFCLGFBQTRCO1FBRjVCLE9BQUUsR0FBRixFQUFFLENBQW1CO1FBQ3JCLGlCQUFZLEdBQVosWUFBWSxDQUFjO1FBQzFCLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBYjdCLG1CQUFjLEdBQW1CLElBQUksY0FBYyxFQUFFLENBQUM7UUFFL0QsVUFBSyxHQUFRLEVBQUUsQ0FBQztRQUNoQixlQUFVLEdBQUc7WUFDWCxPQUFPLEVBQUUsRUFBRSxPQUFPLEVBQUUsU0FBUyxFQUFFO1lBQy9CLE9BQU8sRUFBRSxTQUFTO1NBQ25CLENBQUM7UUFDTSxjQUFTOzs7O1FBQUcs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Q2pELEtBQUssRUFBRSxJQUFJO3lCQUNaO3FCQUNGO29CQUNELGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNO2lCQUNoRDs7OztnQkF6QkMsaUJBQWlCO2dCQUVWLFlBQVk7Z0JBQ1osYUFBYTs7OzBCQXdCbkIsU0FBUyxTQUFDLFNBQVMsRUFBRSxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUU7MkJBQ3pDLFNBQVMsU0FBQyxVQUFVLEVBQUUsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFOzJCQUMxQyxTQUFTLFNBQUMsVUFBVSxFQUFFLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRTs2QkFFMUMsS0FBSztpQ0FDTCxLQUFLO2lDQUNMLEtBQUs7O0lBa0hSLHlCQUFDO0NBQUEsQUFySUQsSUFxSUM7U0F6SFksa0JBQWtCOzs7SUFDN0IscUNBQWdFOztJQUNoRSxzQ0FBa0U7O0lBQ2xFLHNDQUFrRTs7SUFFbEUsd0NBQTRCOztJQUM1Qiw0Q0FBZ0M7O0lBQ2hDLDRDQUErRDs7SUFFL0QsbUNBQWdCOztJQUNoQix3Q0FHRTs7Ozs7SUFDRix1Q0FBbUM7Ozs7O0lBQ25DLHdDQUE4Qjs7Ozs7SUFHNUIsZ0NBQTZCOzs7OztJQUM3QiwwQ0FBa0M7Ozs7O0lBQ2xDLDJDQUFvQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgVmlld0NoaWxkLFxuICBFbGVtZW50UmVmLFxuICBJbnB1dCxcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgZm9yd2FyZFJlZixcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENoYW5nZURldGVjdG9yUmVmXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRm9jdXNNb25pdG9yIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2ExMXknO1xuaW1wb3J0IHsgVmlld3BvcnRSdWxlciB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9vdmVybGF5JztcbmltcG9ydCB7IE5HX1ZBTFVFX0FDQ0VTU09SLCBDb250cm9sVmFsdWVBY2Nlc3NvciB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmV4cG9ydCBjbGFzcyBTZWFyY2hTZXR0aW5ncyB7XG4gIHB1YmxpYyBwbGFjZWhvbGRlciA9ICdTZWFyY2gnO1xuICBwdWJsaWMgc2l6ZTogc3RyaW5nO1xuICBwdWJsaWMgZHJvcGRvd246IGFueSA9IHtcbiAgICBwbGFjZWhvbGRlcjogJy1TZWxlY3QtJyxcbiAgICBvcHRpb25zOiBbXSxcbiAgICBpbnZlcnNlOiBmYWxzZVxuICB9O1xufVxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnc2RzLXNlYXJjaCcsXG4gIHRlbXBsYXRlVXJsOiAnc2VhcmNoLmNvbXBvbmVudC5odG1sJyxcbiAgcHJvdmlkZXJzOiBbXG4gICAge1xuICAgICAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXG4gICAgICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBTZHNTZWFyY2hDb21wb25lbnQpLFxuICAgICAgbXVsdGk6IHRydWVcbiAgICB9XG4gIF0sXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoXG59KVxuZXhwb3J0IGNsYXNzIFNkc1NlYXJjaENvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQsIENvbnRyb2xWYWx1ZUFjY2Vzc29yIHtcbiAgQFZpZXdDaGlsZCgnaW5wdXRFbCcsIHsgcmVhZDogRWxlbWVudFJlZiB9KSBpbnB1dEVsOiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKCdzZWxlY3RFbCcsIHsgcmVhZDogRWxlbWVudFJlZiB9KSBzZWxlY3RFbDogRWxlbWVudFJlZjtcbiAgQFZpZXdDaGlsZCgnYnV0dG9uRWwnLCB7IHJlYWQ6IEVsZW1lbnRSZWYgfSkgYnV0dG9uRWw6IEVsZW1lbnRSZWY7XG5cbiAgQElucHV0KCkgaW5wdXRDbGFzczogc3RyaW5nO1xuICBASW5wdXQoKSBwYXJlbnRTZWxlY3Rvcjogc3RyaW5nO1xuICBASW5wdXQoKSBzZWFyY2hTZXR0aW5nczogU2VhcmNoU2V0dGluZ3MgPSBuZXcgU2VhcmNoU2V0dGluZ3MoKTtcblxuICBtb2RlbDogYW55ID0ge307XG4gIGlucHV0U3RhdGUgPSB7XG4gICAgaW5pdGlhbDogeyB2aXNpYmxlOiB1bmRlZmluZWQgfSxcbiAgICB2aXNpYmxlOiB1bmRlZmluZWRcbiAgfTtcbiAgcHJpdmF0ZSBfb25DaGFuZ2UgPSAoXzogYW55KSA9PiB7fTtcbiAgcHJpdmF0ZSBfb25Ub3VjaGVkID0gKCkgPT4ge307XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgcHJpdmF0ZSBmb2N1c01vbml0b3I6IEZvY3VzTW9uaXRvcixcbiAgICBwcml2YXRlIHZpZXdwb3J0UnVsZXI6IFZpZXdwb3J0UnVsZXJcbiAgKSB7fVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICB0aGlzLmlucHV0U3RhdGUuaW5pdGlhbC52aXNpYmxlID0gdGhpcy5pc0lucHV0VmlzaWJsZSgpO1xuICAgIHRoaXMuaW5wdXRTdGF0ZS52aXNpYmxlID0gdGhpcy5pbnB1dFN0YXRlLmluaXRpYWwudmlzaWJsZTtcbiAgICB0aGlzLnZpZXdwb3J0UnVsZXIuY2hhbmdlKDApLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICB0aGlzLmlucHV0U3RhdGUuaW5pdGlhbC52aXNpYmxlID0gdGhpcy5pc0lucHV0VmlzaWJsZSgpO1xuICAgICAgdGhpcy5pbnB1dFN0YXRlLnZpc2libGUgPSB0aGlzLmlucHV0U3RhdGUuaW5pdGlhbC52aXNpYmxlO1xuICAgIH0pO1xuICB9XG5cbiAgaGFzRHJvcGRvd24oKSB7XG4gICAgaWYgKFxuICAgICAgdGhpcy5zZWFyY2hTZXR0aW5ncyAmJlxuICAgICAgdGhpcy5zZWFyY2hTZXR0aW5ncy5kcm9wZG93biAmJlxuICAgICAgdGhpcy5zZWFyY2hTZXR0aW5ncy5kcm9wZG93bi5vcHRpb25zICYmXG4gICAgICB0aGlzLnNlYXJjaFNldHRpbmdzLmRyb3Bkb3duLm9wdGlvbnMubGVuZ3RoXG4gICAgKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICBoYW5kbGVDbGljayhldmVudCkge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgaWYgKCF0aGlzLmlucHV0U3RhdGUudmlzaWJsZSkge1xuICAgICAgdGhpcy5zZXRJbnB1dFZpc2libGVTdHlsZXMoKTtcbiAgICAgIHRoaXMuZm9jdXNNb25pdG9yLmZvY3VzVmlhKHRoaXMuaW5wdXRFbCwgJ3Byb2dyYW0nKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMuaW5wdXRFbC5uYXRpdmVFbGVtZW50LnZhbHVlIHx8IHRoaXMuc2VsZWN0RWwubmF0aXZlRWxlbWVudC52YWx1ZSkge1xuICAgICAgdGhpcy5tb2RlbC5zZWFyY2hUZXh0ID0gdGhpcy5pbnB1dEVsLm5hdGl2ZUVsZW1lbnQudmFsdWU7XG4gICAgICBpZiAodGhpcy5zZWxlY3RFbCAmJiB0aGlzLnNlbGVjdEVsLm5hdGl2ZUVsZW1lbnQudmFsdWUpIHtcbiAgICAgICAgdGhpcy5tb2RlbC5zZWFyY2hDYXRlcmdvcnkgPSB0aGlzLnNlbGVjdEVsLm5hdGl2ZUVsZW1lbnQudmFsdWU7XG4gICAgICB9XG4gICAgICB0aGlzLl9vbkNoYW5nZSh0aGlzLm1vZGVsKTtcbiAgICB9XG4gIH1cblxuICB3cml0ZVZhbHVlKHZhbHVlOiBhbnkpIHtcbiAgICBpZiAodmFsdWUgJiYgdGhpcy5tb2RlbCAhPT0gdmFsdWUpIHtcbiAgICAgIHRoaXMubW9kZWwgPSB2YWx1ZTtcbiAgICAgIHRoaXMuY2QubWFya0ZvckNoZWNrKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubW9kZWwgPSB7fTtcbiAgICAgIHRoaXMuY2QubWFya0ZvckNoZWNrKCk7XG4gICAgfVxuICB9XG4gIHJlZ2lzdGVyT25Ub3VjaGVkKGZuOiBhbnkpIHtcbiAgICB0aGlzLl9vblRvdWNoZWQgPSBmbjtcbiAgfVxuICByZWdpc3Rlck9uQ2hhbmdlKGZuOiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLl9vbkNoYW5nZSA9IGZuO1xuICB9XG5cbiAgaXNJbnB1dFZpc2libGUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuaW5wdXRFbC5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoXG4gICAgICA/IHRydWVcbiAgICAgIDogZmFsc2U7XG4gIH1cblxuICBzZXRJbnB1dFZpc2libGVTdHlsZXMoKSB7XG4gICAgY29uc3QgaW5wdXRXaWR0aCA9IHRoaXMuY2FsY3VsYXRlSW5wdXRXaWR0aCgpO1xuICAgIHRoaXMuaW5wdXRFbC5uYXRpdmVFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuICAgIHRoaXMuaW5wdXRFbC5uYXRpdmVFbGVtZW50LnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJztcbiAgICB0aGlzLmlucHV0RWwubmF0aXZlRWxlbWVudC5zdHlsZS5sZWZ0ID0gYC0ke2lucHV0V2lkdGh9cHhgO1xuICAgIHRoaXMuaW5wdXRFbC5uYXRpdmVFbGVtZW50LnN0eWxlLndpZHRoID0gYCR7aW5wdXRXaWR0aH1weGA7XG4gICAgdGhpcy5pbnB1dFN0YXRlLnZpc2libGUgPSB0cnVlO1xuICB9XG5cbiAgcmVtb3ZlSW5wdXRWaXNpYmxlU3R5bGVzKCkge1xuICAgIHRoaXMuaW5wdXRFbC5uYXRpdmVFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnJztcbiAgICB0aGlzLmlucHV0RWwubmF0aXZlRWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9ICcnO1xuICAgIHRoaXMuaW5wdXRFbC5uYXRpdmVFbGVtZW50LnN0eWxlLmxlZnQgPSAnJztcbiAgICB0aGlzLmlucHV0RWwubmF0aXZlRWxlbWVudC5zdHlsZS53aWR0aCA9ICcnO1xuICAgIHRoaXMuaW5wdXRTdGF0ZS52aXNpYmxlID0gZmFsc2U7XG4gIH1cblxuICBmb2N1c0NoYW5nZShldmVudCkge1xuICAgIGlmIChldmVudCA9PT0gbnVsbCAmJiAhdGhpcy5pbnB1dFN0YXRlLmluaXRpYWwudmlzaWJsZSkge1xuICAgICAgdGhpcy5yZW1vdmVJbnB1dFZpc2libGVTdHlsZXMoKTtcbiAgICB9XG4gIH1cblxuICBjYWxjdWxhdGVJbnB1dFdpZHRoKCk6IG51bWJlciB7XG4gICAgY29uc3QgYnV0dG9uRWxlbWVudCA9IHRoaXMuYnV0dG9uRWwubmF0aXZlRWxlbWVudDtcbiAgICBjb25zdCBpbnB1dEVsZW1lbnQgPSB0aGlzLmlucHV0RWwubmF0aXZlRWxlbWVudDtcbiAgICBjb25zdCByaWdodFBvc2l0aW9uID0gYnV0dG9uRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5sZWZ0O1xuICAgIGNvbnN0IGxlZnRQb3NpdGlvbiA9IHRoaXMucGFyZW50U2VsZWN0b3JcbiAgICAgID8gaW5wdXRFbGVtZW50LmNsb3Nlc3QodGhpcy5wYXJlbnRTZWxlY3RvcikuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdFxuICAgICAgOiAwO1xuICAgIHJldHVybiBNYXRoLmZsb29yKHJpZ2h0UG9zaXRpb24gLSBsZWZ0UG9zaXRpb24pO1xuICB9XG4gIGdldENsYXNzKCkge1xuICAgIGNvbnN0IGNscyA9XG4gICAgICB0aGlzLnNlYXJjaFNldHRpbmdzICYmIHRoaXMuc2VhcmNoU2V0dGluZ3Muc2l6ZSA9PT0gJ2xhcmdlJ1xuICAgICAgICA/ICd1c2Etc2VhcmNoLS1iaWcnXG4gICAgICAgIDogJ3VzYS1zZWFyY2gtLXNtYWxsJztcbiAgICByZXR1cm4gdGhpcy5zZWFyY2hTZXR0aW5ncy5kcm9wZG93biAmJiB0aGlzLnNlYXJjaFNldHRpbmdzLmRyb3Bkb3duLmludmVyc2VcbiAgICAgID8gYCR7Y2xzfSBzZHMtaW52ZXJzZWBcbiAgICAgIDogY2xzO1xuICB9XG59XG4iXX0=