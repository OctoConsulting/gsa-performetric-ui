/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input, TemplateRef, forwardRef, HostListener, ChangeDetectorRef, ChangeDetectionStrategy } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { SDSSelectedItemModel } from '../selected-result/models/sds-selectedItem.model';
import { SDSAutocompletelConfiguration } from './models/SDSAutocompletelConfiguration.model';
import { SelectionMode } from '../selected-result/models/sds-selected-item-model-helper';
/** @type {?} */
var Autocomplete_VALUE_ACCESSOR = {
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef((/**
     * @return {?}
     */
    function () { return SDSAutocompleteComponent; })),
    multi: true
};
var SDSAutocompleteComponent = /** @class */ (function () {
    function SDSAutocompleteComponent(cd) {
        this.cd = cd;
        /**
         * Stored Event for ControlValueAccessor
         */
        this.onTouched = (/**
         * @return {?}
         */
        function () { });
        /**
         * Stored Event for ControlValueAccessor
         */
        this.onChange = (/**
         * @param {?} _
         * @return {?}
         */
        function (_) { });
    }
    // ControlValueAccessor (and Formly) is trying to update the value of the FormControl (our custom component) programatically
    // If there is a value we will just overwrite items
    // If there is no value we reset the items array to be empty
    // ControlValueAccessor (and Formly) is trying to update the value of the FormControl (our custom component) programatically
    // If there is a value we will just overwrite items
    // If there is no value we reset the items array to be empty
    /**
     * @param {?} value
     * @return {?}
     */
    SDSAutocompleteComponent.prototype.writeValue = 
    // ControlValueAccessor (and Formly) is trying to update the value of the FormControl (our custom component) programatically
    // If there is a value we will just overwrite items
    // If there is no value we reset the items array to be empty
    /**
     * @param {?} value
     * @return {?}
     */
    function (value) {
        if (value instanceof SDSSelectedItemModel && value.items && value.items.length && this.model.items !== value.items) {
            this.model.items = tslib_1.__spread(value.items);
            this.cd.markForCheck();
        }
        else if (value && value.length && this.model.items !== value) {
            this.model.items = value;
            this.cd.markForCheck();
        }
        else {
            if (!this.model || !(this.model instanceof SDSSelectedItemModel)) {
                this.model = new SDSSelectedItemModel();
            }
            this.model.items = value && value.items ? value.items : [];
            this.cd.markForCheck();
        }
    };
    // Method that is fired when the child component event notifies us that the items array has been modified within the child component
    // Method that is fired when the child component event notifies us that the items array has been modified within the child component
    /**
     * @param {?} $event
     * @return {?}
     */
    SDSAutocompleteComponent.prototype.updateItems = 
    // Method that is fired when the child component event notifies us that the items array has been modified within the child component
    /**
     * @param {?} $event
     * @return {?}
     */
    function ($event) {
        this.updateModel();
    };
    // Helper method that gets a new instance of the model and notifies ControlValueAccessor that we have a new model for this FormControl (our custom component)
    // Helper method that gets a new instance of the model and notifies ControlValueAccessor that we have a new model for this FormControl (our custom component)
    /**
     * @return {?}
     */
    SDSAutocompleteComponent.prototype.updateModel = 
    // Helper method that gets a new instance of the model and notifies ControlValueAccessor that we have a new model for this FormControl (our custom component)
    /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var model = this.getModel();
        this.onChange(model);
    };
    // Helper method to return a new instance of an array that contains our items
    // Helper method to return a new instance of an array that contains our items
    /**
     * @return {?}
     */
    SDSAutocompleteComponent.prototype.getModel = 
    // Helper method to return a new instance of an array that contains our items
    /**
     * @return {?}
     */
    function () {
        return tslib_1.__spread(this.model.items);
    };
    // ControlValueAccessor hook that lets us call this._onChange(var) to let the form know our variable has changed (in this case model)
    // ControlValueAccessor hook that lets us call this._onChange(var) to let the form know our variable has changed (in this case model)
    /**
     * @param {?} fn
     * @return {?}
     */
    SDSAutocompleteComponent.prototype.registerOnChange = 
    // ControlValueAccessor hook that lets us call this._onChange(var) to let the form know our variable has changed (in this case model)
    /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.onChange = fn;
    };
    // ControlValueAccessor hook (not used)
    // ControlValueAccessor hook (not used)
    /**
     * @param {?} fn
     * @return {?}
     */
    SDSAutocompleteComponent.prototype.registerOnTouched = 
    // ControlValueAccessor hook (not used)
    /**
     * @param {?} fn
     * @return {?}
     */
    function (fn) {
        this.onTouched = fn;
    };
    /**
     * @param {?} isDisabled
     * @return {?}
     */
    SDSAutocompleteComponent.prototype.setDisabledState = /**
     * @param {?} isDisabled
     * @return {?}
     */
    function (isDisabled) {
        this.disabled = isDisabled;
    };
    /**
     * @return {?}
     */
    SDSAutocompleteComponent.prototype.isSingleMode = /**
     * @return {?}
     */
    function () {
        if (this.configuration) {
            return this.configuration.selectionMode === SelectionMode.SINGLE;
        }
        else {
            return false;
        }
    };
    SDSAutocompleteComponent.decorators = [
        { type: Component, args: [{
                    selector: 'sds-autocomplete',
                    template: "<sds-search-autocomplete [disabled]=\"disabled\" (ngModelChange)=\"updateItems($event)\" #autocomplete\n    [service]=\"service\" [(ngModel)]=\"model\" [configuration]=\"configuration\" [itemTemplate]=\"suggestionTemplate\">\n</sds-search-autocomplete>\n<sds-selected-result (ngModelChange)=\"updateItems($event)\" [disabled]=\"disabled\" *ngIf=\"!isSingleMode()\"\n    [(ngModel)]=\"model\" [configuration]=\"configuration\" [itemTemplate]=\"selectedItemTemplate\"></sds-selected-result>\n",
                    providers: [Autocomplete_VALUE_ACCESSOR],
                    changeDetection: ChangeDetectionStrategy.OnPush,
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    SDSAutocompleteComponent.ctorParameters = function () { return [
        { type: ChangeDetectorRef }
    ]; };
    SDSAutocompleteComponent.propDecorators = {
        suggestionTemplate: [{ type: Input }],
        selectedItemTemplate: [{ type: Input }],
        configuration: [{ type: Input }],
        service: [{ type: Input }],
        onTouched: [{ type: HostListener, args: ['focusout',] }]
    };
    return SDSAutocompleteComponent;
}());
export { SDSAutocompleteComponent };
if (false) {
    /**
     * Allow to insert a customized template for suggestions results
     * @type {?}
     */
    SDSAutocompleteComponent.prototype.suggestionTemplate;
    /**
     * Allow to insert a customized template for selected items
     * @type {?}
     */
    SDSAutocompleteComponent.prototype.selectedItemTemplate;
    /**
     * The data model that has the selected item
     * @type {?}
     */
    SDSAutocompleteComponent.prototype.model;
    /** @type {?} */
    SDSAutocompleteComponent.prototype.disabled;
    /**
     * Configuration for the control
     * @type {?}
     */
    SDSAutocompleteComponent.prototype.configuration;
    /**
     * Instance of the SamHiercarchicalServiceInterface provided
     * @type {?}
     */
    SDSAutocompleteComponent.prototype.service;
    /**
     * Stored Event for ControlValueAccessor
     * @type {?}
     */
    SDSAutocompleteComponent.prototype.onTouched;
    /**
     * Stored Event for ControlValueAccessor
     * @type {?}
     */
    SDSAutocompleteComponent.prototype.onChange;
    /**
     * @type {?}
     * @private
     */
    SDSAutocompleteComponent.prototype.cd;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0b2NvbXBsZXRlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc2Etc2FtL2NvbXBvbmVudHMvIiwic291cmNlcyI6WyJsaWIvYXV0b2NvbXBsZXRlL2F1dG9jb21wbGV0ZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULEtBQUssRUFFTCxXQUFXLEVBRVgsVUFBVSxFQUNWLFlBQVksRUFDWixpQkFBaUIsRUFDakIsdUJBQXVCLEVBQ3hCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFDTCxpQkFBaUIsRUFHbEIsTUFBTSxnQkFBZ0IsQ0FBQztBQUN4QixPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxrREFBa0QsQ0FBQztBQUV4RixPQUFPLEVBQUUsNkJBQTZCLEVBQUUsTUFBTSw4Q0FBOEMsQ0FBQztBQUM3RixPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sMERBQTBELENBQUM7O0lBRW5GLDJCQUEyQixHQUFRO0lBQ3ZDLE9BQU8sRUFBRSxpQkFBaUI7SUFDMUIsV0FBVyxFQUFFLFVBQVU7OztJQUFDLGNBQU0sT0FBQSx3QkFBd0IsRUFBeEIsQ0FBd0IsRUFBQztJQUN2RCxLQUFLLEVBQUUsSUFBSTtDQUNaO0FBRUQ7SUFxQ0Usa0NBQW9CLEVBQXFCO1FBQXJCLE9BQUUsR0FBRixFQUFFLENBQW1COzs7O1FBTWxDLGNBQVM7OztRQUFHLGNBQVEsQ0FBQyxFQUFDOzs7O1FBS3RCLGFBQVE7Ozs7UUFBRyxVQUFDLENBQU0sSUFBTyxDQUFDLEVBQUM7SUFYVyxDQUFDO0lBYTlDLDRIQUE0SDtJQUM1SCxtREFBbUQ7SUFDbkQsNERBQTREOzs7Ozs7OztJQUM1RCw2Q0FBVTs7Ozs7Ozs7SUFBVixVQUFXLEtBQVU7UUFDbkIsSUFBSSxLQUFLLFlBQVksb0JBQW9CLElBQUksS0FBSyxDQUFDLEtBQUssSUFBSSxLQUFLLENBQUMsS0FBSyxDQUFDLE1BQU0sSUFBSSxJQUFJ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InNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgSW5wdXQsXG4gIFZpZXdDaGlsZCxcbiAgVGVtcGxhdGVSZWYsXG4gIEVsZW1lbnRSZWYsXG4gIGZvcndhcmRSZWYsXG4gIEhvc3RMaXN0ZW5lcixcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5XG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgTkdfVkFMVUVfQUNDRVNTT1IsXG4gIENvbnRyb2xWYWx1ZUFjY2Vzc29yLFxuICBGb3JtQ29udHJvbFxufSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBTRFNTZWxlY3RlZEl0ZW1Nb2RlbCB9IGZyb20gJy4uL3NlbGVjdGVkLXJlc3VsdC9tb2RlbHMvc2RzLXNlbGVjdGVkSXRlbS5tb2RlbCc7XG5pbXBvcnQgeyBTRFNBdXRvY29tcGxldGVTZXJ2aWNlSW50ZXJmYWNlIH0gZnJvbSAnLi4vYXV0b2NvbXBsZXRlLXNlYXJjaC9tb2RlbHMvU0RTQXV0b2NvbXBsZXRlU2VydmljZUludGVyZmFjZSc7XG5pbXBvcnQgeyBTRFNBdXRvY29tcGxldGVsQ29uZmlndXJhdGlvbiB9IGZyb20gJy4vbW9kZWxzL1NEU0F1dG9jb21wbGV0ZWxDb25maWd1cmF0aW9uLm1vZGVsJztcbmltcG9ydCB7IFNlbGVjdGlvbk1vZGUgfSBmcm9tICcuLi9zZWxlY3RlZC1yZXN1bHQvbW9kZWxzL3Nkcy1zZWxlY3RlZC1pdGVtLW1vZGVsLWhlbHBlcic7XG5cbmNvbnN0IEF1dG9jb21wbGV0ZV9WQUxVRV9BQ0NFU1NPUjogYW55ID0ge1xuICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcbiAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gU0RTQXV0b2NvbXBsZXRlQ29tcG9uZW50KSxcbiAgbXVsdGk6IHRydWVcbn07XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3Nkcy1hdXRvY29tcGxldGUnLFxuICB0ZW1wbGF0ZVVybDogJy4vYXV0b2NvbXBsZXRlLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vYXV0b2NvbXBsZXRlLmNvbXBvbmVudC5zY3NzJ10sXG4gIHByb3ZpZGVyczogW0F1dG9jb21wbGV0ZV9WQUxVRV9BQ0NFU1NPUl0sXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoXG59KVxuZXhwb3J0IGNsYXNzIFNEU0F1dG9jb21wbGV0ZUNvbXBvbmVudCBpbXBsZW1lbnRzIENvbnRyb2xWYWx1ZUFjY2Vzc29yIHtcbiAgLyoqXG4gICAqIEFsbG93IHRvIGluc2VydCBhIGN1c3RvbWl6ZWQgdGVtcGxhdGUgZm9yIHN1Z2dlc3Rpb25zIHJlc3VsdHNcbiAgICovXG4gIEBJbnB1dCgpIHN1Z2dlc3Rpb25UZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PjtcblxuICAvKipcbiAgICogQWxsb3cgdG8gaW5zZXJ0IGEgY3VzdG9taXplZCB0ZW1wbGF0ZSBmb3Igc2VsZWN0ZWQgaXRlbXNcbiAgICovXG4gIEBJbnB1dCgpIHNlbGVjdGVkSXRlbVRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+O1xuXG4gIC8qKlxuICAgKiBUaGUgZGF0YSBtb2RlbCB0aGF0IGhhcyB0aGUgc2VsZWN0ZWQgaXRlbVxuICAgKi9cbiAgcHVibGljIG1vZGVsOiBTRFNTZWxlY3RlZEl0ZW1Nb2RlbDtcblxuICBwdWJsaWMgZGlzYWJsZWQ6IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIENvbmZpZ3VyYXRpb24gZm9yIHRoZSBjb250cm9sXG4gICAqL1xuICBASW5wdXQoKVxuICBwdWJsaWMgY29uZmlndXJhdGlvbjogU0RTQXV0b2NvbXBsZXRlbENvbmZpZ3VyYXRpb247XG5cbiAgLyoqXG4gICAqIEluc3RhbmNlIG9mIHRoZSBTYW1IaWVyY2FyY2hpY2FsU2VydmljZUludGVyZmFjZSBwcm92aWRlZFxuICAgKi9cbiAgQElucHV0KClcbiAgcHVibGljIHNlcnZpY2U6IFNEU0F1dG9jb21wbGV0ZVNlcnZpY2VJbnRlcmZhY2U7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYpIHsgfVxuXG4gIC8qKlxuICAgKiBTdG9yZWQgRXZlbnQgZm9yIENvbnRyb2xWYWx1ZUFjY2Vzc29yXG4gICAqL1xuICBASG9zdExpc3RlbmVyKCdmb2N1c291dCcpXG4gIHB1YmxpYyBvblRvdWNoZWQgPSAoKSA9PiB7IH07XG5cbiAgLyoqXG4gICAqIFN0b3JlZCBFdmVudCBmb3IgQ29udHJvbFZhbHVlQWNjZXNzb3JcbiAgICovXG4gIHB1YmxpYyBvbkNoYW5nZSA9IChfOiBhbnkpID0+IHsgfTtcblxuICAvLyBDb250cm9sVmFsdWVBY2Nlc3NvciAoYW5kIEZvcm1seSkgaXMgdHJ5aW5nIHRvIHVwZGF0ZSB0aGUgdmFsdWUgb2YgdGhlIEZvcm1Db250cm9sIChvdXIgY3VzdG9tIGNvbXBvbmVudCkgcHJvZ3JhbWF0aWNhbGx5XG4gIC8vIElmIHRoZXJlIGlzIGEgdmFsdWUgd2Ugd2lsbCBqdXN0IG92ZXJ3cml0ZSBpdGVtc1xuICAvLyBJZiB0aGVyZSBpcyBubyB2YWx1ZSB3ZSByZXNldCB0aGUgaXRlbXMgYXJyYXkgdG8gYmUgZW1wdHlcbiAgd3JpdGVWYWx1ZSh2YWx1ZTogYW55KSB7XG4gICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgU0RTU2VsZWN0ZWRJdGVtTW9kZWwgJiYgdmFsdWUuaXRlbXMgJiYgdmFsdWUuaXRlbXMubGVuZ3RoICYmIHRoaXMubW9kZWwuaXRlbXMgIT09IHZhbHVlLml0ZW1zKSB7XG4gICAgICB0aGlzLm1vZGVsLml0ZW1zID0gWy4uLnZhbHVlLml0ZW1zXTtcbiAgICAgIHRoaXMuY2QubWFya0ZvckNoZWNrKCk7XG4gICAgfVxuICAgIGVsc2UgaWYodmFsdWUgJiYgdmFsdWUubGVuZ3RoICYmIHRoaXMubW9kZWwuaXRlbXMgIT09IHZhbHVlKSB7XG4gICAgICB0aGlzLm1vZGVsLml0ZW1zID0gdmFsdWU7XG4gICAgICB0aGlzLmNkLm1hcmtGb3JDaGVjaygpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZighdGhpcy5tb2RlbCB8fCAhKHRoaXMubW9kZWwgaW5zdGFuY2VvZiBTRFNTZWxlY3RlZEl0ZW1Nb2RlbCkpIHtcbiAgICAgICAgdGhpcy5tb2RlbCA9IG5ldyBTRFNTZWxlY3RlZEl0ZW1Nb2RlbCgpO1xuICAgICAgfVxuICAgICAgdGhpcy5tb2RlbC5pdGVtcyA9IHZhbHVlICYmIHZhbHVlLml0ZW1zID8gdmFsdWUuaXRlbXMgOiBbXTtcbiAgICAgIHRoaXMuY2QubWFya0ZvckNoZWNrKCk7XG4gICAgfVxuICB9XG5cbiAgLy8gTWV0aG9kIHRoYXQgaXMgZmlyZWQgd2hlbiB0aGUgY2hpbGQgY29tcG9uZW50IGV2ZW50IG5vdGlmaWVzIHVzIHRoYXQgdGhlIGl0ZW1zIGFycmF5IGhhcyBiZWVuIG1vZGlmaWVkIHdpdGhpbiB0aGUgY2hpbGQgY29tcG9uZW50XG4gIHVwZGF0ZUl0ZW1zKCRldmVudCkge1xuICAgIHRoaXMudXBkYXRlTW9kZWwoKTtcbiAgfVxuXG4gIC8vIEhlbHBlciBtZXRob2QgdGhhdCBnZXRzIGEgbmV3IGluc3RhbmNlIG9mIHRoZSBtb2RlbCBhbmQgbm90aWZpZXMgQ29udHJvbFZhbHVlQWNjZXNzb3IgdGhhdCB3ZSBoYXZlIGEgbmV3IG1vZGVsIGZvciB0aGlzIEZvcm1Db250cm9sIChvdXIgY3VzdG9tIGNvbXBvbmVudClcbiAgdXBkYXRlTW9kZWwoKSB7XG4gICAgY29uc3QgbW9kZWwgPSB0aGlzLmdldE1vZGVsKCk7XG4gICAgdGhpcy5vbkNoYW5nZShtb2RlbCk7XG4gIH1cblxuICAvLyBIZWxwZXIgbWV0aG9kIHRvIHJldHVybiBhIG5ldyBpbnN0YW5jZSBvZiBhbiBhcnJheSB0aGF0IGNvbnRhaW5zIG91ciBpdGVtc1xuICBnZXRNb2RlbCgpIHtcbiAgICByZXR1cm4gWy4uLnRoaXMubW9kZWwuaXRlbXNdO1xuICB9XG5cbiAgLy8gQ29udHJvbFZhbHVlQWNjZXNzb3IgaG9vayB0aGF0IGxldHMgdXMgY2FsbCB0aGlzLl9vbkNoYW5nZSh2YXIpIHRvIGxldCB0aGUgZm9ybSBrbm93IG91ciB2YXJpYWJsZSBoYXMgY2hhbmdlZCAoaW4gdGhpcyBjYXNlIG1vZGVsKVxuICByZWdpc3Rlck9uQ2hhbmdlKGZuOiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLm9uQ2hhbmdlID0gZm47XG4gIH1cblxuICAvLyBDb250cm9sVmFsdWVBY2Nlc3NvciBob29rIChub3QgdXNlZClcbiAgcmVnaXN0ZXJPblRvdWNoZWQoZm46IGFueSkge1xuICAgIHRoaXMub25Ub3VjaGVkID0gZm47XG4gIH1cblxuICBzZXREaXNhYmxlZFN0YXRlKGlzRGlzYWJsZWQ6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICB0aGlzLmRpc2FibGVkID0gaXNEaXNhYmxlZDtcbiAgfVxuXG4gIGlzU2luZ2xlTW9kZSgpOiBib29sZWFuIHtcbiAgICBpZiAodGhpcy5jb25maWd1cmF0aW9uKSB7XG4gICAgICByZXR1cm4gdGhpcy5jb25maWd1cmF0aW9uLnNlbGVjdGlvbk1vZGUgPT09IFNlbGVjdGlvbk1vZGUuU0lOR0xFO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG59Il19