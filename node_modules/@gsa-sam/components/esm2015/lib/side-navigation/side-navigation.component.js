/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, ViewChild, TemplateRef } from '@angular/core';
import { SideNavigationModel } from './model/side-navigation-model';
import { NavigationMode } from '../common-navigation/common-navigation-model';
import { NavigationHelper } from '../common-navigation/navigation-helper';
export class SdsSideNavigationComponent {
    constructor() {
        /**
         * Navigation helper
         */
        this.navigationHelper = new NavigationHelper();
        /**
         * event for event based
         */
        this.linkEvent = new EventEmitter();
    }
    /**
     * Takes the navigation item and returns the template to be used
     * @param {?} item navigation item
     * @return {?}
     */
    getItemTemplate(item) {
        /** @type {?} */
        let template = null;
        switch (item.mode) {
            case NavigationMode.EVENT:
                template = this.sideNavEVENTLinkTemplate;
                break;
            case NavigationMode.EXTERNAL:
                template = this.sideNavHREFLinkTemplate;
                break;
            case NavigationMode.INTERNAL:
                template = this.sideNavRouteLinkTemplate;
                break;
            case NavigationMode.LABEL:
                template = this.sideNavLabelLinkTemplate;
                break;
            default:
                template = null;
                break;
        }
        return template;
    }
    /**
     * Selects new item and parents and deselects previous
     * @param {?} id
     * @return {?}
     */
    select(id) {
        this.deselect();
        for (let i = 0; i < this.model.navigationLinks.length; i++) {
            /** @type {?} */
            let item = this.model.navigationLinks[i];
            this.selectItem(id, item, null);
        }
    }
    /**
     * Selects item if matches passed in id and will select parent
     * @private
     * @param {?} id
     * @param {?} item
     * @param {?} parent
     * @return {?}
     */
    selectItem(id, item, parent) {
        if (item.id === id) {
            item.selected = true;
            if (parent) {
                parent.selected = true;
            }
        }
        else {
            if (item.children) {
                for (let i = 0; i < item.children.length; i++) {
                    /** @type {?} */
                    let childItem = item.children[i];
                    this.selectItem(id, childItem, item);
                }
                if (item.selected) {
                    if (parent) {
                        parent.selected = true;
                    }
                }
            }
        }
    }
    /**
     * Deselects all the items in the side navigation model
     * @return {?}
     */
    deselect() {
        if (this.model) {
            if (this.model.navigationLinks) {
                for (let i = 0; i < this.model.navigationLinks.length; i++) {
                    this.deselectItem(this.model.navigationLinks[i]);
                }
            }
        }
    }
    /**
     * checks if item is selected and if selcted will check children and will unselect
     * @private
     * @param {?} item
     * @return {?}
     */
    deselectItem(item) {
        if (item.selected) {
            item.selected = false;
            if (item.children) {
                for (let i = 0; i < item.children.length; i++) {
                    this.deselectItem(item.children[i]);
                }
            }
        }
    }
    /**
     * Link clicked and emits the link data into an event
     * @param {?} link
     * @return {?}
     */
    linkClickEvent(link) {
        this.linkEvent.emit(link);
        return false;
    }
    /**
     * creates url from provided route and query params
     * @param {?} item
     * @return {?}
     */
    urlBuilder(item) {
        /** @type {?} */
        let url = item.route;
        /** @type {?} */
        let queryParams = this.queryStringBuilder(item);
        if (queryParams) {
            if (url.indexOf('?') === -1) {
                url += '?' + queryParams;
            }
            else if (url.indexOf('?') === url.length - 1) {
                url += queryParams;
            }
            else {
                url += '&' + queryParams;
            }
        }
        return url;
    }
    /**
     * creates query string
     * @private
     * @param {?} item
     * @return {?}
     */
    queryStringBuilder(item) {
        /** @type {?} */
        const ret = [];
        for (let d in item.queryParams) {
            ret.push(encodeURIComponent(d) + '=' + encodeURIComponent(item.queryParams[d]));
        }
        return ret.join('&');
    }
}
SdsSideNavigationComponent.decorators = [
    { type: Component, args: [{
                selector: 'sds-side-navigation',
                template: "<nav>\n    <ul class=\"usa-sidenav\">\n        <li *ngFor=\"let link of model.navigationLinks\" class=\"sidenav__item\">\n            <ng-container [ngTemplateOutlet]=\"sideNavLinkTemplate\" [ngTemplateOutletContext]=\"{$implicit:link}\">\n            </ng-container>\n        </li>\n    </ul>\n</nav>\n\n<ng-template #sideNavLinkTemplate let-link>\n    <ng-container [ngTemplateOutlet]=\"getItemTemplate(link)\" [ngTemplateOutletContext]=\"{$implicit:link}\">\n    </ng-container>\n    <ul *ngIf=\"link.children\" class=\"usa-sidenav__sublist\">\n        <li *ngFor=\"let link of link.children\" class=\"sidenav__item\">\n            <ng-container [ngTemplateOutlet]=\"sideNavLinkTemplate\" [ngTemplateOutletContext]=\"{$implicit:link}\">\n            </ng-container>\n        </li>\n    </ul>\n</ng-template>\n\n<ng-template #sideNavRouteLinkTemplate let-link>\n    <a [attr.class]=\"link.selected ? ' usa-current' : ''\" [routerLink]=\"[link.route]\"\n        [queryParams]=\"link.queryParams\"><span>{{link.text}}</span></a>\n</ng-template>\n\n<ng-template #sideNavHREFLinkTemplate let-link>\n    <a [attr.class]=\"link.selected ? ' usa-current' : ''\" [attr.href]=\"urlBuilder(link)\"><span>{{link.text}}</span></a>\n</ng-template>\n\n<ng-template #sideNavLabelLinkTemplate let-link>\n    <span [attr.class]=\"link.selected ? ' usa-current' : ''\"><span>{{link.text}}</span></span>\n</ng-template>\n\n<ng-template #sideNavEVENTLinkTemplate let-link>\n    <a [attr.class]=\"link.selected ? ' usa-current' : ''\" href=\"javascript:void(0)\"\n        (click)=\"linkClickEvent(link)\"><span>{{link.text}}</span></a>\n</ng-template>",
                styles: [""]
            }] }
];
SdsSideNavigationComponent.propDecorators = {
    sideNavRouteLinkTemplate: [{ type: ViewChild, args: ['sideNavRouteLinkTemplate',] }],
    sideNavLabelLinkTemplate: [{ type: ViewChild, args: ['sideNavLabelLinkTemplate',] }],
    sideNavHREFLinkTemplate: [{ type: ViewChild, args: ['sideNavHREFLinkTemplate',] }],
    sideNavEVENTLinkTemplate: [{ type: ViewChild, args: ['sideNavEVENTLinkTemplate',] }],
    model: [{ type: Input }],
    linkEvent: [{ type: Output }]
};
if (false) {
    /**
     * Reference to the the Template used for internal links
     * @type {?}
     * @private
     */
    SdsSideNavigationComponent.prototype.sideNavRouteLinkTemplate;
    /**
     * Reference to the the Template used for side menu items that are a label
     * @type {?}
     * @private
     */
    SdsSideNavigationComponent.prototype.sideNavLabelLinkTemplate;
    /**
     * Reference to the the Template used for external href
     * @type {?}
     * @private
     */
    SdsSideNavigationComponent.prototype.sideNavHREFLinkTemplate;
    /**
     * Reference to the the Template used for event response
     * @type {?}
     * @private
     */
    SdsSideNavigationComponent.prototype.sideNavEVENTLinkTemplate;
    /**
     * Navigation helper
     * @type {?}
     */
    SdsSideNavigationComponent.prototype.navigationHelper;
    /**
     * Model used for the different display portions of the side navigation
     * @type {?}
     */
    SdsSideNavigationComponent.prototype.model;
    /**
     * event for event based
     * @type {?}
     */
    SdsSideNavigationComponent.prototype.linkEvent;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2lkZS1uYXZpZ2F0aW9uLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc2Etc2FtL2NvbXBvbmVudHMvIiwic291cmNlcyI6WyJsaWIvc2lkZS1uYXZpZ2F0aW9uL3NpZGUtbmF2aWdhdGlvbi5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMvRixPQUFPLEVBQUUsbUJBQW1CLEVBQWtCLE1BQU0sK0JBQStCLENBQUM7QUFDcEYsT0FBTyxFQUFtQixjQUFjLEVBQUUsTUFBTSw4Q0FBOEMsQ0FBQztBQUMvRixPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQztBQU8xRSxNQUFNLE9BQU8sMEJBQTBCO0lBTHZDOzs7O1FBNERFLHFCQUFnQixHQUFHLElBQUksZ0JBQWdCLEVBQUUsQ0FBQzs7OztRQThFMUMsY0FBUyxHQUFHLElBQUksWUFBWSxFQUFtQixDQUFDO0lBeUNsRCxDQUFDOzs7Ozs7SUFoSkMsZUFBZSxDQUFDLElBQW9COztZQUM5QixRQUFRLEdBQUcsSUFBSTtRQUNuQixRQUFRLElBQUksQ0FBQyxJQUFJLEVBQUU7WUFDakIsS0FBSyxjQUFjLENBQUMsS0FBSztnQkFDdkIsUUFBUSxHQUFHLElBQUksQ0FBQyx3QkFBd0IsQ0FBQztnQkFDekMsTUFBTTtZQUNSLEtBQUssY0FBYyxDQUFDLFFBQVE7Z0JBQzFCLFFBQVEsR0FBRyxJQUFJLENBQUMsdUJBQXVCLENBQUM7Z0JBQ3hDLE1BQU07WUFDUixLQUFLLGNBQWMsQ0FBQyxRQUFRO2dCQUMxQixRQUFRLEdBQUcsSUFBSSxDQUFDLHdCQUF3QixDQUFDO2dCQUN6QyxNQUFNO1lBQ1IsS0FBSyxjQUFjLENBQUMsS0FBSztnQkFDdkIsUUFBUSxHQUFHLElBQUksQ0FBQyx3QkFBd0Is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Q29tcG9uZW50LCBJbnB1dCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIsIFZpZXdDaGlsZCwgVGVtcGxhdGVSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFNpZGVOYXZpZ2F0aW9uTW9kZWwsIE5hdmlnYXRpb25MaW5rIH0gZnJvbSAnLi9tb2RlbC9zaWRlLW5hdmlnYXRpb24tbW9kZWwnO1xuaW1wb3J0IHsgSU5hdmlnYXRpb25MaW5rLCBOYXZpZ2F0aW9uTW9kZSB9IGZyb20gJy4uL2NvbW1vbi1uYXZpZ2F0aW9uL2NvbW1vbi1uYXZpZ2F0aW9uLW1vZGVsJztcbmltcG9ydCB7IE5hdmlnYXRpb25IZWxwZXIgfSBmcm9tICcuLi9jb21tb24tbmF2aWdhdGlvbi9uYXZpZ2F0aW9uLWhlbHBlcic7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3Nkcy1zaWRlLW5hdmlnYXRpb24nLFxuICB0ZW1wbGF0ZVVybDogJy4vc2lkZS1uYXZpZ2F0aW9uLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vc2lkZS1uYXZpZ2F0aW9uLmNvbXBvbmVudC5zY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgU2RzU2lkZU5hdmlnYXRpb25Db21wb25lbnQge1xuXG4gIC8qKlxuICAgKiBSZWZlcmVuY2UgdG8gdGhlIHRoZSBUZW1wbGF0ZSB1c2VkIGZvciBpbnRlcm5hbCBsaW5rc1xuICAgKi9cbiAgQFZpZXdDaGlsZCgnc2lkZU5hdlJvdXRlTGlua1RlbXBsYXRlJylcbiAgcHJpdmF0ZSBzaWRlTmF2Um91dGVMaW5rVGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT47XG5cbiAgLyoqXG4gICAqIFJlZmVyZW5jZSB0byB0aGUgdGhlIFRlbXBsYXRlIHVzZWQgZm9yIHNpZGUgbWVudSBpdGVtcyB0aGF0IGFyZSBhIGxhYmVsXG4gICAqL1xuICBAVmlld0NoaWxkKCdzaWRlTmF2TGFiZWxMaW5rVGVtcGxhdGUnKVxuICBwcml2YXRlIHNpZGVOYXZMYWJlbExpbmtUZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PjtcblxuICAvKipcbiAgICogUmVmZXJlbmNlIHRvIHRoZSB0aGUgVGVtcGxhdGUgdXNlZCBmb3IgZXh0ZXJuYWwgaHJlZiBcbiAgICovXG4gIEBWaWV3Q2hpbGQoJ3NpZGVOYXZIUkVGTGlua1RlbXBsYXRlJylcbiAgcHJpdmF0ZSBzaWRlTmF2SFJFRkxpbmtUZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PjtcblxuICAvKipcbiAgICogUmVmZXJlbmNlIHRvIHRoZSB0aGUgVGVtcGxhdGUgdXNlZCBmb3IgZXZlbnQgcmVzcG9uc2VcbiAgICovXG4gIEBWaWV3Q2hpbGQoJ3NpZGVOYXZFVkVOVExpbmtUZW1wbGF0ZScpXG4gIHByaXZhdGUgc2lkZU5hdkVWRU5UTGlua1RlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+O1xuXG4gIC8qKlxuICAgKiBUYWtlcyB0aGUgbmF2aWdhdGlvbiBpdGVtIGFuZCByZXR1cm5zIHRoZSB0ZW1wbGF0ZSB0byBiZSB1c2VkXG4gICAqIEBwYXJhbSBpdGVtIG5hdmlnYXRpb24gaXRlbVxuICAgKi9cbiAgZ2V0SXRlbVRlbXBsYXRlKGl0ZW06IE5hdmlnYXRpb25MaW5rKTogVGVtcGxhdGVSZWY8YW55PiB7XG4gICAgbGV0IHRlbXBsYXRlID0gbnVsbDtcbiAgICBzd2l0Y2ggKGl0ZW0ubW9kZSkge1xuICAgICAgY2FzZSBOYXZpZ2F0aW9uTW9kZS5FVkVOVDpcbiAgICAgICAgdGVtcGxhdGUgPSB0aGlzLnNpZGVOYXZFVkVOVExpbmtUZW1wbGF0ZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIE5hdmlnYXRpb25Nb2RlLkVYVEVSTkFMOlxuICAgICAgICB0ZW1wbGF0ZSA9IHRoaXMuc2lkZU5hdkhSRUZMaW5rVGVtcGxhdGU7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBOYXZpZ2F0aW9uTW9kZS5JTlRFUk5BTDpcbiAgICAgICAgdGVtcGxhdGUgPSB0aGlzLnNpZGVOYXZSb3V0ZUxpbmtUZW1wbGF0ZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIE5hdmlnYXRpb25Nb2RlLkxBQkVMOlxuICAgICAgICB0ZW1wbGF0ZSA9IHRoaXMuc2lkZU5hdkxhYmVsTGlua1RlbXBsYXRlO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRlbXBsYXRlID0gbnVsbDtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIHJldHVybiB0ZW1wbGF0ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBOYXZpZ2F0aW9uIGhlbHBlclxuICAgKi9cbiAgbmF2aWdhdGlvbkhlbHBlciA9IG5ldyBOYXZpZ2F0aW9uSGVscGVyKCk7XG5cbiAgLyoqXG4gICAqIE1vZGVsIHVzZWQgZm9yIHRoZSBkaWZmZXJlbnQgZGlzcGxheSBwb3J0aW9ucyBvZiB0aGUgc2lkZSBuYXZpZ2F0aW9uIFxuICAgKi9cbiAgQElucHV0KCkgbW9kZWw6IFNpZGVOYXZpZ2F0aW9uTW9kZWw7XG5cbiAgLyoqXG4gICAqIFNlbGVjdHMgbmV3IGl0ZW0gYW5kIHBhcmVudHMgYW5kIGRlc2VsZWN0cyBwcmV2aW91c1xuICAgKiBAcGFyYW0gaWQgXG4gICAqL1xuICBzZWxlY3QoaWQ6IHN0cmluZykge1xuICAgIHRoaXMuZGVzZWxlY3QoKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubW9kZWwubmF2aWdhdGlvbkxpbmtzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBsZXQgaXRlbSA9IHRoaXMubW9kZWwubmF2aWdhdGlvbkxpbmtzW2ldO1xuICAgICAgdGhpcy5zZWxlY3RJdGVtKGlkLCBpdGVtLCBudWxsKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2VsZWN0cyBpdGVtIGlmIG1hdGNoZXMgcGFzc2VkIGluIGlkIGFuZCB3aWxsIHNlbGVjdCBwYXJlbnRcbiAgICogQHBhcmFtIGlkIFxuICAgKiBAcGFyYW0gaXRlbSBcbiAgICogQHBhcmFtIHBhcmVudCBcbiAgICovXG4gIHByaXZhdGUgc2VsZWN0SXRlbShpZDogc3RyaW5nLCBpdGVtOiBOYXZpZ2F0aW9uTGluaywgcGFyZW50OiBOYXZpZ2F0aW9uTGluaykge1xuICAgIGlmIChpdGVtLmlkID09PSBpZCkge1xuICAgICAgaXRlbS5zZWxlY3RlZCA9IHRydWU7XG4gICAgICBpZiAocGFyZW50KSB7XG4gICAgICAgIHBhcmVudC5zZWxlY3RlZCA9IHRydWU7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChpdGVtLmNoaWxkcmVuKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaXRlbS5jaGlsZHJlbi5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGxldCBjaGlsZEl0ZW0gPSBpdGVtLmNoaWxkcmVuW2ldO1xuICAgICAgICAgIHRoaXMuc2VsZWN0SXRlbShpZCwgY2hpbGRJdGVtLCBpdGVtKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXRlbS5zZWxlY3RlZCkge1xuICAgICAgICAgIGlmIChwYXJlbnQpIHtcbiAgICAgICAgICAgIHBhcmVudC5zZWxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cblxuICAvKipcbiAgICogRGVzZWxlY3RzIGFsbCB0aGUgaXRlbXMgaW4gdGhlIHNpZGUgbmF2aWdhdGlvbiBtb2RlbFxuICAgKi9cbiAgZGVzZWxlY3QoKSB7XG4gICAgaWYgKHRoaXMubW9kZWwpIHtcbiAgICAgIGlmICh0aGlzLm1vZGVsLm5hdmlnYXRpb25MaW5rcykge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubW9kZWwubmF2aWdhdGlvbkxpbmtzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgdGhpcy5kZXNlbGVjdEl0ZW0odGhpcy5tb2RlbC5uYXZpZ2F0aW9uTGlua3NbaV0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIGNoZWNrcyBpZiBpdGVtIGlzIHNlbGVjdGVkIGFuZCBpZiBzZWxjdGVkIHdpbGwgY2hlY2sgY2hpbGRyZW4gYW5kIHdpbGwgdW5zZWxlY3RcbiAgICovXG4gIHByaXZhdGUgZGVzZWxlY3RJdGVtKGl0ZW06IE5hdmlnYXRpb25MaW5rKSB7XG4gICAgaWYgKGl0ZW0uc2VsZWN0ZWQpIHtcbiAgICAgIGl0ZW0uc2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgIGlmIChpdGVtLmNoaWxkcmVuKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaXRlbS5jaGlsZHJlbi5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIHRoaXMuZGVzZWxlY3RJdGVtKGl0ZW0uY2hpbGRyZW5baV0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIGV2ZW50IGZvciBldmVudCBiYXNlZFxuICAgKi9cbiAgQE91dHB1dCgpXG4gIGxpbmtFdmVudCA9IG5ldyBFdmVudEVtaXR0ZXI8SU5hdmlnYXRpb25MaW5rPigpO1xuXG4gIC8qKlxuICAgKiBMaW5rIGNsaWNrZWQgYW5kIGVtaXRzIHRoZSBsaW5rIGRhdGEgaW50byBhbiBldmVudFxuICAgKiBAcGFyYW0gbGluayBcbiAgICovXG4gIGxpbmtDbGlja0V2ZW50KGxpbms6IElOYXZpZ2F0aW9uTGluaykge1xuICAgIHRoaXMubGlua0V2ZW50LmVtaXQobGluayk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIGNyZWF0ZXMgdXJsIGZyb20gcHJvdmlkZWQgcm91dGUgYW5kIHF1ZXJ5IHBhcmFtc1xuICAgKiBAcGFyYW0gaXRlbSBcbiAgICovXG4gIHVybEJ1aWxkZXIoaXRlbTogTmF2aWdhdGlvbkxpbmspIHtcbiAgICBsZXQgdXJsID0gaXRlbS5yb3V0ZTtcbiAgICBsZXQgcXVlcnlQYXJhbXMgPSB0aGlzLnF1ZXJ5U3RyaW5nQnVpbGRlcihpdGVtKTtcbiAgICBpZiAocXVlcnlQYXJhbXMpIHtcbiAgICAgIGlmICh1cmwuaW5kZXhPZignPycpID09PSAtMSkge1xuICAgICAgICB1cmwgKz0gJz8nICsgcXVlcnlQYXJhbXM7XG4gICAgICB9IGVsc2UgaWYgKHVybC5pbmRleE9mKCc/JykgPT09IHVybC5sZW5ndGggLSAxKSB7XG4gICAgICAgIHVybCArPSBxdWVyeVBhcmFtcztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHVybCArPSAnJicgKyBxdWVyeVBhcmFtcztcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHVybDtcbiAgfVxuXG4gIC8qKlxuICAgKiBjcmVhdGVzIHF1ZXJ5IHN0cmluZ1xuICAgKiBAcGFyYW0gaXRlbSBcbiAgICovXG4gIHByaXZhdGUgcXVlcnlTdHJpbmdCdWlsZGVyKGl0ZW06IE5hdmlnYXRpb25MaW5rKSB7XG4gICAgY29uc3QgcmV0ID0gW107XG4gICAgZm9yIChsZXQgZCBpbiBpdGVtLnF1ZXJ5UGFyYW1zKSB7XG4gICAgICByZXQucHVzaChlbmNvZGVVUklDb21wb25lbnQoZCkgKyAnPScgKyBlbmNvZGVVUklDb21wb25lbnQoaXRlbS5xdWVyeVBhcmFtc1tkXSkpO1xuICAgIH1cbiAgICByZXR1cm4gcmV0LmpvaW4oJyYnKTtcbiAgfVxufVxuIl19