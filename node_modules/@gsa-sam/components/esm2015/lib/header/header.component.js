/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, ViewChild, ElementRef, HostListener } from '@angular/core';
import { NavigationHelper } from '../common-navigation/navigation-helper';
export class SdsHeaderComponent {
    constructor() {
        this.mobileNavActive = false;
        /**
         * Navigation helper
         */
        this.navigationHelper = new NavigationHelper();
        /**
         * determines if the top banner is shown
         */
        this.showTopBanner = true;
        this.topBannerDescription = '';
        /**
         * event for event based
         */
        this.linkEvent = new EventEmitter();
    }
    /**
     * Takes in a text string and removes all white space characters and returns the new string
     * @param {?} text
     * @return {?}
     */
    removeWhiteSpace(text) {
        return text.replace(/ /g, '');
    }
    /**
     * seeif any secondary link has a counter
     * @return {?}
     */
    hasCounter() {
        /** @type {?} */
        let hasCounter = false;
        if (this.model) {
            if (this.model.secondaryLinks) {
                this.model.secondaryLinks.forEach((/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) {
                    if (item.hasCounter) {
                        hasCounter = true;
                    }
                }));
            }
        }
        return hasCounter;
    }
    /**
     * Deselects previous seletion
     * @param {?} id
     * @return {?}
     */
    select(id) {
        this.deselect();
        /** @type {?} */
        let item = this.find(id);
        if (item) {
            item.selected = true;
        }
    }
    /**
     * Deselects all the items in the header model
     * @return {?}
     */
    deselect() {
        if (this.model) {
            if (this.model.home) {
                this.model.home.selected = false;
            }
            if (this.model.navigationLinks) {
                this.model.navigationLinks.forEach((/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) {
                    item.selected = false;
                    if (item.children) {
                        item.children.forEach((/**
                         * @param {?} child
                         * @return {?}
                         */
                        function (child) {
                            child.selected = false;
                        }));
                    }
                }));
            }
            if (this.model.secondaryLinks) {
                this.model.secondaryLinks.forEach((/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) {
                    item.selected = false;
                }));
            }
        }
    }
    /**
     * Finds the navigation element by id in the header model
     * @param {?} id of the navigation item
     * @return {?}
     */
    find(id) {
        /** @type {?} */
        let toReturn = null;
        if (this.model) {
            if (this.model.home) {
                if (this.model.home.id === id) {
                    toReturn = this.model.home;
                }
            }
            toReturn = this.findNavigationLinks(id, toReturn);
            if (this.model.secondaryLinks) {
                this.model.secondaryLinks.forEach((/**
                 * @param {?} item
                 * @return {?}
                 */
                function (item) {
                    if (item.id === id) {
                        toReturn = item;
                    }
                }));
            }
        }
        return toReturn;
    }
    /**
     * Searchs the items in the navigation links
     * @private
     * @param {?} id
     * @param {?} toReturn
     * @return {?}
     */
    findNavigationLinks(id, toReturn) {
        if (this.model.navigationLinks) {
            this.model.navigationLinks.forEach((/**
             * @param {?} item
             * @return {?}
             */
            function (item) {
                if (item.id === id) {
                    toReturn = item;
                }
                if (item.children) {
                    item.children.forEach((/**
                     * @param {?} child
                     * @return {?}
                     */
                    function (child) {
                        if (child.id === id) {
                            toReturn = child;
                        }
                    }));
                }
            }));
        }
        return toReturn;
    }
    /**
     * Link clicked and emits the link data into an event
     * @param {?} link
     * @return {?}
     */
    linkClickEvent(link) {
        this.linkEvent.emit(link);
        return false;
    }
    // When the mobile nav is active, and the close box isn't visible,
    // we know the user's viewport has been resized to be larger.
    // Let's make the page state consistent by deactivating the mobile nav.
    /**
     * @param {?} event
     * @return {?}
     */
    onBrowserResize(event) {
        if (this.mobileNavActive &&
            this.closeNavBtn.nativeElement.getBoundingClientRect().width === 0) {
            this.mobileNavActive = false;
        }
    }
    /**
     * @return {?}
     */
    openMobileNav() {
        this.mobileNavActive = true;
    }
    /**
     * @return {?}
     */
    closeMobileNav() {
        this.mobileNavActive = false;
        // The mobile nav was just deactivated, and focus was on the close
        // button, which is no longer visible. We don't want the focus to
        // disappear into the void, so focus on the menu button if it's
        // visible (this may have been what the user was just focused on,
        // if they triggered the mobile nav by mistake).
        this.openNavBtn.nativeElement.focus();
    }
    // The mobile nav was just activated, so focus on the close button,
    /**
     * @return {?}
     */
    navAnimationEnd() {
        this.closeNavBtn.nativeElement.focus();
    }
}
SdsHeaderComponent.decorators = [
    { type: Component, args: [{
                selector: 'sds-header',
                template: "<sds-top-banner *ngIf=\"showTopBanner\" \n[description]=\"topBannerDescription\"\n></sds-top-banner>\n<div\n  class=\"usa-overlay\"\n  [class.is-visible]=\"mobileNavActive\"\n  (click)=\"closeMobileNav()\"\n></div>\n<header class=\"usa-header usa-header--extended\">\n  <div class=\"usa-navbar\">\n    <div class=\"usa-logo\" id=\"extended-logo\">\n      <ng-container\n        [ngTemplateOutlet]=\"\n          navigationHelper.isLinkInternal(model.home)\n            ? homeLinkRouteTemplate\n            : homeLinkHREFTemplate\n        \"\n        [ngTemplateOutletContext]=\"{ $implicit: model.home }\"\n      ></ng-container>\n    </div>\n    <button #usaNavOpen class=\"usa-menu-btn\" (click)=\"openMobileNav()\">\n      <fa-layers [fixedWidth]=\"true\" size=\"3x\">\n        <fa-icon\n          [icon]=\"['fas', 'square']\"\n          [classes]=\"['text-primary']\"\n        ></fa-icon>\n        <fa-icon\n          [icon]=\"['sds', 'bars']\"\n          [classes]=\"['icon-bars']\"\n          transform=\"shrink-6\"\n        ></fa-icon>\n        <fa-layers-counter\n          *ngIf=\"hasCounter()\"\n          [classes]=\"['icon-layers-counter']\"\n        ></fa-layers-counter>\n      </fa-layers>\n      <span class=\"usa-sr-only\">Menu</span>\n    </button>\n  </div>\n  <nav\n    aria-label=\"Primary navigation\"\n    class=\"usa-nav\"\n    (keydown.esc)=\"closeMobileNav()\"\n    (animationend)=\"navAnimationEnd()\"\n    [class.is-visible]=\"mobileNavActive\"\n    [cdkTrapFocus]=\"mobileNavActive\"\n  >\n    <div class=\"usa-nav__inner\">\n      <button #usaNavClose class=\"usa-nav__close\" (click)=\"closeMobileNav()\">\n        <fa-layers [fixedWidth]=\"true\" size=\"lg\">\n          <fa-icon\n            [icon]=\"['fas', 'circle']\"\n            [inverse]=\"true\"\n            transform=\"grow-2\"\n          ></fa-icon>\n          <fa-icon [icon]=\"['fas', 'times']\" transform=\"shrink-6\"></fa-icon>\n        </fa-layers>\n        <span class=\"usa-sr-only\">Close</span>\n      </button>\n      <ul class=\"usa-nav__primary usa-accordion\">\n        <li\n          *ngFor=\"let link of model.navigationLinks\"\n          class=\"usa-nav__primary-item\"\n        >\n          <ng-container\n            [ngTemplateOutlet]=\"link.route ? linkTemplate : dropDownTemplate\"\n            [ngTemplateOutletContext]=\"{ $implicit: link }\"\n          ></ng-container>\n        </li>\n      </ul>\n      <div class=\"usa-nav__secondary\">\n        <ul class=\"usa-nav__secondary-links\">\n          <li\n            *ngFor=\"let link of model.secondaryLinks\"\n            class=\"usa-nav__secondary-item\"\n          >\n            <ng-container\n              [ngTemplateOutlet]=\"\n                navigationHelper.isLinkInternal(link)\n                  ? secondaryRouteLinkTemplate\n                  : navigationHelper.isLinkExternal(link)\n                  ? secondaryHREFLinkTemplate\n                  : secondaryEVENTLinkTemplate\n              \"\n              [ngTemplateOutletContext]=\"{ $implicit: link }\"\n            ></ng-container>\n          </li>\n        </ul>\n      </div>\n    </div>\n  </nav>\n</header>\n<ng-template #homeLinkRouteTemplate let-home>\n  <a [routerLink]=\"home.route\" title=\"Home\" aria-label=\"Home\">\n    <img class=\"sds-header__logo\" [src]=\"home.logo\" [alt]=\"home.text\" />\n  </a>\n</ng-template>\n\n<ng-template #homeLinkHREFTemplate let-home>\n  <a [attr.href]=\"home.route\" title=\"Home\" aria-label=\"Home\">\n    <img class=\"sds-header__logo\" [src]=\"home.logo\" [alt]=\"home.text\" />\n  </a>\n</ng-template>\n\n<ng-template #secondaryRouteLinkTemplate let-link>\n  <a\n    [attr.id]=\"link.id\"\n    [routerLink]=\"[link.route]\"\n    [attr.class]=\"link.selected ? 'usa-current' : ''\"\n  >\n    <ng-container\n      [ngTemplateOutlet]=\"iconLinkTemplate\"\n      [ngTemplateOutletContext]=\"{ $implicit: link }\"\n    >\n    </ng-container>\n  </a>\n</ng-template>\n\n<ng-template #secondaryHREFLinkTemplate let-link>\n  <a\n    [attr.id]=\"link.id\"\n    [attr.href]=\"[link.route]\"\n    [attr.class]=\"link.selected ? 'usa-current' : ''\"\n  >\n    <ng-container\n      [ngTemplateOutlet]=\"iconLinkTemplate\"\n      [ngTemplateOutletContext]=\"{ $implicit: link }\"\n    >\n    </ng-container>\n  </a>\n</ng-template>\n\n<ng-template #secondaryEVENTLinkTemplate let-link>\n  <a\n    [attr.id]=\"link.id\"\n    (click)=\"linkClickEvent(link)\"\n    href=\"javascript:void(0)\"\n    [attr.class]=\"link.selected ? 'usa-current' : ''\"\n  >\n    <ng-container\n      [ngTemplateOutlet]=\"iconLinkTemplate\"\n      [ngTemplateOutletContext]=\"{ $implicit: link }\"\n    >\n    </ng-container>\n  </a>\n</ng-template>\n\n<ng-template #iconLinkTemplate let-link>\n  <fa-layers [fixedWidth]=\"true\">\n    <fa-icon [icon]=\"[link.imageClassPrefix, link.imageClass]\"></fa-icon>\n    <fa-layers-counter\n      *ngIf=\"link.hasCounter\"\n      [classes]=\"['icon-layers-counter']\"\n    ></fa-layers-counter>\n  </fa-layers>\n  <span class=\"sds-nav__secondary-item-text\">{{ link.text }}</span>\n</ng-template>\n\n<ng-template #linkTemplate let-link>\n  <ng-container\n    [ngTemplateOutlet]=\"\n      navigationHelper.isLinkInternal(link)\n        ? linkRouteTemplate\n        : navigationHelper.isLinkExternal(link)\n        ? linkHREFTemplate\n        : linkEventTemplate\n    \"\n    [ngTemplateOutletContext]=\"{ $implicit: link }\"\n  ></ng-container>\n</ng-template>\n\n<ng-template #linkRouteTemplate let-link>\n  <a\n    [attr.id]=\"link.id\"\n    [attr.class]=\"link.selected ? 'usa-nav__link usa-current' : 'usa-nav__link'\"\n    [routerLink]=\"[link.route]\"\n    ><span>{{ link.text }}</span></a\n  >\n</ng-template>\n\n<ng-template #linkHREFTemplate let-link>\n  <a\n    [attr.id]=\"link.id\"\n    [attr.class]=\"link.selected ? 'usa-nav__link usa-current' : 'usa-nav__link'\"\n    [attr.href]=\"[link.route]\"\n    ><span>{{ link.text }}</span></a\n  >\n</ng-template>\n\n<ng-template #linkEventTemplate let-link>\n  <a\n    [attr.id]=\"link.id\"\n    [attr.class]=\"link.selected ? 'usa-nav__link usa-current' : 'usa-nav__link'\"\n    href=\"javascript:void(0)\"\n    (click)=\"linkClickEvent(link)\"\n    ><span>{{ link.text }}</span></a\n  >\n</ng-template>\n\n<ng-template #dropDownTemplate let-link>\n  <button\n    [attr.id]=\"link.id\"\n    [attr.class]=\"\n      link.selected\n        ? 'usa-accordion__button usa-nav__link usa-current'\n        : 'usa-accordion__button usa-nav__link'\n    \"\n    aria-expanded=\"false\"\n    [attr.aria-controls]=\"removeWhiteSpace(link.text) + '-section'\"\n  >\n    <span>{{ link.text }}</span>\n  </button>\n  <ul\n    [attr.id]=\"removeWhiteSpace(link.text) + '-section'\"\n    class=\"usa-nav__submenu\"\n    hidden\n  >\n    <li *ngFor=\"let childLink of link.children\" class=\"usa-nav__submenu-item\">\n      <ng-container\n        [ngTemplateOutlet]=\"\n          navigationHelper.isLinkInternal(childLink)\n            ? dropDownRouteLinkTemplate\n            : navigationHelper.isLinkExternal(childLink)\n            ? dropDownHREFLinkTemplate\n            : dropDownEVENTLinkTemplate\n        \"\n        [ngTemplateOutletContext]=\"{ $implicit: childLink }\"\n      ></ng-container>\n    </li>\n  </ul>\n</ng-template>\n\n<ng-template #dropDownRouteLinkTemplate let-childLink>\n  <a [routerLink]=\"[childLink.route]\">{{ childLink.text }}</a>\n</ng-template>\n\n<ng-template #dropDownHREFLinkTemplate let-childLink>\n  <a [attr.href]=\"[childLink.route]\">{{ childLink.text }}</a>\n</ng-template>\n\n<ng-template #dropDownEVENTLinkTemplate let-childLink>\n  <a href=\"javascript:void(0)\" (click)=\"linkClickEvent(childLink)\">{{\n    childLink.text\n  }}</a>\n</ng-template>\n",
                styles: [""]
            }] }
];
SdsHeaderComponent.propDecorators = {
    openNavBtn: [{ type: ViewChild, args: ['usaNavOpen',] }],
    closeNavBtn: [{ type: ViewChild, args: ['usaNavClose',] }],
    showTopBanner: [{ type: Input }],
    model: [{ type: Input }],
    topBannerDescription: [{ type: Input }],
    linkEvent: [{ type: Output }],
    onBrowserResize: [{ type: HostListener, args: ['window:resize', ['$event'],] }]
};
if (false) {
    /** @type {?} */
    SdsHeaderComponent.prototype.openNavBtn;
    /** @type {?} */
    SdsHeaderComponent.prototype.closeNavBtn;
    /** @type {?} */
    SdsHeaderComponent.prototype.mobileNavActive;
    /**
     * Navigation helper
     * @type {?}
     */
    SdsHeaderComponent.prototype.navigationHelper;
    /**
     * determines if the top banner is shown
     * @type {?}
     */
    SdsHeaderComponent.prototype.showTopBanner;
    /**
     * Model used for the different display portions of the header
     * @type {?}
     */
    SdsHeaderComponent.prototype.model;
    /** @type {?} */
    SdsHeaderComponent.prototype.topBannerDescription;
    /**
     * event for event based
     * @type {?}
     */
    SdsHeaderComponent.prototype.linkEvent;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVhZGVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc2Etc2FtL2NvbXBvbmVudHMvIiwic291cmNlcyI6WyJsaWIvaGVhZGVyL2hlYWRlci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFHNUcsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sd0NBQXdDLENBQUM7QUFNMUUsTUFBTSxPQUFPLGtCQUFrQjtJQUwvQjtRQVNFLG9CQUFlLEdBQUcsS0FBSyxDQUFDOzs7O1FBSXhCLHFCQUFnQixHQUFHLElBQUksZ0JBQWdCLEVBQUUsQ0FBQzs7OztRQUtqQyxrQkFBYSxHQUFZLElBQUksQ0FBQztRQU85Qix5QkFBb0IsR0FBVyxFQUFFLENBQUM7Ozs7UUFrSDNDLGNBQVMsR0FBRyxJQUFJLFlBQVksRUFBbUIsQ0FBQztJQTRDbEQsQ0FBQzs7Ozs7O0lBekpDLGdCQUFnQixDQUFDLElBQVk7UUFDM0IsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsQ0FBQztJQUNoQyxDQUFDOzs7OztJQUtELFVBQVU7O1lBQ0osVUFBVSxHQUFHLEtBQUs7UUFDdEIsSUFBSSxJQUFJLENBQUMsS0FBSyxFQUFFO1lBQ2QsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLGNBQWMsRUFBRTtnQkFDN0IsSUFBSSxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsT0FBTzs7OztnQkFBQyxVQUFVLElBQXlCO29CQUNuRSxJQUFJLElBQUksQ0FBQyxVQUFVLEVBQUU7d0JBQ25CLFVBQVUsR0FBRyxJQUFJLENBQUM7cUJBQ25CO2dCQUNILENBQUMsRUFBQyxDQUFDO2FBQ0o7U0FDRjtRQUNELE9BQU8sVUFBVSxDQUFDO0lBQ3BCLENBQUM7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SUFFNUIsa0RBQTJDOzs7OztJQWlIM0MsdUNBQ2dEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIsIFZpZXdDaGlsZCwgRWxlbWVudFJlZiwgSG9zdExpc3RlbmVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBIZWFkZXJNb2RlbCwgSGVhZGVyTmF2aWdhdGlvbkxpbmssIEhlYWRlclNlY29uZGFyeUxpbmsgfSBmcm9tICcuL21vZGVsL0hlYWRlck1vZGVsJztcbmltcG9ydCB7IElOYXZpZ2F0aW9uTGluaywgTmF2aWdhdGlvbk1vZGUsIFNlbGVjdGFibGUgfSBmcm9tICcuLi9jb21tb24tbmF2aWdhdGlvbi9jb21tb24tbmF2aWdhdGlvbi1tb2RlbCc7XG5pbXBvcnQgeyBOYXZpZ2F0aW9uSGVscGVyIH0gZnJvbSAnLi4vY29tbW9uLW5hdmlnYXRpb24vbmF2aWdhdGlvbi1oZWxwZXInO1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnc2RzLWhlYWRlcicsXG4gIHRlbXBsYXRlVXJsOiAnLi9oZWFkZXIuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9oZWFkZXIuY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBTZHNIZWFkZXJDb21wb25lbnQge1xuXG4gIEBWaWV3Q2hpbGQoJ3VzYU5hdk9wZW4nKSBvcGVuTmF2QnRuOiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKCd1c2FOYXZDbG9zZScpIGNsb3NlTmF2QnRuOiBFbGVtZW50UmVmO1xuICBtb2JpbGVOYXZBY3RpdmUgPSBmYWxzZTtcbiAgLyoqXG4gICogTmF2aWdhdGlvbiBoZWxwZXJcbiAgKi9cbiAgbmF2aWdhdGlvbkhlbHBlciA9IG5ldyBOYXZpZ2F0aW9uSGVscGVyKCk7XG5cbiAgLyoqXG4gICAqIGRldGVybWluZXMgaWYgdGhlIHRvcCBiYW5uZXIgaXMgc2hvd25cbiAgICovXG4gIEBJbnB1dCgpIHNob3dUb3BCYW5uZXI6IGJvb2xlYW4gPSB0cnVlO1xuXG4gIC8qKlxuICAgKiBNb2RlbCB1c2VkIGZvciB0aGUgZGlmZmVyZW50IGRpc3BsYXkgcG9ydGlvbnMgb2YgdGhlIGhlYWRlclxuICAgKi9cbiAgQElucHV0KCkgbW9kZWw6IEhlYWRlck1vZGVsO1xuXG4gIEBJbnB1dCgpIHRvcEJhbm5lckRlc2NyaXB0aW9uOiBzdHJpbmcgPSAnJztcbiAgLyoqXG4gICAqIFRha2VzIGluIGEgdGV4dCBzdHJpbmcgYW5kIHJlbW92ZXMgYWxsIHdoaXRlIHNwYWNlIGNoYXJhY3RlcnMgYW5kIHJldHVybnMgdGhlIG5ldyBzdHJpbmdcbiAgICogQHBhcmFtIHRleHRcbiAgICovXG4gIHJlbW92ZVdoaXRlU3BhY2UodGV4dDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRleHQucmVwbGFjZSgvIC9nLCAnJyk7XG4gIH1cblxuICAvKipcbiAgICogc2VlaWYgYW55IHNlY29uZGFyeSBsaW5rIGhhcyBhIGNvdW50ZXJcbiAgICovXG4gIGhhc0NvdW50ZXIoKTogYm9vbGVhbiB7XG4gICAgbGV0IGhhc0NvdW50ZXIgPSBmYWxzZTtcbiAgICBpZiAodGhpcy5tb2RlbCkge1xuICAgICAgaWYgKHRoaXMubW9kZWwuc2Vjb25kYXJ5TGlua3MpIHtcbiAgICAgICAgdGhpcy5tb2RlbC5zZWNvbmRhcnlMaW5rcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtOiBIZWFkZXJTZWNvbmRhcnlMaW5rKSB7XG4gICAgICAgICAgaWYgKGl0ZW0uaGFzQ291bnRlcikge1xuICAgICAgICAgICAgaGFzQ291bnRlciA9IHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGhhc0NvdW50ZXI7XG4gIH1cblxuICAvKipcbiAgICogRGVzZWxlY3RzIHByZXZpb3VzIHNlbGV0aW9uXG4gICAqIEBwYXJhbSBpZFxuICAgKi9cbiAgc2VsZWN0KGlkOiBzdHJpbmcpIHtcbiAgICB0aGlzLmRlc2VsZWN0KCk7XG4gICAgbGV0IGl0ZW0gPSB0aGlzLmZpbmQoaWQpO1xuICAgIGlmIChpdGVtKSB7XG4gICAgICBpdGVtLnNlbGVjdGVkID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRGVzZWxlY3RzIGFsbCB0aGUgaXRlbXMgaW4gdGhlIGhlYWRlciBtb2RlbFxuICAgKi9cbiAgZGVzZWxlY3QoKSB7XG4gICAgaWYgKHRoaXMubW9kZWwpIHtcbiAgICAgIGlmICh0aGlzLm1vZGVsLmhvbWUpIHtcbiAgICAgICAgdGhpcy5tb2RlbC5ob21lLnNlbGVjdGVkID0gZmFsc2U7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5tb2RlbC5uYXZpZ2F0aW9uTGlua3MpIHtcbiAgICAgICAgdGhpcy5tb2RlbC5uYXZpZ2F0aW9uTGlua3MuZm9yRWFjaChmdW5jdGlvbiAoaXRlbTogSGVhZGVyTmF2aWdhdGlvbkxpbmspIHtcbiAgICAgICAgICBpdGVtLnNlbGVjdGVkID0gZmFsc2U7XG4gICAgICAgICAgaWYgKGl0ZW0uY2hpbGRyZW4pIHtcbiAgICAgICAgICAgIGl0ZW0uY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoY2hpbGQ6IEhlYWRlck5hdmlnYXRpb25MaW5rKSB7XG4gICAgICAgICAgICAgIGNoaWxkLnNlbGVjdGVkID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMubW9kZWwuc2Vjb25kYXJ5TGlua3MpIHtcbiAgICAgICAgdGhpcy5tb2RlbC5zZWNvbmRhcnlMaW5rcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtOiBIZWFkZXJTZWNvbmRhcnlMaW5rKSB7XG4gICAgICAgICAgaXRlbS5zZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRmluZHMgdGhlIG5hdmlnYXRpb24gZWxlbWVudCBieSBpZCBpbiB0aGUgaGVhZGVyIG1vZGVsXG4gICAqIEBwYXJhbSBpZCBvZiB0aGUgbmF2aWdhdGlvbiBpdGVtXG4gICAqL1xuICBmaW5kKGlkOiBzdHJpbmcpOiBTZWxlY3RhYmxlIHtcbiAgICBsZXQgdG9SZXR1cm4gPSBudWxsO1xuICAgIGlmICh0aGlzLm1vZGVsKSB7XG4gICAgICBpZiAodGhpcy5tb2RlbC5ob21lKSB7XG4gICAgICAgIGlmICh0aGlzLm1vZGVsLmhvbWUuaWQgPT09IGlkKSB7XG4gICAgICAgICAgdG9SZXR1cm4gPSB0aGlzLm1vZGVsLmhvbWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRvUmV0dXJuID0gdGhpcy5maW5kTmF2aWdhdGlvbkxpbmtzKGlkLCB0b1JldHVybik7XG4gICAgICBpZiAodGhpcy5tb2RlbC5zZWNvbmRhcnlMaW5rcykge1xuICAgICAgICB0aGlzLm1vZGVsLnNlY29uZGFyeUxpbmtzLmZvckVhY2goZnVuY3Rpb24gKGl0ZW06IEhlYWRlclNlY29uZGFyeUxpbmspIHtcbiAgICAgICAgICBpZiAoaXRlbS5pZCA9PT0gaWQpIHtcbiAgICAgICAgICAgIHRvUmV0dXJuID0gaXRlbTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdG9SZXR1cm47XG4gIH1cblxuICAvKipcbiAgICogU2VhcmNocyB0aGUgaXRlbXMgaW4gdGhlIG5hdmlnYXRpb24gbGlua3NcbiAgICogQHBhcmFtIGlkXG4gICAqL1xuICBwcml2YXRlIGZpbmROYXZpZ2F0aW9uTGlua3MoaWQ6IHN0cmluZywgdG9SZXR1cm46IFNlbGVjdGFibGUpOiBTZWxlY3RhYmxlIHtcbiAgICBpZiAodGhpcy5tb2RlbC5uYXZpZ2F0aW9uTGlua3MpIHtcbiAgICAgIHRoaXMubW9kZWwubmF2aWdhdGlvbkxpbmtzLmZvckVhY2goZnVuY3Rpb24gKGl0ZW06IEhlYWRlck5hdmlnYXRpb25MaW5rKSB7XG4gICAgICAgIGlmIChpdGVtLmlkID09PSBpZCkge1xuICAgICAgICAgIHRvUmV0dXJuID0gaXRlbTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaXRlbS5jaGlsZHJlbikge1xuICAgICAgICAgIGl0ZW0uY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoY2hpbGQ6IEhlYWRlck5hdmlnYXRpb25MaW5rKSB7XG4gICAgICAgICAgICBpZiAoY2hpbGQuaWQgPT09IGlkKSB7XG4gICAgICAgICAgICAgIHRvUmV0dXJuID0gY2hpbGQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gdG9SZXR1cm47XG4gIH1cblxuICAvKipcbiAgICogZXZlbnQgZm9yIGV2ZW50IGJhc2VkXG4gICAqL1xuICBAT3V0cHV0KClcbiAgbGlua0V2ZW50ID0gbmV3IEV2ZW50RW1pdHRlcjxJTmF2aWdhdGlvbkxpbms+KCk7XG5cbiAgLyoqXG4gICAqIExpbmsgY2xpY2tlZCBhbmQgZW1pdHMgdGhlIGxpbmsgZGF0YSBpbnRvIGFuIGV2ZW50XG4gICAqIEBwYXJhbSBsaW5rXG4gICAqL1xuICBsaW5rQ2xpY2tFdmVudChsaW5rOiBJTmF2aWdhdGlvbkxpbmspIHtcbiAgICB0aGlzLmxpbmtFdmVudC5lbWl0KGxpbmspO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8vIFdoZW4gdGhlIG1vYmlsZSBuYXYgaXMgYWN0aXZlLCBhbmQgdGhlIGNsb3NlIGJveCBpc24ndCB2aXNpYmxlLFxuICAvLyB3ZSBrbm93IHRoZSB1c2VyJ3Mgdmlld3BvcnQgaGFzIGJlZW4gcmVzaXplZCB0byBiZSBsYXJnZXIuXG4gIC8vIExldCdzIG1ha2UgdGhlIHBhZ2Ugc3RhdGUgY29uc2lzdGVudCBieSBkZWFjdGl2YXRpbmcgdGhlIG1vYmlsZSBuYXYuXG4gIEBIb3N0TGlzdGVuZXIoJ3dpbmRvdzpyZXNpemUnLCBbJyRldmVudCddKVxuICBvbkJyb3dzZXJSZXNpemUoZXZlbnQpIHtcbiAgICBpZiAoXG4gICAgICB0aGlzLm1vYmlsZU5hdkFjdGl2ZSAmJlxuICAgICAgdGhpcy5jbG9zZU5hdkJ0bi5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoID09PSAwXG4gICAgKSB7XG4gICAgICB0aGlzLm1vYmlsZU5hdkFjdGl2ZSA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIG9wZW5Nb2JpbGVOYXYoKSB7XG4gICAgdGhpcy5tb2JpbGVOYXZBY3RpdmUgPSB0cnVlO1xuICB9XG5cbiAgY2xvc2VNb2JpbGVOYXYoKSB7XG4gICAgdGhpcy5tb2JpbGVOYXZBY3RpdmUgPSBmYWxzZTtcbiAgICAvLyBUaGUgbW9iaWxlIG5hdiB3YXMganVzdCBkZWFjdGl2YXRlZCwgYW5kIGZvY3VzIHdhcyBvbiB0aGUgY2xvc2VcbiAgICAvLyBidXR0b24sIHdoaWNoIGlzIG5vIGxvbmdlciB2aXNpYmxlLiBXZSBkb24ndCB3YW50IHRoZSBmb2N1cyB0b1xuICAgIC8vIGRpc2FwcGVhciBpbnRvIHRoZSB2b2lkLCBzbyBmb2N1cyBvbiB0aGUgbWVudSBidXR0b24gaWYgaXQnc1xuICAgIC8vIHZpc2libGUgKHRoaXMgbWF5IGhhdmUgYmVlbiB3aGF0IHRoZSB1c2VyIHdhcyBqdXN0IGZvY3VzZWQgb24sXG4gICAgLy8gaWYgdGhleSB0cmlnZ2VyZWQgdGhlIG1vYmlsZSBuYXYgYnkgbWlzdGFrZSkuXG4gICAgdGhpcy5vcGVuTmF2QnRuLm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcbiAgfVxuXG4gIC8vIFRoZSBtb2JpbGUgbmF2IHdhcyBqdXN0IGFjdGl2YXRlZCwgc28gZm9jdXMgb24gdGhlIGNsb3NlIGJ1dHRvbixcbiAgbmF2QW5pbWF0aW9uRW5kKCkge1xuICAgIHRoaXMuY2xvc2VOYXZCdG4ubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuICB9XG5cblxufVxuIl19