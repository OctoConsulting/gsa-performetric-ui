/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ViewChild, ElementRef, Input, forwardRef, ChangeDetectionStrategy, ChangeDetectorRef } from '@angular/core';
import { FocusMonitor } from '@angular/cdk/a11y';
import { ViewportRuler } from '@angular/cdk/overlay';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
export class SearchSettings {
    constructor() {
        this.placeholder = 'Search';
        this.dropdown = {
            placeholder: '-Select-',
            options: [],
            inverse: false
        };
    }
}
if (false) {
    /** @type {?} */
    SearchSettings.prototype.placeholder;
    /** @type {?} */
    SearchSettings.prototype.size;
    /** @type {?} */
    SearchSettings.prototype.dropdown;
}
export class SdsSearchComponent {
    /**
     * @param {?} cd
     * @param {?} focusMonitor
     * @param {?} viewportRuler
     */
    constructor(cd, focusMonitor, viewportRuler) {
        this.cd = cd;
        this.focusMonitor = focusMonitor;
        this.viewportRuler = viewportRuler;
        this.searchSettings = new SearchSettings();
        this.model = {};
        this.inputState = {
            initial: { visible: undefined },
            visible: undefined
        };
        this._onChange = (/**
         * @param {?} _
         * @return {?}
         */
        (_) => { });
        this._onTouched = (/**
         * @return {?}
         */
        () => { });
    }
    /**
     * @return {?}
     */
    ngAfterViewInit() {
        this.inputState.initial.visible = this.isInputVisible();
        this.inputState.visible = this.inputState.initial.visible;
        this.viewportRuler.change(0).subscribe((/**
         * @return {?}
         */
        () => {
            this.inputState.initial.visible = this.isInputVisible();
            this.inputState.visible = this.inputState.initial.visible;
        }));
    }
    /**
     * @return {?}
     */
    hasDropdown() {
        if (this.searchSettings &&
            this.searchSettings.dropdown &&
            this.searchSettings.dropdown.options &&
            this.searchSettings.dropdown.options.length) {
            return true;
        }
        else {
            return false;
        }
    }
    /**
     * @param {?} event
     * @return {?}
     */
    handleClick(event) {
        event.preventDefault();
        if (!this.inputState.visible) {
            this.setInputVisibleStyles();
            this.focusMonitor.focusVia(this.inputEl, 'program');
        }
        else if (this.inputEl.nativeElement.value || this.selectEl.nativeElement.value) {
            this.model.searchText = this.inputEl.nativeElement.value;
            if (this.selectEl && this.selectEl.nativeElement.value) {
                this.model.searchCatergory = this.selectEl.nativeElement.value;
            }
            this._onChange(this.model);
        }
    }
    /**
     * @param {?} value
     * @return {?}
     */
    writeValue(value) {
        if (value && this.model !== value) {
            this.model = value;
            this.cd.markForCheck();
        }
        else {
            this.model = {};
            this.cd.markForCheck();
        }
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnTouched(fn) {
        this._onTouched = fn;
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnChange(fn) {
        this._onChange = fn;
    }
    /**
     * @return {?}
     */
    isInputVisible() {
        return this.inputEl.nativeElement.getBoundingClientRect().width
            ? true
            : false;
    }
    /**
     * @return {?}
     */
    setInputVisibleStyles() {
        /** @type {?} */
        const inputWidth = this.calculateInputWidth();
        this.inputEl.nativeElement.style.display = 'block';
        this.inputEl.nativeElement.style.position = 'absolute';
        this.inputEl.nativeElement.style.left = `-${inputWidth}px`;
        this.inputEl.nativeElement.style.width = `${inputWidth}px`;
        this.inputState.visible = true;
    }
    /**
     * @return {?}
     */
    removeInputVisibleStyles() {
        this.inputEl.nativeElement.style.display = '';
        this.inputEl.nativeElement.style.position = '';
        this.inputEl.nativeElement.style.left = '';
        this.inputEl.nativeElement.style.width = '';
        this.inputState.visible = false;
    }
    /**
     * @param {?} event
     * @return {?}
     */
    focusChange(event) {
        if (event === null && !this.inputState.initial.visible) {
            this.removeInputVisibleStyles();
        }
    }
    /**
     * @return {?}
     */
    calculateInputWidth() {
        /** @type {?} */
        const buttonElement = this.buttonEl.nativeElement;
        /** @type {?} */
        const inputElement = this.inputEl.nativeElement;
        /** @type {?} */
        const rightPosition = buttonElement.getBoundingClientRect().left;
        /** @type {?} */
        const leftPosition = this.parentSelector
            ? inputElement.closest(this.parentSelector).getBoundingClientRect().left
            : 0;
        return Math.floor(rightPosition - leftPosition);
    }
    /**
     * @return {?}
     */
    getClass() {
        /** @type {?} */
        const cls = this.searchSettings && this.searchSettings.size === 'large'
            ? 'usa-search--big'
            : 'usa-search--small';
        return this.searchSettings.dropdown && this.searchSettings.dropdown.inverse
            ? `${cls} sds-inverse`
            : cls;
    }
}
SdsSearchComponent.decorators = [
    { type: Component, args: [{
                selector: 'sds-search',
                template: "<form class=\"usa-form usa-search\" [ngClass]=\"getClass()\" role=\"search\">\n  <label class=\"usa-sr-only\" for=\"options\">Dropdown label</label>\n  <select *ngIf=\"hasDropdown()\" [value]=\"model.searchCategory? model.searchCategory :''\" #selectEl name=\"search options\"\n    class=\"usa-select\" id=\"search-options\">\n    <option [value]=\"\"> {{searchSettings.dropdown.placeholder ? searchSettings.dropdown.placeholder : '-Select-'}}</option>\n    <ng-container *ngFor=\"let item of searchSettings.dropdown.options\">\n      <optgroup *ngIf=\"item.group\" label=\"{{item.label}}\">\n        <option *ngFor=\"let child of item.group\" [value]=\"child.value\" [selected]=\"model.searchCategory == child.value\"\n          [disabled]=\"child.disabled\">\n          {{ child.label }}\n        </option>\n      </optgroup>\n      <option *ngIf=\"!item.group\" [value]=\"item.value\" [selected]=\"model.searchCategory == item.value\" [disabled]=\"item.disabled\">{{\n        item.label }}</option>\n    </ng-container>\n  </select>\n  <ng-container *ngIf=\"(searchSettings.dropdown && searchSettings.dropdown.inverse); then inverseTemplate else inputTemplate\">\n  </ng-container>\n</form>\n\n<ng-template #inputTemplate> <label class=\"usa-sr-only\" for=\"search-field\">Search</label>\n  <input #inputEl [value]=\"model.searchText? model.searchText :''\" [ngClass]=\"inputClass\" id=\"search-field\" type=\"search\" class=\"usa-input\"\n    name=\"search\" [placeholder]=\"searchSettings.placeholder? searchSettings.placeholder : 'type here'\" />\n  <button class=\"usa-button\" type=\"submit\"  (click)=\"handleClick($event)\">\n    <span class=\"usa-sr-only\">Search</span>\n  </button>\n</ng-template>\n<ng-template #inverseTemplate>\n  <div class=\"sds-inverse__search\">\n    <ng-container [ngTemplateOutlet]=\"inputTemplate\"></ng-container>\n  </div>\n</ng-template>",
                providers: [
                    {
                        provide: NG_VALUE_ACCESSOR,
                        useExisting: forwardRef((/**
                         * @return {?}
                         */
                        () => SdsSearchComponent)),
                        multi: true
                    }
                ],
                changeDetection: ChangeDetectionStrategy.OnPush
            }] }
];
/** @nocollapse */
SdsSearchComponent.ctorParameters = () => [
    { type: ChangeDetectorRef },
    { type: FocusMonitor },
    { type: ViewportRuler }
];
SdsSearchComponent.propDecorators = {
    inputEl: [{ type: ViewChild, args: ['inputEl', { read: ElementRef },] }],
    selectEl: [{ type: ViewChild, args: ['selectEl', { read: ElementRef },] }],
    buttonEl: [{ type: ViewChild, args: ['buttonEl', { read: ElementRef },] }],
    inputClass: [{ type: Input }],
    parentSelector: [{ type: Input }],
    searchSettings: [{ type: Input }]
};
if (false) {
    /** @type {?} */
    SdsSearchComponent.prototype.inputEl;
    /** @type {?} */
    SdsSearchComponent.prototype.selectEl;
    /** @type {?} */
    SdsSearchComponent.prototype.buttonEl;
    /** @type {?} */
    SdsSearchComponent.prototype.inputClass;
    /** @type {?} */
    SdsSearchComponent.prototype.parentSelector;
    /** @type {?} */
    SdsSearchComponent.prototype.searchSettings;
    /** @type {?} */
    SdsSearchComponent.prototype.model;
    /** @type {?} */
    SdsSearchComponent.prototype.inputState;
    /**
     * @type {?}
     * @private
     */
    SdsSearchComponent.prototype._onChange;
    /**
     * @type {?}
     * @private
     */
    SdsSearchComponent.prototype._onTouched;
    /**
     * @type {?}
     * @private
     */
    SdsSearchComponent.prototype.cd;
    /**
     * @type {?}
     * @private
     */
    SdsSearchComponent.prototype.focusMonitor;
    /**
     * @type {?}
     * @private
     */
    SdsSearchComponent.prototype.viewportRuler;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VhcmNoLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bnc2Etc2FtL2NvbXBvbmVudHMvIiwic291cmNlcyI6WyJsaWIvc2VhcmNoL3NlYXJjaC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsU0FBUyxFQUNULFVBQVUsRUFDVixLQUFLLEVBRUwsVUFBVSxFQUNWLHVCQUF1QixFQUN2QixpQkFBaUIsRUFDbEIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2pELE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNyRCxPQUFPLEVBQUUsaUJBQWlCLEVBQXdCLE1BQU0sZ0JBQWdCLENBQUM7QUFDekUsTUFBTSxPQUFPLGNBQWM7SUFBM0I7UUFDUyxnQkFBVyxHQUFHLFFBQVEsQ0FBQztRQUV2QixhQUFRLEdBQVE7WUFDckIsV0FBVyxFQUFFLFVBQVU7WUFDdkIsT0FBTyxFQUFFLEVBQUU7WUFDWCxPQUFPLEVBQUUsS0FBSztTQUNmLENBQUM7SUFDSixDQUFDO0NBQUE7OztJQVBDLHFDQUE4Qjs7SUFDOUIsOEJBQW9COztJQUNwQixrQ0FJRTs7QUFjSixNQUFNLE9BQU8sa0JBQWtCOzs7Ozs7SUFpQjdCLFlBQ1UsRUFBcUIsRUFDckIsWUFBMEIsRUFDMUIsYUFBNEI7UUFGNUIsT0FBRSxHQUFGLEVBQUUsQ0FBbUI7UUFDckIsaUJBQVksR0FBWixZQUFZLENBQWM7UUFDMUIsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFiN0IsbUJBQWMsR0FBbUIsSUFBSSxjQUFjLEVBQUUsQ0FBQztRQUUvRCxVQUFLLEdBQVEsRUFBRSxDQUFDO1FBQ2hCLGVBQVUsR0FBRztZQUNYLE9BQU8sRUFBRSxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUU7WUFDL0IsT0FBTyxFQUFFLFNBQVM7U0FDbkIsQ0FBQztRQUNNLGNB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Ozs7WUF6QkMsaUJBQWlCO1lBRVYsWUFBWTtZQUNaLGFBQWE7OztzQkF3Qm5CLFNBQVMsU0FBQyxTQUFTLEVBQUUsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFO3VCQUN6QyxTQUFTLFNBQUMsVUFBVSxFQUFFLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRTt1QkFDMUMsU0FBUyxTQUFDLFVBQVUsRUFBRSxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUU7eUJBRTFDLEtBQUs7NkJBQ0wsS0FBSzs2QkFDTCxLQUFLOzs7O0lBTk4scUNBQWdFOztJQUNoRSxzQ0FBa0U7O0lBQ2xFLHNDQUFrRTs7SUFFbEUsd0NBQTRCOztJQUM1Qiw0Q0FBZ0M7O0lBQ2hDLDRDQUErRDs7SUFFL0QsbUNBQWdCOztJQUNoQix3Q0FHRTs7Ozs7SUFDRix1Q0FBbUM7Ozs7O0lBQ25DLHdDQUE4Qjs7Ozs7SUFHNUIsZ0NBQTZCOzs7OztJQUM3QiwwQ0FBa0M7Ozs7O0lBQ2xDLDJDQUFvQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgVmlld0NoaWxkLFxuICBFbGVtZW50UmVmLFxuICBJbnB1dCxcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgZm9yd2FyZFJlZixcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENoYW5nZURldGVjdG9yUmVmXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRm9jdXNNb25pdG9yIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2ExMXknO1xuaW1wb3J0IHsgVmlld3BvcnRSdWxlciB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9vdmVybGF5JztcbmltcG9ydCB7IE5HX1ZBTFVFX0FDQ0VTU09SLCBDb250cm9sVmFsdWVBY2Nlc3NvciB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmV4cG9ydCBjbGFzcyBTZWFyY2hTZXR0aW5ncyB7XG4gIHB1YmxpYyBwbGFjZWhvbGRlciA9ICdTZWFyY2gnO1xuICBwdWJsaWMgc2l6ZTogc3RyaW5nO1xuICBwdWJsaWMgZHJvcGRvd246IGFueSA9IHtcbiAgICBwbGFjZWhvbGRlcjogJy1TZWxlY3QtJyxcbiAgICBvcHRpb25zOiBbXSxcbiAgICBpbnZlcnNlOiBmYWxzZVxuICB9O1xufVxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnc2RzLXNlYXJjaCcsXG4gIHRlbXBsYXRlVXJsOiAnc2VhcmNoLmNvbXBvbmVudC5odG1sJyxcbiAgcHJvdmlkZXJzOiBbXG4gICAge1xuICAgICAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXG4gICAgICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBTZHNTZWFyY2hDb21wb25lbnQpLFxuICAgICAgbXVsdGk6IHRydWVcbiAgICB9XG4gIF0sXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoXG59KVxuZXhwb3J0IGNsYXNzIFNkc1NlYXJjaENvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQsIENvbnRyb2xWYWx1ZUFjY2Vzc29yIHtcbiAgQFZpZXdDaGlsZCgnaW5wdXRFbCcsIHsgcmVhZDogRWxlbWVudFJlZiB9KSBpbnB1dEVsOiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKCdzZWxlY3RFbCcsIHsgcmVhZDogRWxlbWVudFJlZiB9KSBzZWxlY3RFbDogRWxlbWVudFJlZjtcbiAgQFZpZXdDaGlsZCgnYnV0dG9uRWwnLCB7IHJlYWQ6IEVsZW1lbnRSZWYgfSkgYnV0dG9uRWw6IEVsZW1lbnRSZWY7XG5cbiAgQElucHV0KCkgaW5wdXRDbGFzczogc3RyaW5nO1xuICBASW5wdXQoKSBwYXJlbnRTZWxlY3Rvcjogc3RyaW5nO1xuICBASW5wdXQoKSBzZWFyY2hTZXR0aW5nczogU2VhcmNoU2V0dGluZ3MgPSBuZXcgU2VhcmNoU2V0dGluZ3MoKTtcblxuICBtb2RlbDogYW55ID0ge307XG4gIGlucHV0U3RhdGUgPSB7XG4gICAgaW5pdGlhbDogeyB2aXNpYmxlOiB1bmRlZmluZWQgfSxcbiAgICB2aXNpYmxlOiB1bmRlZmluZWRcbiAgfTtcbiAgcHJpdmF0ZSBfb25DaGFuZ2UgPSAoXzogYW55KSA9PiB7fTtcbiAgcHJpdmF0ZSBfb25Ub3VjaGVkID0gKCkgPT4ge307XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBjZDogQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgcHJpdmF0ZSBmb2N1c01vbml0b3I6IEZvY3VzTW9uaXRvcixcbiAgICBwcml2YXRlIHZpZXdwb3J0UnVsZXI6IFZpZXdwb3J0UnVsZXJcbiAgKSB7fVxuXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICB0aGlzLmlucHV0U3RhdGUuaW5pdGlhbC52aXNpYmxlID0gdGhpcy5pc0lucHV0VmlzaWJsZSgpO1xuICAgIHRoaXMuaW5wdXRTdGF0ZS52aXNpYmxlID0gdGhpcy5pbnB1dFN0YXRlLmluaXRpYWwudmlzaWJsZTtcbiAgICB0aGlzLnZpZXdwb3J0UnVsZXIuY2hhbmdlKDApLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICB0aGlzLmlucHV0U3RhdGUuaW5pdGlhbC52aXNpYmxlID0gdGhpcy5pc0lucHV0VmlzaWJsZSgpO1xuICAgICAgdGhpcy5pbnB1dFN0YXRlLnZpc2libGUgPSB0aGlzLmlucHV0U3RhdGUuaW5pdGlhbC52aXNpYmxlO1xuICAgIH0pO1xuICB9XG5cbiAgaGFzRHJvcGRvd24oKSB7XG4gICAgaWYgKFxuICAgICAgdGhpcy5zZWFyY2hTZXR0aW5ncyAmJlxuICAgICAgdGhpcy5zZWFyY2hTZXR0aW5ncy5kcm9wZG93biAmJlxuICAgICAgdGhpcy5zZWFyY2hTZXR0aW5ncy5kcm9wZG93bi5vcHRpb25zICYmXG4gICAgICB0aGlzLnNlYXJjaFNldHRpbmdzLmRyb3Bkb3duLm9wdGlvbnMubGVuZ3RoXG4gICAgKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuICBoYW5kbGVDbGljayhldmVudCkge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgaWYgKCF0aGlzLmlucHV0U3RhdGUudmlzaWJsZSkge1xuICAgICAgdGhpcy5zZXRJbnB1dFZpc2libGVTdHlsZXMoKTtcbiAgICAgIHRoaXMuZm9jdXNNb25pdG9yLmZvY3VzVmlhKHRoaXMuaW5wdXRFbCwgJ3Byb2dyYW0nKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMuaW5wdXRFbC5uYXRpdmVFbGVtZW50LnZhbHVlIHx8IHRoaXMuc2VsZWN0RWwubmF0aXZlRWxlbWVudC52YWx1ZSkge1xuICAgICAgdGhpcy5tb2RlbC5zZWFyY2hUZXh0ID0gdGhpcy5pbnB1dEVsLm5hdGl2ZUVsZW1lbnQudmFsdWU7XG4gICAgICBpZiAodGhpcy5zZWxlY3RFbCAmJiB0aGlzLnNlbGVjdEVsLm5hdGl2ZUVsZW1lbnQudmFsdWUpIHtcbiAgICAgICAgdGhpcy5tb2RlbC5zZWFyY2hDYXRlcmdvcnkgPSB0aGlzLnNlbGVjdEVsLm5hdGl2ZUVsZW1lbnQudmFsdWU7XG4gICAgICB9XG4gICAgICB0aGlzLl9vbkNoYW5nZSh0aGlzLm1vZGVsKTtcbiAgICB9XG4gIH1cblxuICB3cml0ZVZhbHVlKHZhbHVlOiBhbnkpIHtcbiAgICBpZiAodmFsdWUgJiYgdGhpcy5tb2RlbCAhPT0gdmFsdWUpIHtcbiAgICAgIHRoaXMubW9kZWwgPSB2YWx1ZTtcbiAgICAgIHRoaXMuY2QubWFya0ZvckNoZWNrKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubW9kZWwgPSB7fTtcbiAgICAgIHRoaXMuY2QubWFya0ZvckNoZWNrKCk7XG4gICAgfVxuICB9XG4gIHJlZ2lzdGVyT25Ub3VjaGVkKGZuOiBhbnkpIHtcbiAgICB0aGlzLl9vblRvdWNoZWQgPSBmbjtcbiAgfVxuICByZWdpc3Rlck9uQ2hhbmdlKGZuOiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLl9vbkNoYW5nZSA9IGZuO1xuICB9XG5cbiAgaXNJbnB1dFZpc2libGUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuaW5wdXRFbC5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoXG4gICAgICA/IHRydWVcbiAgICAgIDogZmFsc2U7XG4gIH1cblxuICBzZXRJbnB1dFZpc2libGVTdHlsZXMoKSB7XG4gICAgY29uc3QgaW5wdXRXaWR0aCA9IHRoaXMuY2FsY3VsYXRlSW5wdXRXaWR0aCgpO1xuICAgIHRoaXMuaW5wdXRFbC5uYXRpdmVFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuICAgIHRoaXMuaW5wdXRFbC5uYXRpdmVFbGVtZW50LnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJztcbiAgICB0aGlzLmlucHV0RWwubmF0aXZlRWxlbWVudC5zdHlsZS5sZWZ0ID0gYC0ke2lucHV0V2lkdGh9cHhgO1xuICAgIHRoaXMuaW5wdXRFbC5uYXRpdmVFbGVtZW50LnN0eWxlLndpZHRoID0gYCR7aW5wdXRXaWR0aH1weGA7XG4gICAgdGhpcy5pbnB1dFN0YXRlLnZpc2libGUgPSB0cnVlO1xuICB9XG5cbiAgcmVtb3ZlSW5wdXRWaXNpYmxlU3R5bGVzKCkge1xuICAgIHRoaXMuaW5wdXRFbC5uYXRpdmVFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSAnJztcbiAgICB0aGlzLmlucHV0RWwubmF0aXZlRWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9ICcnO1xuICAgIHRoaXMuaW5wdXRFbC5uYXRpdmVFbGVtZW50LnN0eWxlLmxlZnQgPSAnJztcbiAgICB0aGlzLmlucHV0RWwubmF0aXZlRWxlbWVudC5zdHlsZS53aWR0aCA9ICcnO1xuICAgIHRoaXMuaW5wdXRTdGF0ZS52aXNpYmxlID0gZmFsc2U7XG4gIH1cblxuICBmb2N1c0NoYW5nZShldmVudCkge1xuICAgIGlmIChldmVudCA9PT0gbnVsbCAmJiAhdGhpcy5pbnB1dFN0YXRlLmluaXRpYWwudmlzaWJsZSkge1xuICAgICAgdGhpcy5yZW1vdmVJbnB1dFZpc2libGVTdHlsZXMoKTtcbiAgICB9XG4gIH1cblxuICBjYWxjdWxhdGVJbnB1dFdpZHRoKCk6IG51bWJlciB7XG4gICAgY29uc3QgYnV0dG9uRWxlbWVudCA9IHRoaXMuYnV0dG9uRWwubmF0aXZlRWxlbWVudDtcbiAgICBjb25zdCBpbnB1dEVsZW1lbnQgPSB0aGlzLmlucHV0RWwubmF0aXZlRWxlbWVudDtcbiAgICBjb25zdCByaWdodFBvc2l0aW9uID0gYnV0dG9uRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5sZWZ0O1xuICAgIGNvbnN0IGxlZnRQb3NpdGlvbiA9IHRoaXMucGFyZW50U2VsZWN0b3JcbiAgICAgID8gaW5wdXRFbGVtZW50LmNsb3Nlc3QodGhpcy5wYXJlbnRTZWxlY3RvcikuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdFxuICAgICAgOiAwO1xuICAgIHJldHVybiBNYXRoLmZsb29yKHJpZ2h0UG9zaXRpb24gLSBsZWZ0UG9zaXRpb24pO1xuICB9XG4gIGdldENsYXNzKCkge1xuICAgIGNvbnN0IGNscyA9XG4gICAgICB0aGlzLnNlYXJjaFNldHRpbmdzICYmIHRoaXMuc2VhcmNoU2V0dGluZ3Muc2l6ZSA9PT0gJ2xhcmdlJ1xuICAgICAgICA/ICd1c2Etc2VhcmNoLS1iaWcnXG4gICAgICAgIDogJ3VzYS1zZWFyY2gtLXNtYWxsJztcbiAgICByZXR1cm4gdGhpcy5zZWFyY2hTZXR0aW5ncy5kcm9wZG93biAmJiB0aGlzLnNlYXJjaFNldHRpbmdzLmRyb3Bkb3duLmludmVyc2VcbiAgICAgID8gYCR7Y2xzfSBzZHMtaW52ZXJzZWBcbiAgICAgIDogY2xzO1xuICB9XG59XG4iXX0=