/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, ViewChild, TemplateRef, ElementRef, forwardRef, ChangeDetectorRef } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { KeyHelper, KEYS } from '../key-helper/key-helper';
import { SDSSelectedItemModel } from '../selected-result/models/sds-selectedItem.model';
import { SelectionMode, SDSSelectedItemModelHelper } from '../selected-result/models/sds-selected-item-model-helper';
import { SDSAutocompleteSearchConfiguration } from './models/SDSAutocompleteConfiguration';
/** @type {?} */
const Autocomplete_Autocomplete_VALUE_ACCESSOR = {
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef((/**
     * @return {?}
     */
    () => SDSAutocompleteSearchComponent)),
    multi: true
};
export class SDSAutocompleteSearchComponent {
    /**
     * @param {?} _changeDetectorRef
     */
    constructor(_changeDetectorRef) {
        this._changeDetectorRef = _changeDetectorRef;
        /**
         * selected index
         */
        this.highlightedIndex = 0;
        /**
         * value of the input field
         */
        this.inputValue = '';
        /**
         * Proprty being set on the object is highlighted
         */
        this.HighlightedPropertyName = 'highlighted';
        this.showLoad = true;
        /**
         * Search string
         */
        this.searchString = null;
        /**
         * To make input readonly
         */
        this.inputReadOnly = false;
        /**
         * Used to store selected items
         */
        this.items = [];
        /**
         * Stored Event for ControlValueAccessor
         */
        this.onTouchedCallback = (/**
         * @return {?}
         */
        () => null);
        /**
         * Stored Event for ControlValueAccessor
         */
        this.propogateChange = (/**
         * @param {?} _
         * @return {?}
         */
        (_) => null);
        this.resultsAvailableMessage = ' results available. Use up and down arrows\
  to scroll through results. Hit enter to select.';
        this.index = 0;
        /**
         * Determines if the dropdown should be shown
         */
        this.showResults = false;
    }
    /**
     * Gets the string value from the specifed properties of an object
     * @param {?} object
     * @param {?} propertyFields comma seperated list with periods depth of object
     * @return {?}
     */
    getObjectValue(object, propertyFields) {
        /** @type {?} */
        let value = '';
        /** @type {?} */
        let current = object;
        /** @type {?} */
        let fieldSplit = propertyFields.split(',');
        for (let i = 0; i < fieldSplit.length; i++) {
            /** @type {?} */
            let fieldValue = fieldSplit[i];
            /** @type {?} */
            let fieldPartSplit = fieldValue.split('.');
            for (let j = 0; j < fieldPartSplit.length; j++) {
                /** @type {?} */
                let fieldCheckValue = fieldPartSplit[j];
                if (current) {
                    current = current[fieldCheckValue];
                }
            }
            if (current) {
                value += current.toString() + ' ';
            }
            current = object;
        }
        return value.trim();
    }
    /**
     * Clears the input fields and value
     * @return {?}
     */
    clearInput() {
        this.inputValue = '';
        this.onTouchedCallback();
        this.clearAndHideResults();
    }
    /**
     *
     * @param {?} event
     * @return {?}
     */
    checkForFocus(event) {
        this.focusRemoved();
        this.showResults = false;
    }
    /**
     *
     * @private
     * @return {?}
     */
    focusRemoved() {
        if (this.configuration) {
            if (this.configuration.selectionMode === SelectionMode.SINGLE) {
                if (this.model.items.length > 0) {
                    if (this.inputValue.length === 0) {
                        SDSSelectedItemModelHelper.clearItems(this.model.items);
                        this.propogateChange(this.model);
                    }
                    else {
                        this.inputValue = this.getObjectValue(this.model.items[0], this.configuration.primaryTextField);
                    }
                }
            }
            else {
                this.inputValue = '';
            }
        }
        else {
            this.inputValue = '';
        }
    }
    /**
     * @param {?} ev
     * @return {?}
     */
    onkeypress(ev) {
        return this.configuration.inputReadOnly ? false : true;
    }
    /**
     * @param {?} event
     * @return {?}
     */
    textChange(event) {
        if (!this.configuration.isTagModeEnabled) {
            // ie 11 placeholders will incorrectly trigger input events (known bug)
            // if input isn't active element then don't do anything
            if (event.target != document.activeElement) {
                event.preventDefault();
                return;
            }
            /** @type {?} */
            const searchString = event.target.value || '';
            this.getResults(searchString);
        }
    }
    /**
     * Event method used when focus is gained to the input
     * @return {?}
     */
    inputFocusHandler() {
        if (!this.configuration.isTagModeEnabled) {
            if (this.configuration.focusInSearch) {
                this.getResults(this.inputValue || '');
            }
            this.onTouchedCallback();
        }
    }
    /**
     * Key event
     * @param {?} event
     * @return {?}
     */
    onKeydown(event) {
        if (KeyHelper.is(KEYS.TAB, event)) {
            return;
        }
        else if (KeyHelper.is(KEYS.BACKSPACE, event)) {
            if (this.configuration.inputReadOnly) {
                event.preventDefault();
            }
        }
        else if (KeyHelper.is(KEYS.DOWN, event)) {
            this.onArrowDown();
        }
        else if (KeyHelper.is(KEYS.UP, event)) {
            event.preventDefault();
            this.onArrowUp();
        }
        else if (KeyHelper.is(KEYS.ENTER, event) && this.highlightedIndex >= 0) {
            if (this.configuration.isTagModeEnabled) {
                /** @type {?} */
                const val = this.createFreeTextItem();
                this.selectItem(val);
            }
            else {
                this.selectItem(this.highlightedItem);
            }
        }
        else if (KeyHelper.is(KEYS.ENTER, event) && this.highlightedIndex < 0) {
            /** @type {?} */
            const val = this.createFreeTextItem();
            this.selectItem(val);
        }
        else if (KeyHelper.is(KEYS.ESC, event)) {
            if (this.showResults) {
                this.clearAndHideResults();
                if (event.stopPropagation) {
                    event.stopPropagation();
                }
            }
        }
    }
    /**
     * selects the item adding it to the model and closes the results
     * @param {?} item
     * @return {?}
     */
    selectItem(item) {
        SDSSelectedItemModelHelper.addItem(item, this.configuration.primaryKeyField, this.configuration.selectionMode, this.items);
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.model.items = [...this.items];
            this.propogateChange(this.model);
        }), 0);
        /** @type {?} */
        let message = this.getObjectValue(item, this.configuration.primaryTextField);
        this.inputValue = message;
        this.focusRemoved();
        this.showResults = false;
    }
    /**
     *  clears the results and closes result drop down
     * @private
     * @return {?}
     */
    clearAndHideResults() {
        this.results = [];
        this.showResults = false;
        this.focusRemoved();
    }
    /**
     *  handles the arrow up key event
     * @private
     * @return {?}
     */
    onArrowUp() {
        if (this.results && this.results.length > 0) {
            if (this.highlightedIndex >= 0) {
                this.highlightedIndex--;
                this.setHighlightedItem(this.results[this.highlightedIndex]);
                this.scrollSelectedItemIntoView();
            }
        }
    }
    /**
     *  handles the arrow down key event
     * @private
     * @return {?}
     */
    onArrowDown() {
        if (this.results && this.results.length > 0) {
            if (this.highlightedIndex < this.results.length - 1) {
                this.highlightedIndex++;
                this.setHighlightedItem(this.results[this.highlightedIndex]);
                this.scrollSelectedItemIntoView();
            }
        }
    }
    /**
     * @return {?}
     */
    showFreeText() {
        if (this.configuration.isFreeTextEnabled) {
            if (this.inputValue) {
                if (this.inputValue.length !== 0) {
                    /** @type {?} */
                    let foundItem = false;
                    if (this.results) {
                        for (var i = 0; i < this.results.length && !foundItem; i++) {
                            /** @type {?} */
                            let item = this.results[i];
                            foundItem =
                                item[this.configuration.primaryTextField] === this.inputValue;
                        }
                    }
                    if (this.model.items.length > 0 && !foundItem) {
                        for (var i = 0; i < this.model.items.length && !foundItem; i++) {
                            /** @type {?} */
                            let item = this.model.items[i];
                            foundItem =
                                item[this.configuration.primaryTextField] === this.inputValue;
                        }
                    }
                    return !foundItem;
                }
                else {
                    return false;
                }
            }
            else {
                return false;
            }
        }
        else {
            return this.configuration.isFreeTextEnabled;
        }
    }
    /**
     * @private
     * @return {?}
     */
    createFreeTextItem() {
        /** @type {?} */
        let item = { type: 'custom' };
        item[this.configuration.primaryTextField] = this.inputValue;
        item[this.configuration.primaryKeyField] = this.inputValue;
        return item;
    }
    /**
     *  gets the inital results
     * @private
     * @param {?} searchString
     * @return {?}
     */
    getResults(searchString) {
        if (searchString.length >= this.configuration.minimumCharacterCountSearch) {
            if (!this.matchPastSearchString(searchString) ||
                (this.matchPastSearchString(searchString) && !this.showResults) ||
                this.matchPastSearchString('')) {
                this.searchString = searchString;
                window.clearTimeout(this.timeoutNumber);
                this.timeoutNumber = window.setTimeout((/**
                 * @return {?}
                 */
                () => {
                    this.showLoad = true;
                    this.service.getDataByText(0, searchString).subscribe((/**
                     * @param {?} result
                     * @return {?}
                     */
                    result => {
                        this.results = result.items;
                        this.showLoad = false;
                        this.maxResults = result.totalItems;
                        this.highlightedIndex = this.configuration.isFreeTextEnabled
                            ? -1
                            : 0;
                        if (!this.configuration.isFreeTextEnabled) {
                            this.setHighlightedItem(this.results[this.highlightedIndex]);
                        }
                        this.showResults = true;
                        this.addScreenReaderMessage(this.maxResults + ' ' + this.resultsAvailableMessage);
                        this._changeDetectorRef.markForCheck();
                    }));
                }), this.configuration.debounceTime);
            }
        }
    }
    /**
     * Checks if the new search string matches the old search string
     * @private
     * @param {?} searchString
     * @return {?}
     */
    matchPastSearchString(searchString) {
        return this.searchString === searchString;
    }
    /**
     * highlights the index being hovered
     * @param {?} index
     * @return {?}
     */
    listItemHover(index) {
        this.highlightedIndex = index;
        this.setHighlightedItem(this.results[this.highlightedIndex]);
    }
    /**
     * Scroll Event Handler (Calculates if mpre items should be asked for from service on scrolling down)
     * @return {?}
     */
    onScroll() {
        if (this.maxResults > this.results.length) {
            /** @type {?} */
            let scrollAreaHeight = this.resultsListElement.nativeElement.offsetHeight;
            /** @type {?} */
            let scrollTopPos = this.resultsListElement.nativeElement.scrollTop;
            /** @type {?} */
            let scrollAreaMaxHeight = this.resultsListElement.nativeElement
                .scrollHeight;
            if (scrollTopPos + scrollAreaHeight * 2 >= scrollAreaMaxHeight) {
                this.getAdditionalResults();
            }
        }
    }
    /**
     * gets more results based when scrolling and adds the items
     * @private
     * @return {?}
     */
    getAdditionalResults() {
        this.showLoad = true;
        this.service
            .getDataByText(this.results.length, this.searchString)
            .subscribe((/**
         * @param {?} result
         * @return {?}
         */
        result => {
            for (let i = 0; i < result.items.length; i++) {
                this.addResult(result.items[i]);
            }
            this.showLoad = false;
            this.maxResults = result.totalItems;
        }));
    }
    /**
     * adds a single item to the list
     * @private
     * @param {?} item
     * @return {?}
     */
    addResult(item) {
        //add check to make sure item does not exist
        this.results.push(item);
    }
    /**
     * When paging up and down with arrow key it sets the highlighted item into view
     * @private
     * @return {?}
     */
    scrollSelectedItemIntoView() {
        if (this.highlightedIndex >= 0) {
            /** @type {?} */
            const selectedChild = this.resultsListElement.nativeElement.children[this.highlightedIndex];
            selectedChild.scrollIntoView({
                behavior: 'smooth',
                block: 'nearest',
                inline: 'start'
            });
        }
    }
    /**
     * Sets the highlighted item by keyboard or mouseover
     * @private
     * @param {?} item
     * @return {?}
     */
    setHighlightedItem(item) {
        if (this.results && this.results.length > 0) {
            if (this.highlightedItem) {
                this.highlightedItem[this.HighlightedPropertyName] = false;
            }
            /** @type {?} */
            let message = '';
            if (item) {
                this.highlightedItem = item;
                this.highlightedItem[this.HighlightedPropertyName] = true;
                message = item[this.configuration.primaryTextField];
                if (this.configuration.secondaryTextField &&
                    item[this.configuration.secondaryTextField]) {
                    message += ': ' + item[this.configuration.secondaryTextField];
                }
            }
            else {
                this.highlightedItem = undefined;
                message = 'No item selected';
            }
            this.addScreenReaderMessage(message);
        }
    }
    /**
     * Adds message to be read by screen reader
     * @private
     * @param {?} message
     * @return {?}
     */
    addScreenReaderMessage(message) {
        this.srOnlyText = message;
    }
    /**
     * @param {?} obj
     * @return {?}
     */
    writeValue(obj) {
        if (obj instanceof SDSSelectedItemModel) {
            this.model = (/** @type {?} */ (obj));
            this._changeDetectorRef.markForCheck();
            if (this.model.items.length === 0) {
                this.inputValue = '';
            }
            else {
                if (this.configuration.selectionMode === SelectionMode.SINGLE) {
                    this.inputValue = this.getObjectValue(this.model.items[0], this.configuration.primaryTextField);
                }
            }
        }
    }
    /**
     * @return {?}
     */
    getClass() {
        return this.configuration.inputReadOnly &&
            this.configuration.selectionMode === SelectionMode.MULTIPLE
            ? 'hide-cursor'
            : '';
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnChange(fn) {
        this.propogateChange = fn;
    }
    /**
     * @param {?} fn
     * @return {?}
     */
    registerOnTouched(fn) {
        this.onTouchedCallback = fn;
    }
    /**
     * @param {?} isDisabled
     * @return {?}
     */
    setDisabledState(isDisabled) {
        this.disabled = isDisabled;
    }
}
SDSAutocompleteSearchComponent.decorators = [
    { type: Component, args: [{
                selector: 'sds-search-autocomplete',
                template: "<div sds-click-outside (clickOutside)=\"checkForFocus($event)\" sds-tab-outside (tabOutside)=\"checkForFocus($event)\">\n  <div class=\"maxw-mobile-lg position-relative\">\n    <div role=\"combobox\" [attr.id]=\"configuration.id+'-container'\" [attr.aria-expanded]=\"showResults\" [attr.aria-owns]=\"showResults? configuration.id+ '-listbox' : undefined\"\n      aria-haspopup=\"listbox\">\n      <input [disabled]=\"disabled\" (keypress)=\"onkeypress($event)\" (input)=\"textChange($event)\" class=\"usa-input padding-right-3\"\n        [ngClass]=\"getClass()\" #input [attr.aria-label]=\"configuration.ariaLabelText\" [attr.id]=\"configuration.id\" type=\"text\"\n        (focus)=\"inputFocusHandler()\" (keydown)=\"onKeydown($event)\" [(ngModel)]=\"inputValue\" aria-autocomplete=\"list\"\n        [attr.placeholder]=\"configuration.autocompletePlaceHolderText\" [attr.aria-activedescendant]=\"showResults? configuration.id+'-resultItem-'+highlightedIndex :''\"\n        [attr.aria-controls]=\"showResults? configuration.id+ '-listbox' : undefined\" autocomplete=\"off\">\n    </div>\n    <ul #resultsList *ngIf=\"showResults\" [attr.id]=\"configuration.id+ '-listbox'\" role=\"listbox\" class=\"usa-list usa-list--unstyled sds-autocomplete\"\n      (scroll)=\"onScroll()\">\n      <ng-container *ngIf=\"(results && results.length > 0)\">\n        <li [attr.id]=\"configuration.id+'-resultItem-'+i\" role=\"option\" *ngFor=\"let result of results; let i = index\"\n          (mouseenter)=\"listItemHover(i)\" [class]=\"result['highlighted'] ? 'sds-autocomplete__item sds-autocomplete__item--selected' : 'sds-autocomplete__item' \"\n          (click)=\"selectItem(result)\">\n          <ng-container *ngIf=\"itemTemplate\" [ngTemplateOutlet]=\"itemTemplate\" [ngTemplateOutletContext]=\"{$implicit:result}\">\n          </ng-container>\n\n          <ng-container *ngIf=\"!itemTemplate\">\n            <span class=\"display-block text-semibold\">\n              {{ getObjectValue(result, configuration.primaryTextField) }}\n              <span *ngIf=\"result.type === 'custom'\">\n                - {{configuration.freeTextSubtext}}\n              </span>\n            </span>\n            <ng-container *ngIf=\"configuration.secondaryTextField &&  result[configuration.secondaryTextField] \">\n              <span class=\"description\">{{ result[configuration.secondaryTextField] }}</span>\n            </ng-container>\n          </ng-container>\n        </li>\n      </ng-container>\n      <ng-container *ngIf=\"(!results || results.length == 0)\">\n        <li class=\"emptyResults margin-1\">No results found</li>\n      </ng-container>\n      <ng-container *ngIf=\"showLoad\">\n        <li class=\"autoLoading\">\n          <div class=\"lightToGrayBackgroundGradiate\">\n\n          </div>\n          <div class=\"grayToLightBackgroundGradiate\">\n\n          </div>\n        </li>\n        <li class=\"autoLoading\">\n          <div class=\"lightToGrayBackgroundGradiate\">\n\n          </div>\n          <div class=\"grayToLightBackgroundGradiate\">\n\n          </div>\n        </li>\n      </ng-container>\n    </ul>\n\n    <ng-container *ngIf=\"!input.disabled\">\n      <span class=\"position-absolute right-105 top-1 cursor-pointer\">\n        <span *ngIf=\"(inputValue && !disabled)\" tabindex=\"0\" role=\"button\" aria-label=\"Clear input\" aria-hidden=\"false\"\n          (click)=\"clearInput()\" (keyup.enter)=\"clearInput()\">\n          <fa-icon [icon]=\"['fas', 'times']\" size=\"xs\"></fa-icon>\n        </span>\n        <span *ngIf=\"!configuration.isTagModeEnabled\" tabindex=\"1\" role=\"button\" aria-label=\"Clear input\" aria-hidden=\"false\"\n          class=\"margin-left-1\">\n          <fa-icon *ngIf=\"(!showResults && !disabled)\" (click)=\"inputFocusHandler()\" [icon]=\"['fas', 'caret-down']\"\n            size=\"sm\"></fa-icon>\n          <fa-icon *ngIf=\"(showResults && !disabled)\" (click)=\"checkForFocus($event)\" [icon]=\"['fas', 'caret-up']\" size=\"sm\"></fa-icon>\n        </span>\n      </span>\n    </ng-container>\n    <ul class=\"usa-sr-only\" aria-live=\"assertive\">\n      <li>{{srOnlyText}}</li>\n    </ul>\n  </div>",
                providers: [Autocomplete_Autocomplete_VALUE_ACCESSOR],
                styles: [".grayToLightBackgroundGradiate{background:linear-gradient(to right,#c4c4c4,#f7f7f7);background-size:400% 400%;height:10px;padding:2.5px 0;text-align:center;color:#888;font-size:15px;font-weight:700;margin:7px 10px 0;-webkit-animation:5s infinite gradiantShiftGray;animation:5s infinite gradiantShiftGray}@-webkit-keyframes gradiantShiftGray{0%,100%{background-position:0 50%}50%{background-position:100% 50%}}@keyframes gradiantShiftGray{0%,100%{background-position:0 50%}50%{background-position:100% 50%}}.lightToGrayBackgroundGradiate{background:linear-gradient(to right,#f7f7f7,#c4c4c4);background-size:400% 400%;height:15px;padding:2.5px 0;text-align:center;color:#888;font-size:15px;font-weight:700;margin:10px 10px 0;-webkit-animation:5s infinite gradiantShift;animation:5s infinite gradiantShift}@-webkit-keyframes gradiantShift{0%,100%{background-position:0 50%}50%{background-position:100% 50%}}@keyframes gradiantShift{0%,100%{background-position:0 50%}50%{background-position:100% 50%}}.autoLoading{height:60px}.hide-cursor{color:transparent;text-shadow:0 0 0}"]
            }] }
];
/** @nocollapse */
SDSAutocompleteSearchComponent.ctorParameters = () => [
    { type: ChangeDetectorRef }
];
SDSAutocompleteSearchComponent.propDecorators = {
    resultsListElement: [{ type: ViewChild, args: ['resultsList',] }],
    input: [{ type: ViewChild, args: ['input',] }],
    itemTemplate: [{ type: Input }],
    configuration: [{ type: Input }],
    service: [{ type: Input }],
    inputReadOnly: [{ type: Input }],
    disabled: [{ type: Input }]
};
if (false) {
    /**
     * Ul list of elements
     * @type {?}
     */
    SDSAutocompleteSearchComponent.prototype.resultsListElement;
    /**
     * input control
     * @type {?}
     */
    SDSAutocompleteSearchComponent.prototype.input;
    /**
     * Allow to insert a customized template for suggestions to use
     * @type {?}
     */
    SDSAutocompleteSearchComponent.prototype.itemTemplate;
    /**
     * The data model that has the selected item
     * @type {?}
     */
    SDSAutocompleteSearchComponent.prototype.model;
    /**
     * Configuration for the Autocomplete control
     * @type {?}
     */
    SDSAutocompleteSearchComponent.prototype.configuration;
    /**
     * Instance of the SamHiercarchicalServiceInterface provided
     * @type {?}
     */
    SDSAutocompleteSearchComponent.prototype.service;
    /**
     * Timer id for the timer awaiting the service call for more typeing
     * @type {?}
     * @private
     */
    SDSAutocompleteSearchComponent.prototype.timeoutNumber;
    /**
     *  result set to be rendered
     * @type {?}
     */
    SDSAutocompleteSearchComponent.prototype.results;
    /**
     * max number of results to be shown
     * @type {?}
     * @private
     */
    SDSAutocompleteSearchComponent.prototype.maxResults;
    /**
     * selected index
     * @type {?}
     */
    SDSAutocompleteSearchComponent.prototype.highlightedIndex;
    /**
     * highlighted object in drop down
     * @type {?}
     * @private
     */
    SDSAutocompleteSearchComponent.prototype.highlightedItem;
    /**
     * value of the input field
     * @type {?}
     */
    SDSAutocompleteSearchComponent.prototype.inputValue;
    /**
     * Proprty being set on the object is highlighted
     * @type {?}
     * @private
     */
    SDSAutocompleteSearchComponent.prototype.HighlightedPropertyName;
    /** @type {?} */
    SDSAutocompleteSearchComponent.prototype.showLoad;
    /**
     * Search string
     * @type {?}
     * @private
     */
    SDSAutocompleteSearchComponent.prototype.searchString;
    /**
     * Message announced by screen readers when
     * autocomplete results are updated or new item
     * is highlighted
     * @type {?}
     */
    SDSAutocompleteSearchComponent.prototype.srOnlyText;
    /**
     * To make input readonly
     * @type {?}
     */
    SDSAutocompleteSearchComponent.prototype.inputReadOnly;
    /**
     * Used to store selected items
     * @type {?}
     */
    SDSAutocompleteSearchComponent.prototype.items;
    /**
     * Stored Event for ControlValueAccessor
     * @type {?}
     */
    SDSAutocompleteSearchComponent.prototype.onTouchedCallback;
    /**
     * Stored Event for ControlValueAccessor
     * @type {?}
     */
    SDSAutocompleteSearchComponent.prototype.propogateChange;
    /** @type {?} */
    SDSAutocompleteSearchComponent.prototype.disabled;
    /**
     * @type {?}
     * @private
     */
    SDSAutocompleteSearchComponent.prototype.resultsAvailableMessage;
    /**
     * @type {?}
     * @private
     */
    SDSAutocompleteSearchComponent.prototype.index;
    /**
     * Determines if the dropdown should be shown
     * @type {?}
     */
    SDSAutocompleteSearchComponent.prototype.showResults;
    /**
     * @type {?}
     * @private
     */
    SDSAutocompleteSearchComponent.prototype._changeDetectorRef;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0b2NvbXBsZXRlLXNlYXJjaC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZ3NhLXNhbS9jb21wb25lbnRzLyIsInNvdXJjZXMiOlsibGliL2F1dG9jb21wbGV0ZS1zZWFyY2gvYXV0b2NvbXBsZXRlLXNlYXJjaC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFDTCxTQUFTLEVBQ1QsS0FBSyxFQUNMLFNBQVMsRUFDVCxXQUFXLEVBQ1gsVUFBVSxFQUNWLFVBQVUsRUFDVixpQkFBaUIsRUFDbEIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLGlCQUFpQixFQUF3QixNQUFNLGdCQUFnQixDQUFDO0FBRXpFLE9BQU8sRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDM0QsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sa0RBQWtELENBQUM7QUFDeEYsT0FBTyxFQUNMLGFBQWEsRUFDYiwwQkFBMEIsRUFDM0IsTUFBTSwwREFBMEQsQ0FBQztBQUNsRSxPQUFPLEVBQUUsa0NBQWtDLEVBQUUsTUFBTSx1Q0FBdUMsQ0FBQzs7TUFDckYsd0NBQXdDLEdBQVE7SUFDcEQsT0FBTyxFQUFFLGlCQUFpQjtJQUMxQixXQUFXLEVBQUUsVUFBVTs7O0lBQUMsR0FBRyxFQUFFLENBQUMsOEJBQThCLEVBQUM7SUFDN0QsS0FBSyxFQUFFLElBQUk7Q0FDWjtBQVFELE1BQU0sT0FBTyw4QkFBOEI7Ozs7SUFDekMsWUFBb0Isa0JBQXFDO1FBQXJDLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBbUI7Ozs7UUFtRGxELHFCQUFnQixHQUFXLENBQUMsQ0FBQzs7OztRQVU3QixlQUFVLEdBQVcsRUFBRSxDQUFDOzs7O1FBS3ZCLDRCQUF1QixHQUFHLGFBQWEsQ0FBQztRQUV6QyxhQUFRLEdBQVksSUFBSSxDQUFDOzs7O1FBS3hCLGlCQUFZLEdBQVcsSUFBSSxDQUFDOzs7O1FBWXBCLGtC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Ozs7O0lBSVgsMkRBQWtEOzs7OztJQUtsRCx5REFBNEQ7O0lBRTVELGtEQUN5Qjs7Ozs7SUFFekIsaUVBRWlEOzs7OztJQUVqRCwrQ0FBa0I7Ozs7O0lBK0JsQixxREFBMkI7Ozs7O0lBM0lmLDREQUE2QyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgSW5wdXQsXG4gIFZpZXdDaGlsZCxcbiAgVGVtcGxhdGVSZWYsXG4gIEVsZW1lbnRSZWYsXG4gIGZvcndhcmRSZWYsXG4gIENoYW5nZURldGVjdG9yUmVmXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTkdfVkFMVUVfQUNDRVNTT1IsIENvbnRyb2xWYWx1ZUFjY2Vzc29yIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgU0RTQXV0b2NvbXBsZXRlU2VydmljZUludGVyZmFjZSB9IGZyb20gJy4vbW9kZWxzL1NEU0F1dG9jb21wbGV0ZVNlcnZpY2VJbnRlcmZhY2UnO1xuaW1wb3J0IHsgS2V5SGVscGVyLCBLRVlTIH0gZnJvbSAnLi4va2V5LWhlbHBlci9rZXktaGVscGVyJztcbmltcG9ydCB7IFNEU1NlbGVjdGVkSXRlbU1vZGVsIH0gZnJvbSAnLi4vc2VsZWN0ZWQtcmVzdWx0L21vZGVscy9zZHMtc2VsZWN0ZWRJdGVtLm1vZGVsJztcbmltcG9ydCB7XG4gIFNlbGVjdGlvbk1vZGUsXG4gIFNEU1NlbGVjdGVkSXRlbU1vZGVsSGVscGVyXG59IGZyb20gJy4uL3NlbGVjdGVkLXJlc3VsdC9tb2RlbHMvc2RzLXNlbGVjdGVkLWl0ZW0tbW9kZWwtaGVscGVyJztcbmltcG9ydCB7IFNEU0F1dG9jb21wbGV0ZVNlYXJjaENvbmZpZ3VyYXRpb24gfSBmcm9tICcuL21vZGVscy9TRFNBdXRvY29tcGxldGVDb25maWd1cmF0aW9uJztcbmNvbnN0IEF1dG9jb21wbGV0ZV9BdXRvY29tcGxldGVfVkFMVUVfQUNDRVNTT1I6IGFueSA9IHtcbiAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXG4gIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IFNEU0F1dG9jb21wbGV0ZVNlYXJjaENvbXBvbmVudCksXG4gIG11bHRpOiB0cnVlXG59O1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdzZHMtc2VhcmNoLWF1dG9jb21wbGV0ZScsXG4gIHRlbXBsYXRlVXJsOiAnLi9hdXRvY29tcGxldGUtc2VhcmNoLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vYXV0b2NvbXBsZXRlLXNlYXJjaC5jb21wb25lbnQuc2NzcyddLFxuICBwcm92aWRlcnM6IFtBdXRvY29tcGxldGVfQXV0b2NvbXBsZXRlX1ZBTFVFX0FDQ0VTU09SXVxufSlcbmV4cG9ydCBjbGFzcyBTRFNBdXRvY29tcGxldGVTZWFyY2hDb21wb25lbnQgaW1wbGVtZW50cyBDb250cm9sVmFsdWVBY2Nlc3NvciB7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgX2NoYW5nZURldGVjdG9yUmVmOiBDaGFuZ2VEZXRlY3RvclJlZikge31cbiAgLyoqXG4gICAqIFVsIGxpc3Qgb2YgZWxlbWVudHNcbiAgICovXG4gIEBWaWV3Q2hpbGQoJ3Jlc3VsdHNMaXN0JykgcmVzdWx0c0xpc3RFbGVtZW50OiBFbGVtZW50UmVmO1xuXG4gIC8qKlxuICAgKiBpbnB1dCBjb250cm9sXG4gICAqL1xuICBAVmlld0NoaWxkKCdpbnB1dCcpIGlucHV0OiBFbGVtZW50UmVmO1xuXG4gIC8qKlxuICAgKiBBbGxvdyB0byBpbnNlcnQgYSBjdXN0b21pemVkIHRlbXBsYXRlIGZvciBzdWdnZXN0aW9ucyB0byB1c2VcbiAgICovXG4gIEBJbnB1dCgpIGl0ZW1UZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PjtcblxuICAvKipcbiAgICogVGhlIGRhdGEgbW9kZWwgdGhhdCBoYXMgdGhlIHNlbGVjdGVkIGl0ZW1cbiAgICovXG4gIHB1YmxpYyBtb2RlbDogU0RTU2VsZWN0ZWRJdGVtTW9kZWw7XG5cbiAgLyoqXG4gICAqIENvbmZpZ3VyYXRpb24gZm9yIHRoZSBBdXRvY29tcGxldGUgY29udHJvbFxuICAgKi9cbiAgQElucHV0KClcbiAgcHVibGljIGNvbmZpZ3VyYXRpb246IFNEU0F1dG9jb21wbGV0ZVNlYXJjaENvbmZpZ3VyYXRpb247XG5cbiAgLyoqXG4gICAqIEluc3RhbmNlIG9mIHRoZSBTYW1IaWVyY2FyY2hpY2FsU2VydmljZUludGVyZmFjZSBwcm92aWRlZFxuICAgKi9cbiAgQElucHV0KClcbiAgcHVibGljIHNlcnZpY2U6IFNEU0F1dG9jb21wbGV0ZVNlcnZpY2VJbnRlcmZhY2U7XG5cbiAgLyoqXG4gICAqIFRpbWVyIGlkIGZvciB0aGUgdGltZXIgYXdhaXRpbmcgdGhlIHNlcnZpY2UgY2FsbCBmb3IgbW9yZSB0eXBlaW5nXG4gICAqL1xuICBwcml2YXRlIHRpbWVvdXROdW1iZXI6IG51bWJlcjtcblxuICAvKipcbiAgICogIHJlc3VsdCBzZXQgdG8gYmUgcmVuZGVyZWRcbiAgICovXG4gIHJlc3VsdHM6IG9iamVjdFtdO1xuXG4gIC8qKlxuICAgKiBtYXggbnVtYmVyIG9mIHJlc3VsdHMgdG8gYmUgc2hvd25cbiAgICovXG4gIHByaXZhdGUgbWF4UmVzdWx0czogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBzZWxlY3RlZCBpbmRleFxuICAgKi9cbiAgcHVibGljIGhpZ2hsaWdodGVkSW5kZXg6IG51bWJlciA9IDA7XG5cbiAgLyoqXG4gICAqIGhpZ2hsaWdodGVkIG9iamVjdCBpbiBkcm9wIGRvd25cbiAgICovXG4gIHByaXZhdGUgaGlnaGxpZ2h0ZWRJdGVtOiBvYmplY3Q7XG5cbiAgLyoqXG4gICAqIHZhbHVlIG9mIHRoZSBpbnB1dCBmaWVsZFxuICAgKi9cbiAgcHVibGljIGlucHV0VmFsdWU6IHN0cmluZyA9ICcnO1xuXG4gIC8qKlxuICAgKiBQcm9wcnR5IGJlaW5nIHNldCBvbiB0aGUgb2JqZWN0IGlzIGhpZ2hsaWdodGVkXG4gICAqL1xuICBwcml2YXRlIEhpZ2hsaWdodGVkUHJvcGVydHlOYW1lID0gJ2hpZ2hsaWdodGVkJztcblxuICBwdWJsaWMgc2hvd0xvYWQ6IGJvb2xlYW4gPSB0cnVlO1xuXG4gIC8qKlxuICAgKiBTZWFyY2ggc3RyaW5nXG4gICAqL1xuICBwcml2YXRlIHNlYXJjaFN0cmluZzogc3RyaW5nID0gbnVsbDtcblxuICAvKipcbiAgICogTWVzc2FnZSBhbm5vdW5jZWQgYnkgc2NyZWVuIHJlYWRlcnMgd2hlblxuICAgKiBhdXRvY29tcGxldGUgcmVzdWx0cyBhcmUgdXBkYXRlZCBvciBuZXcgaXRlbVxuICAgKiBpcyBoaWdobGlnaHRlZFxuICAgKi9cbiAgcHVibGljIHNyT25seVRleHQ6IHN0cmluZztcblxuICAvKipcbiAgICogVG8gbWFrZSBpbnB1dCByZWFkb25seVxuICAgKi9cbiAgQElucHV0KCkgcHVibGljIGlucHV0UmVhZE9ubHkgPSBmYWxzZTtcblxuICAvKipcbiAgICogVXNlZCB0byBzdG9yZSBzZWxlY3RlZCBpdGVtc1xuICAgKi9cbiAgaXRlbXMgPSBbXTtcbiAgLyoqXG4gICAqIFN0b3JlZCBFdmVudCBmb3IgQ29udHJvbFZhbHVlQWNjZXNzb3JcbiAgICovXG4gIHB1YmxpYyBvblRvdWNoZWRDYWxsYmFjazogKCkgPT4gdm9pZCA9ICgpID0+IG51bGw7XG5cbiAgLyoqXG4gICAqIFN0b3JlZCBFdmVudCBmb3IgQ29udHJvbFZhbHVlQWNjZXNzb3JcbiAgICovXG4gIHB1YmxpYyBwcm9wb2dhdGVDaGFuZ2U6IChfOiBhbnkpID0+IHZvaWQgPSAoXzogYW55KSA9PiBudWxsO1xuXG4gIEBJbnB1dCgpXG4gIHB1YmxpYyBkaXNhYmxlZDogYm9vbGVhbjtcblxuICBwcml2YXRlIHJlc3VsdHNBdmFpbGFibGVNZXNzYWdlOiBzdHJpbmcgPVxuICAgICcgcmVzdWx0cyBhdmFpbGFibGUuIFVzZSB1cCBhbmQgZG93biBhcnJvd3NcXFxuICB0byBzY3JvbGwgdGhyb3VnaCByZXN1bHRzLiBIaXQgZW50ZXIgdG8gc2VsZWN0Lic7XG5cbiAgcHJpdmF0ZSBpbmRleCA9IDA7XG4gIC8qKlxuICAgKiBHZXRzIHRoZSBzdHJpbmcgdmFsdWUgZnJvbSB0aGUgc3BlY2lmZWQgcHJvcGVydGllcyBvZiBhbiBvYmplY3RcbiAgICogQHBhcmFtIG9iamVjdFxuICAgKiBAcGFyYW0gcHJvcGVydHlGaWVsZHMgY29tbWEgc2VwZXJhdGVkIGxpc3Qgd2l0aCBwZXJpb2RzIGRlcHRoIG9mIG9iamVjdFxuICAgKi9cbiAgZ2V0T2JqZWN0VmFsdWUob2JqZWN0OiBPYmplY3QsIHByb3BlcnR5RmllbGRzOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGxldCB2YWx1ZSA9ICcnO1xuICAgIGxldCBjdXJyZW50ID0gb2JqZWN0O1xuICAgIGxldCBmaWVsZFNwbGl0ID0gcHJvcGVydHlGaWVsZHMuc3BsaXQoJywnKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZpZWxkU3BsaXQubGVuZ3RoOyBpKyspIHtcbiAgICAgIGxldCBmaWVsZFZhbHVlID0gZmllbGRTcGxpdFtpXTtcbiAgICAgIGxldCBmaWVsZFBhcnRTcGxpdCA9IGZpZWxkVmFsdWUuc3BsaXQoJy4nKTtcbiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgZmllbGRQYXJ0U3BsaXQubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgbGV0IGZpZWxkQ2hlY2tWYWx1ZSA9IGZpZWxkUGFydFNwbGl0W2pdO1xuICAgICAgICBpZiAoY3VycmVudCkge1xuICAgICAgICAgIGN1cnJlbnQgPSBjdXJyZW50W2ZpZWxkQ2hlY2tWYWx1ZV07XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKGN1cnJlbnQpIHtcbiAgICAgICAgdmFsdWUgKz0gY3VycmVudC50b1N0cmluZygpICsgJyAnO1xuICAgICAgfVxuICAgICAgY3VycmVudCA9IG9iamVjdDtcbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlLnRyaW0oKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZXRlcm1pbmVzIGlmIHRoZSBkcm9wZG93biBzaG91bGQgYmUgc2hvd25cbiAgICovXG4gIHB1YmxpYyBzaG93UmVzdWx0cyA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBDbGVhcnMgdGhlIGlucHV0IGZpZWxkcyBhbmQgdmFsdWVcbiAgICovXG4gIHB1YmxpYyBjbGVhcklucHV0KCk6IHZvaWQge1xuICAgIHRoaXMuaW5wdXRWYWx1ZSA9ICcnO1xuICAgIHRoaXMub25Ub3VjaGVkQ2FsbGJhY2soKTtcbiAgICB0aGlzLmNsZWFyQW5kSGlkZVJlc3VsdHMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gZXZlbnRcbiAgICovXG4gIGNoZWNrRm9yRm9jdXMoZXZlbnQpOiB2b2lkIHtcbiAgICB0aGlzLmZvY3VzUmVtb3ZlZCgpO1xuICAgIHRoaXMuc2hvd1Jlc3VsdHMgPSBmYWxzZTtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKi9cbiAgcHJpdmF0ZSBmb2N1c1JlbW92ZWQoKSB7XG4gICAgaWYgKHRoaXMuY29uZmlndXJhdGlvbikge1xuICAgICAgaWYgKHRoaXMuY29uZmlndXJhdGlvbi5zZWxlY3Rpb25Nb2RlID09PSBTZWxlY3Rpb25Nb2RlLlNJTkdMRSkge1xuICAgICAgICBpZiAodGhpcy5tb2RlbC5pdGVtcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgaWYgKHRoaXMuaW5wdXRWYWx1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIFNEU1NlbGVjdGVkSXRlbU1vZGVsSGVscGVyLmNsZWFySXRlbXModGhpcy5tb2RlbC5pdGVtcyk7XG4gICAgICAgICAgICB0aGlzLnByb3BvZ2F0ZUNoYW5nZSh0aGlzLm1vZGVsKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5pbnB1dFZhbHVlID0gdGhpcy5nZXRPYmplY3RWYWx1ZShcbiAgICAgICAgICAgICAgdGhpcy5tb2RlbC5pdGVtc1swXSxcbiAgICAgICAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uLnByaW1hcnlUZXh0RmllbGRcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmlucHV0VmFsdWUgPSAnJztcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5pbnB1dFZhbHVlID0gJyc7XG4gICAgfVxuICB9XG5cbiAgb25rZXlwcmVzcyhldikge1xuICAgIHJldHVybiB0aGlzLmNvbmZpZ3VyYXRpb24uaW5wdXRSZWFkT25seSA/IGZhbHNlIDogdHJ1ZTtcbiAgfVxuICB0ZXh0Q2hhbmdlKGV2ZW50KSB7XG4gICAgaWYgKCF0aGlzLmNvbmZpZ3VyYXRpb24uaXNUYWdNb2RlRW5hYmxlZCkge1xuICAgICAgLy8gaWUgMTEgcGxhY2Vob2xkZXJzIHdpbGwgaW5jb3JyZWN0bHkgdHJpZ2dlciBpbnB1dCBldmVudHMgKGtub3duIGJ1ZylcbiAgICAgIC8vIGlmIGlucHV0IGlzbid0IGFjdGl2ZSBlbGVtZW50IHRoZW4gZG9uJ3QgZG8gYW55dGhpbmdcbiAgICAgIGlmIChldmVudC50YXJnZXQgIT0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zdCBzZWFyY2hTdHJpbmcgPSBldmVudC50YXJnZXQudmFsdWUgfHwgJyc7XG4gICAgICB0aGlzLmdldFJlc3VsdHMoc2VhcmNoU3RyaW5nKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRXZlbnQgbWV0aG9kIHVzZWQgd2hlbiBmb2N1cyBpcyBnYWluZWQgdG8gdGhlIGlucHV0XG4gICAqL1xuICBpbnB1dEZvY3VzSGFuZGxlcigpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuY29uZmlndXJhdGlvbi5pc1RhZ01vZGVFbmFibGVkKSB7XG4gICAgICBpZiAodGhpcy5jb25maWd1cmF0aW9uLmZvY3VzSW5TZWFyY2gpIHtcbiAgICAgICAgdGhpcy5nZXRSZXN1bHRzKHRoaXMuaW5wdXRWYWx1ZSB8fCAnJyk7XG4gICAgICB9XG4gICAgICB0aGlzLm9uVG91Y2hlZENhbGxiYWNrKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEtleSBldmVudFxuICAgKiBAcGFyYW0gZXZlbnRcbiAgICovXG4gIG9uS2V5ZG93bihldmVudCk6IHZvaWQge1xuICAgIGlmIChLZXlIZWxwZXIuaXMoS0VZUy5UQUIsIGV2ZW50KSkge1xuICAgICAgcmV0dXJuO1xuICAgIH0gZWxzZSBpZiAoS2V5SGVscGVyLmlzKEtFWVMuQkFDS1NQQUNFLCBldmVudCkpIHtcbiAgICAgIGlmICh0aGlzLmNvbmZpZ3VyYXRpb24uaW5wdXRSZWFkT25seSkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoS2V5SGVscGVyLmlzKEtFWVMuRE9XTiwgZXZlbnQpKSB7XG4gICAgICB0aGlzLm9uQXJyb3dEb3duKCk7XG4gICAgfSBlbHNlIGlmIChLZXlIZWxwZXIuaXMoS0VZUy5VUCwgZXZlbnQpKSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgdGhpcy5vbkFycm93VXAoKTtcbiAgICB9IGVsc2UgaWYgKEtleUhlbHBlci5pcyhLRVlTLkVOVEVSLCBldmVudCkgJiYgdGhpcy5oaWdobGlnaHRlZEluZGV4ID49IDApIHtcbiAgICAgIGlmICh0aGlzLmNvbmZpZ3VyYXRpb24uaXNUYWdNb2RlRW5hYmxlZCkge1xuICAgICAgICBjb25zdCB2YWwgPSB0aGlzLmNyZWF0ZUZyZWVUZXh0SXRlbSgpO1xuICAgICAgICB0aGlzLnNlbGVjdEl0ZW0odmFsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc2VsZWN0SXRlbSh0aGlzLmhpZ2hsaWdodGVkSXRlbSk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChLZXlIZWxwZXIuaXMoS0VZUy5FTlRFUiwgZXZlbnQpICYmIHRoaXMuaGlnaGxpZ2h0ZWRJbmRleCA8IDApIHtcbiAgICAgIGNvbnN0IHZhbCA9IHRoaXMuY3JlYXRlRnJlZVRleHRJdGVtKCk7XG4gICAgICB0aGlzLnNlbGVjdEl0ZW0odmFsKTtcbiAgICB9IGVsc2UgaWYgKEtleUhlbHBlci5pcyhLRVlTLkVTQywgZXZlbnQpKSB7XG4gICAgICBpZiAodGhpcy5zaG93UmVzdWx0cykge1xuICAgICAgICB0aGlzLmNsZWFyQW5kSGlkZVJlc3VsdHMoKTtcbiAgICAgICAgaWYgKGV2ZW50LnN0b3BQcm9wYWdhdGlvbikge1xuICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIHNlbGVjdHMgdGhlIGl0ZW0gYWRkaW5nIGl0IHRvIHRoZSBtb2RlbCBhbmQgY2xvc2VzIHRoZSByZXN1bHRzXG4gICAqIEBwYXJhbSBpdGVtXG4gICAqL1xuICBwdWJsaWMgc2VsZWN0SXRlbShpdGVtOiBvYmplY3QpOiB2b2lkIHtcbiAgICBTRFNTZWxlY3RlZEl0ZW1Nb2RlbEhlbHBlci5hZGRJdGVtKFxuICAgICAgaXRlbSxcbiAgICAgIHRoaXMuY29uZmlndXJhdGlvbi5wcmltYXJ5S2V5RmllbGQsXG4gICAgICB0aGlzLmNvbmZpZ3VyYXRpb24uc2VsZWN0aW9uTW9kZSxcbiAgICAgIHRoaXMuaXRlbXNcbiAgICApO1xuXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLm1vZGVsLml0ZW1zID0gWy4uLnRoaXMuaXRlbXNdO1xuICAgICAgdGhpcy5wcm9wb2dhdGVDaGFuZ2UodGhpcy5tb2RlbCk7XG4gICAgfSwgMCk7XG4gICAgbGV0IG1lc3NhZ2UgPSB0aGlzLmdldE9iamVjdFZhbHVlKFxuICAgICAgaXRlbSxcbiAgICAgIHRoaXMuY29uZmlndXJhdGlvbi5wcmltYXJ5VGV4dEZpZWxkXG4gICAgKTtcbiAgICB0aGlzLmlucHV0VmFsdWUgPSBtZXNzYWdlO1xuICAgIHRoaXMuZm9jdXNSZW1vdmVkKCk7XG4gICAgdGhpcy5zaG93UmVzdWx0cyA9IGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqICBjbGVhcnMgdGhlIHJlc3VsdHMgYW5kIGNsb3NlcyByZXN1bHQgZHJvcCBkb3duXG4gICAqL1xuICBwcml2YXRlIGNsZWFyQW5kSGlkZVJlc3VsdHMoKTogdm9pZCB7XG4gICAgdGhpcy5yZXN1bHRzID0gW107XG4gICAgdGhpcy5zaG93UmVzdWx0cyA9IGZhbHNlO1xuICAgIHRoaXMuZm9jdXNSZW1vdmVkKCk7XG4gIH1cblxuICAvKipcbiAgICogIGhhbmRsZXMgdGhlIGFycm93IHVwIGtleSBldmVudFxuICAgKi9cbiAgcHJpdmF0ZSBvbkFycm93VXAoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMucmVzdWx0cyAmJiB0aGlzLnJlc3VsdHMubGVuZ3RoID4gMCkge1xuICAgICAgaWYgKHRoaXMuaGlnaGxpZ2h0ZWRJbmRleCA+PSAwKSB7XG4gICAgICAgIHRoaXMuaGlnaGxpZ2h0ZWRJbmRleC0tO1xuICAgICAgICB0aGlzLnNldEhpZ2hsaWdodGVkSXRlbSh0aGlzLnJlc3VsdHNbdGhpcy5oaWdobGlnaHRlZEluZGV4XSk7XG4gICAgICAgIHRoaXMuc2Nyb2xsU2VsZWN0ZWRJdGVtSW50b1ZpZXcoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogIGhhbmRsZXMgdGhlIGFycm93IGRvd24ga2V5IGV2ZW50XG4gICAqL1xuICBwcml2YXRlIG9uQXJyb3dEb3duKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLnJlc3VsdHMgJiYgdGhpcy5yZXN1bHRzLmxlbmd0aCA+IDApIHtcbiAgICAgIGlmICh0aGlzLmhpZ2hsaWdodGVkSW5kZXggPCB0aGlzLnJlc3VsdHMubGVuZ3RoIC0gMSkge1xuICAgICAgICB0aGlzLmhpZ2hsaWdodGVkSW5kZXgrKztcbiAgICAgICAgdGhpcy5zZXRIaWdobGlnaHRlZEl0ZW0odGhpcy5yZXN1bHRzW3RoaXMuaGlnaGxpZ2h0ZWRJbmRleF0pO1xuICAgICAgICB0aGlzLnNjcm9sbFNlbGVjdGVkSXRlbUludG9WaWV3KCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgc2hvd0ZyZWVUZXh0KCkge1xuICAgIGlmICh0aGlzLmNvbmZpZ3VyYXRpb24uaXNGcmVlVGV4dEVuYWJsZWQpIHtcbiAgICAgIGlmICh0aGlzLmlucHV0VmFsdWUpIHtcbiAgICAgICAgaWYgKHRoaXMuaW5wdXRWYWx1ZS5sZW5ndGggIT09IDApIHtcbiAgICAgICAgICBsZXQgZm91bmRJdGVtID0gZmFsc2U7XG4gICAgICAgICAgaWYgKHRoaXMucmVzdWx0cykge1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnJlc3VsdHMubGVuZ3RoICYmICFmb3VuZEl0ZW07IGkrKykge1xuICAgICAgICAgICAgICBsZXQgaXRlbSA9IHRoaXMucmVzdWx0c1tpXTtcbiAgICAgICAgICAgICAgZm91bmRJdGVtID1cbiAgICAgICAgICAgICAgICBpdGVtW3RoaXMuY29uZmlndXJhdGlvbi5wcmltYXJ5VGV4dEZpZWxkXSA9PT0gdGhpcy5pbnB1dFZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAodGhpcy5tb2RlbC5pdGVtcy5sZW5ndGggPiAwICYmICFmb3VuZEl0ZW0pIHtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5tb2RlbC5pdGVtcy5sZW5ndGggJiYgIWZvdW5kSXRlbTsgaSsrKSB7XG4gICAgICAgICAgICAgIGxldCBpdGVtID0gdGhpcy5tb2RlbC5pdGVtc1tpXTtcbiAgICAgICAgICAgICAgZm91bmRJdGVtID1cbiAgICAgICAgICAgICAgICBpdGVtW3RoaXMuY29uZmlndXJhdGlvbi5wcmltYXJ5VGV4dEZpZWxkXSA9PT0gdGhpcy5pbnB1dFZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiAhZm91bmRJdGVtO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5jb25maWd1cmF0aW9uLmlzRnJlZVRleHRFbmFibGVkO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlRnJlZVRleHRJdGVtKCkge1xuICAgIGxldCBpdGVtID0geyB0eXBlOiAnY3VzdG9tJyB9O1xuICAgIGl0ZW1bdGhpcy5jb25maWd1cmF0aW9uLnByaW1hcnlUZXh0RmllbGRdID0gdGhpcy5pbnB1dFZhbHVlO1xuICAgIGl0ZW1bdGhpcy5jb25maWd1cmF0aW9uLnByaW1hcnlLZXlGaWVsZF0gPSB0aGlzLmlucHV0VmFsdWU7XG4gICAgcmV0dXJuIGl0ZW07XG4gIH1cblxuICAvKipcbiAgICogIGdldHMgdGhlIGluaXRhbCByZXN1bHRzXG4gICAqIEBwYXJhbSBzZWFyY2hTdHJpbmdcbiAgICovXG4gIHByaXZhdGUgZ2V0UmVzdWx0cyhzZWFyY2hTdHJpbmc6IHN0cmluZyk6IHZvaWQge1xuICAgIGlmIChzZWFyY2hTdHJpbmcubGVuZ3RoID49IHRoaXMuY29uZmlndXJhdGlvbi5taW5pbXVtQ2hhcmFjdGVyQ291bnRTZWFyY2gpIHtcbiAgICAgIGlmIChcbiAgICAgICAgIXRoaXMubWF0Y2hQYXN0U2VhcmNoU3RyaW5nKHNlYXJjaFN0cmluZykgfHxcbiAgICAgICAgKHRoaXMubWF0Y2hQYXN0U2VhcmNoU3RyaW5nKHNlYXJjaFN0cmluZykgJiYgIXRoaXMuc2hvd1Jlc3VsdHMpIHx8XG4gICAgICAgIHRoaXMubWF0Y2hQYXN0U2VhcmNoU3RyaW5nKCcnKVxuICAgICAgKSB7XG4gICAgICAgIHRoaXMuc2VhcmNoU3RyaW5nID0gc2VhcmNoU3RyaW5nO1xuICAgICAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dE51bWJlcik7XG4gICAgICAgIHRoaXMudGltZW91dE51bWJlciA9IHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICB0aGlzLnNob3dMb2FkID0gdHJ1ZTtcbiAgICAgICAgICB0aGlzLnNlcnZpY2UuZ2V0RGF0YUJ5VGV4dCgwLCBzZWFyY2hTdHJpbmcpLnN1YnNjcmliZShyZXN1bHQgPT4ge1xuICAgICAgICAgICAgdGhpcy5yZXN1bHRzID0gcmVzdWx0Lml0ZW1zO1xuICAgICAgICAgICAgdGhpcy5zaG93TG9hZCA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5tYXhSZXN1bHRzID0gcmVzdWx0LnRvdGFsSXRlbXM7XG5cbiAgICAgICAgICAgIHRoaXMuaGlnaGxpZ2h0ZWRJbmRleCA9IHRoaXMuY29uZmlndXJhdGlvbi5pc0ZyZWVUZXh0RW5hYmxlZFxuICAgICAgICAgICAgICA/IC0xXG4gICAgICAgICAgICAgIDogMDtcbiAgICAgICAgICAgIGlmICghdGhpcy5jb25maWd1cmF0aW9uLmlzRnJlZVRleHRFbmFibGVkKSB7XG4gICAgICAgICAgICAgIHRoaXMuc2V0SGlnaGxpZ2h0ZWRJdGVtKHRoaXMucmVzdWx0c1t0aGlzLmhpZ2hsaWdodGVkSW5kZXhdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuc2hvd1Jlc3VsdHMgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5hZGRTY3JlZW5SZWFkZXJNZXNzYWdlKFxuICAgICAgICAgICAgICB0aGlzLm1heFJlc3VsdHMgKyAnICcgKyB0aGlzLnJlc3VsdHNBdmFpbGFibGVNZXNzYWdlXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgdGhpcy5fY2hhbmdlRGV0ZWN0b3JSZWYubWFya0ZvckNoZWNrKCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sIHRoaXMuY29uZmlndXJhdGlvbi5kZWJvdW5jZVRpbWUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVja3MgaWYgdGhlIG5ldyBzZWFyY2ggc3RyaW5nIG1hdGNoZXMgdGhlIG9sZCBzZWFyY2ggc3RyaW5nXG4gICAqIEBwYXJhbSBzZWFyY2hTdHJpbmdcbiAgICovXG4gIHByaXZhdGUgbWF0Y2hQYXN0U2VhcmNoU3RyaW5nKHNlYXJjaFN0cmluZzogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHRoaXMuc2VhcmNoU3RyaW5nID09PSBzZWFyY2hTdHJpbmc7XG4gIH1cblxuICAvKipcbiAgICogaGlnaGxpZ2h0cyB0aGUgaW5kZXggYmVpbmcgaG92ZXJlZFxuICAgKiBAcGFyYW0gaW5kZXhcbiAgICovXG4gIGxpc3RJdGVtSG92ZXIoaW5kZXg6IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMuaGlnaGxpZ2h0ZWRJbmRleCA9IGluZGV4O1xuICAgIHRoaXMuc2V0SGlnaGxpZ2h0ZWRJdGVtKHRoaXMucmVzdWx0c1t0aGlzLmhpZ2hsaWdodGVkSW5kZXhdKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTY3JvbGwgRXZlbnQgSGFuZGxlciAoQ2FsY3VsYXRlcyBpZiBtcHJlIGl0ZW1zIHNob3VsZCBiZSBhc2tlZCBmb3IgZnJvbSBzZXJ2aWNlIG9uIHNjcm9sbGluZyBkb3duKVxuICAgKi9cbiAgb25TY3JvbGwoKSB7XG4gICAgaWYgKHRoaXMubWF4UmVzdWx0cyA+IHRoaXMucmVzdWx0cy5sZW5ndGgpIHtcbiAgICAgIGxldCBzY3JvbGxBcmVhSGVpZ2h0ID0gdGhpcy5yZXN1bHRzTGlzdEVsZW1lbnQubmF0aXZlRWxlbWVudC5vZmZzZXRIZWlnaHQ7XG4gICAgICBsZXQgc2Nyb2xsVG9wUG9zID0gdGhpcy5yZXN1bHRzTGlzdEVsZW1lbnQubmF0aXZlRWxlbWVudC5zY3JvbGxUb3A7XG4gICAgICBsZXQgc2Nyb2xsQXJlYU1heEhlaWdodCA9IHRoaXMucmVzdWx0c0xpc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnRcbiAgICAgICAgLnNjcm9sbEhlaWdodDtcbiAgICAgIGlmIChzY3JvbGxUb3BQb3MgKyBzY3JvbGxBcmVhSGVpZ2h0ICogMiA+PSBzY3JvbGxBcmVhTWF4SGVpZ2h0KSB7XG4gICAgICAgIHRoaXMuZ2V0QWRkaXRpb25hbFJlc3VsdHMoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogZ2V0cyBtb3JlIHJlc3VsdHMgYmFzZWQgd2hlbiBzY3JvbGxpbmcgYW5kIGFkZHMgdGhlIGl0ZW1zXG4gICAqL1xuICBwcml2YXRlIGdldEFkZGl0aW9uYWxSZXN1bHRzKCkge1xuICAgIHRoaXMuc2hvd0xvYWQgPSB0cnVlO1xuICAgIHRoaXMuc2VydmljZVxuICAgICAgLmdldERhdGFCeVRleHQodGhpcy5yZXN1bHRzLmxlbmd0aCwgdGhpcy5zZWFyY2hTdHJpbmcpXG4gICAgICAuc3Vic2NyaWJlKHJlc3VsdCA9PiB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmVzdWx0Lml0ZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgdGhpcy5hZGRSZXN1bHQocmVzdWx0Lml0ZW1zW2ldKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNob3dMb2FkID0gZmFsc2U7XG4gICAgICAgIHRoaXMubWF4UmVzdWx0cyA9IHJlc3VsdC50b3RhbEl0ZW1zO1xuICAgICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogYWRkcyBhIHNpbmdsZSBpdGVtIHRvIHRoZSBsaXN0XG4gICAqIEBwYXJhbSBpdGVtXG4gICAqL1xuICBwcml2YXRlIGFkZFJlc3VsdChpdGVtOiBvYmplY3QpIHtcbiAgICAvL2FkZCBjaGVjayB0byBtYWtlIHN1cmUgaXRlbSBkb2VzIG5vdCBleGlzdFxuICAgIHRoaXMucmVzdWx0cy5wdXNoKGl0ZW0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFdoZW4gcGFnaW5nIHVwIGFuZCBkb3duIHdpdGggYXJyb3cga2V5IGl0IHNldHMgdGhlIGhpZ2hsaWdodGVkIGl0ZW0gaW50byB2aWV3XG4gICAqL1xuICBwcml2YXRlIHNjcm9sbFNlbGVjdGVkSXRlbUludG9WaWV3KCkge1xuICAgIGlmICh0aGlzLmhpZ2hsaWdodGVkSW5kZXggPj0gMCkge1xuICAgICAgY29uc3Qgc2VsZWN0ZWRDaGlsZCA9IHRoaXMucmVzdWx0c0xpc3RFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuY2hpbGRyZW5bXG4gICAgICAgIHRoaXMuaGlnaGxpZ2h0ZWRJbmRleFxuICAgICAgXTtcbiAgICAgIHNlbGVjdGVkQ2hpbGQuc2Nyb2xsSW50b1ZpZXcoe1xuICAgICAgICBiZWhhdmlvcjogJ3Ntb290aCcsXG4gICAgICAgIGJsb2NrOiAnbmVhcmVzdCcsXG4gICAgICAgIGlubGluZTogJ3N0YXJ0J1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIGhpZ2hsaWdodGVkIGl0ZW0gYnkga2V5Ym9hcmQgb3IgbW91c2VvdmVyXG4gICAqIEBwYXJhbSBpdGVtXG4gICAqL1xuICBwcml2YXRlIHNldEhpZ2hsaWdodGVkSXRlbShpdGVtOiBPYmplY3QpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5yZXN1bHRzICYmIHRoaXMucmVzdWx0cy5sZW5ndGggPiAwKSB7XG4gICAgICBpZiAodGhpcy5oaWdobGlnaHRlZEl0ZW0pIHtcbiAgICAgICAgdGhpcy5oaWdobGlnaHRlZEl0ZW1bdGhpcy5IaWdobGlnaHRlZFByb3BlcnR5TmFtZV0gPSBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGxldCBtZXNzYWdlID0gJyc7XG4gICAgICBpZiAoaXRlbSkge1xuICAgICAgICB0aGlzLmhpZ2hsaWdodGVkSXRlbSA9IGl0ZW07XG4gICAgICAgIHRoaXMuaGlnaGxpZ2h0ZWRJdGVtW3RoaXMuSGlnaGxpZ2h0ZWRQcm9wZXJ0eU5hbWVdID0gdHJ1ZTtcbiAgICAgICAgbWVzc2FnZSA9IGl0ZW1bdGhpcy5jb25maWd1cmF0aW9uLnByaW1hcnlUZXh0RmllbGRdO1xuICAgICAgICBpZiAoXG4gICAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uLnNlY29uZGFyeVRleHRGaWVsZCAmJlxuICAgICAgICAgIGl0ZW1bdGhpcy5jb25maWd1cmF0aW9uLnNlY29uZGFyeVRleHRGaWVsZF1cbiAgICAgICAgKSB7XG4gICAgICAgICAgbWVzc2FnZSArPSAnOiAnICsgaXRlbVt0aGlzLmNvbmZpZ3VyYXRpb24uc2Vjb25kYXJ5VGV4dEZpZWxkXTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5oaWdobGlnaHRlZEl0ZW0gPSB1bmRlZmluZWQ7XG4gICAgICAgIG1lc3NhZ2UgPSAnTm8gaXRlbSBzZWxlY3RlZCc7XG4gICAgICB9XG4gICAgICB0aGlzLmFkZFNjcmVlblJlYWRlck1lc3NhZ2UobWVzc2FnZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEFkZHMgbWVzc2FnZSB0byBiZSByZWFkIGJ5IHNjcmVlbiByZWFkZXJcbiAgICogQHBhcmFtIG1lc3NhZ2VcbiAgICovXG4gIHByaXZhdGUgYWRkU2NyZWVuUmVhZGVyTWVzc2FnZShtZXNzYWdlOiBzdHJpbmcpIHtcbiAgICB0aGlzLnNyT25seVRleHQgPSBtZXNzYWdlO1xuICB9XG5cbiAgd3JpdGVWYWx1ZShvYmo6IGFueSk6IHZvaWQge1xuICAgIGlmIChvYmogaW5zdGFuY2VvZiBTRFNTZWxlY3RlZEl0ZW1Nb2RlbCkge1xuICAgICAgdGhpcy5tb2RlbCA9IG9iaiBhcyBTRFNTZWxlY3RlZEl0ZW1Nb2RlbDtcbiAgICAgIHRoaXMuX2NoYW5nZURldGVjdG9yUmVmLm1hcmtGb3JDaGVjaygpO1xuICAgICAgaWYgKHRoaXMubW9kZWwuaXRlbXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHRoaXMuaW5wdXRWYWx1ZSA9ICcnO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKHRoaXMuY29uZmlndXJhdGlvbi5zZWxlY3Rpb25Nb2RlID09PSBTZWxlY3Rpb25Nb2RlLlNJTkdMRSkge1xuICAgICAgICAgIHRoaXMuaW5wdXRWYWx1ZSA9IHRoaXMuZ2V0T2JqZWN0VmFsdWUoXG4gICAgICAgICAgICB0aGlzLm1vZGVsLml0ZW1zWzBdLFxuICAgICAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uLnByaW1hcnlUZXh0RmllbGRcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGdldENsYXNzKCkge1xuICAgIHJldHVybiB0aGlzLmNvbmZpZ3VyYXRpb24uaW5wdXRSZWFkT25seSAmJlxuICAgICAgdGhpcy5jb25maWd1cmF0aW9uLnNlbGVjdGlvbk1vZGUgPT09IFNlbGVjdGlvbk1vZGUuTVVMVElQTEVcbiAgICAgID8gJ2hpZGUtY3Vyc29yJ1xuICAgICAgOiAnJztcbiAgfVxuXG4gIHJlZ2lzdGVyT25DaGFuZ2UoZm46IGFueSk6IHZvaWQge1xuICAgIHRoaXMucHJvcG9nYXRlQ2hhbmdlID0gZm47XG4gIH1cblxuICByZWdpc3Rlck9uVG91Y2hlZChmbjogYW55KTogdm9pZCB7XG4gICAgdGhpcy5vblRvdWNoZWRDYWxsYmFjayA9IGZuO1xuICB9XG5cbiAgc2V0RGlzYWJsZWRTdGF0ZShpc0Rpc2FibGVkOiBib29sZWFuKTogdm9pZCB7XG4gICAgdGhpcy5kaXNhYmxlZCA9IGlzRGlzYWJsZWQ7XG4gIH1cbn1cbiJdfQ==